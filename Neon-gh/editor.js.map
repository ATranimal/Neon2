{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/events/events.js","webpack:///./node_modules/inherits/inherits_browser.js","webpack:///./node_modules/immediate/lib/browser.js","webpack:///external \"d3\"","webpack:///./src/utils/SelectTools.ts","webpack:///./node_modules/argsarray/index.js","webpack:///./node_modules/jsonschema/lib/helpers.js","webpack:///./src/DisplayPanel/DisplayControls.ts","webpack:///./src/utils/Notification.ts","webpack:///./src/utils/Color.ts","webpack:///./src/SquareEdit/SelectOptions.ts","webpack:///./src/utils/DragHandler.ts","webpack:///./node_modules/spark-md5/spark-md5.js","webpack:///./src/utils/random.ts","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/url/url.js","webpack:///./node_modules/jsonschema/lib/scan.js","webpack:///./src/SquareEdit/Contents.ts","webpack:///./src/utils/Select.ts","webpack:///./node_modules/pouchdb/lib/index-browser.es.js","webpack:///./src/NeonView.ts","webpack:///./node_modules/pouchdb/node_modules/uuid/index.js","webpack:///./node_modules/vuvuzela/index.js","webpack:///./src/DisplayPanel/DisplayPanel.ts","webpack:///./src/DivaView.ts","webpack:///./src/SingleView/SingleView.ts","webpack:///./src/SquareEdit/DivaEditMode.ts","webpack:///./src/SquareEdit/SingleEditMode.ts","webpack:///./src/InfoModule.ts","webpack:///./src/TextView.ts","webpack:///./src/TextEditMode.ts","webpack:///./src/utils/ConvertMei.ts","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/pouchdb/node_modules/uuid/lib/bytesToUuid.js","webpack:///./src/SquareEdit/Controls.ts","webpack:///./src/SquareEdit/Grouping.ts","webpack:///./src/utils/Resize.ts","webpack:///./src/SquareEdit/InsertHandler.ts","webpack:///./deployment/pages/editor.js","webpack:///./src/NeonCore.ts","webpack:///./src/Validation.ts","webpack:///./src/VerovioWrapper.ts","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/pouchdb/node_modules/uuid/v1.js","webpack:///./node_modules/pouchdb/node_modules/uuid/v4.js","webpack:///./src/utils/NeonManifest.ts","webpack:///./node_modules/jsonschema/lib/index.js","webpack:///./node_modules/jsonschema/lib/validator.js","webpack:///./node_modules/node-libs-browser/node_modules/punycode/punycode.js","webpack:///(webpack)/buildin/module.js","webpack:///./node_modules/url/util.js","webpack:///./node_modules/querystring-es3/index.js","webpack:///./node_modules/querystring-es3/decode.js","webpack:///./node_modules/querystring-es3/encode.js","webpack:///./node_modules/jsonschema/lib/attribute.js","webpack:///./src/utils/EditControls.ts","webpack:///./src/utils/EditContents.ts","webpack:///./src/utils/template/Template.ts","webpack:///./src/SingleView/Zoom.ts","webpack:///./src/Warnings.ts","webpack:///./src/SquareEdit/StaffTools.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","this","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","events","existing","warning","newListener","emit","unshift","push","length","warned","w","Error","String","emitter","count","console","warn","onceWrapper","fired","removeListener","wrapFn","arguments","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","len","listeners","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","scheduleDrain","draining","Mutation","global","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","task","d3","getSelectionType","getElementsByClassName","id","unselect","querySelectorAll","forEach","selected","classList","remove","contains","removeAttribute","Color","unhighlight","style","fill","from","el","color","fontWeight","sylRect","syllable","add","selectAll","getElementById","SelectOptions","endOptionsSelection","Grouping","endGroupingSelection","innerHTML","updateHighlight","select","dragHandler","selectStaff","sylId","elem","closest","span","async","isLigature","nc","neonView","getElementAttr","view","getCurrentPageURI","sharedSecondLevelParent","elements","tempElements","secondParent","parentElement","selectBBox","bbox","syl","resize","dragInit","querySelector","staff","highlight","parent","prevNc","previousSibling","nextNc","nextSibling","triggerGrouping","triggerNcActions","ulx","uly","lrx","lry","rotate","path","coordinates","getAttribute","match","map","Math","atan","min","max","notNeumes","nn","selectionType","selectionClass","containsClefOrCustos","groupsToSelect","Set","grouping","follows","slice","precedes","group","groups","values","size","triggerClefActions","triggerCustosActions","triggerDefaultSylActions","triggerDefaultActions","triggerSplitActions","triggerStaffActions","triggerSylActions","staff0","staff1","staffChildren","children","abs","indexOf","firstStaff","secondStaff","firstLayer","secondLayer","firstSyllableChildren","filter","secondSyllableChildren","lastSyllable","firstSyllable","triggerNeumeActions","posFirstY","posSecondY","x","baseVal","y","isFirstLigature","isSecondLigature","g","fun","uri","ValidationError","instance","schema","propertyPath","argument","stack","toString","ValidatorResult","options","ctx","errors","throwError","disableFormat","stringizer","v","addError","detail","importErrors","res","validatorType","join","SchemaError","msg","captureStackTrace","SchemaContext","base","schemas","resolve","makeChild","propertyName","makeSuffix","FORMAT_REGEXPS","input","parseFloat","parseInt","result","RegExp","e","regexp","regex","pattern","ipv4","isFormat","format","validator","test","customFormats","JSON","stringify","deepMerger","dst","deepMerge","copyist","src","copyistWithDeepMerge","array","isArray","pathEncoder","encodeURIComponent","replace","deepCompareStrict","a","b","every","aKeys","bKeys","objectGetPath","k","parts","split","decodeURIComponent","encodePath","getDecimalPlaces","number","decimalPlaces","decimalParts","lastGlyphOpacity","lastImageOpacity","setHighlightControls","highlightDropdown","highlightStaff","highlightSyllable","highlightNeume","highlightNone","highlightType","addEventListener","evt","stopPropagation","toggle","body","highlightClickaway","textContent","setGroupingHighlight","unsetGroupingHighlight","removeEventListener","meiClassName","background","opacitySlider","opacityOutput","inputChangeOpacity","opacity","lowerOpacity","newOpacity","round","setOpacityControls","bgOpacitySlider","bgOpacityOutput","bgInputChangeHandler","setBackgroundOpacityControls","displayContents","toggleDisplay","display","setAttribute","zoomHandler","zoomSlider","zoomOutput","inputChangeHandler","zoomTo","resetZoomAndPan","currentZoom","newZoom","highlightSelection","highlightId","notifications","currentModeMessage","notifying","startNotification","currentNotification","notification","isModeMessage","window","clearTimeout","timeoutID","clearOrShowNextNotification","getId","notificationContent","displayNotification","setTimeoutId","currentId","notif","Notification","displayed","uuidv4","search","ColorPalette","tagName","rects","rect","unsetStaffHighlight","child","cchild","stroke","setStaffHighlight","staves","staffColor","groupColor","unsetInclinatumAction","unsetVirgaAction","removeHandler","toRemove","chainAction","edit","then","updateForCurrentPage","changeStaffHandler","toChange","moreEdit","deleteButtonHandler","initOptionsListeners","preventDefault","initNeonView","Contents","custosActionContents","extraEdit","ncActionContents","unsetInclinatum","unsetVirga","queueNotification","setInclinatum","setVirga","del","neumeActionContents","neume","contour","changeGroupingAction","triggerChangeGroup","info","getContourByValue","initGroupingListeners","clef","clefActionContents","setCClef","setFClef","staffActionContents","systems","elementIds","editorAction","splitActionContents","SplitHandler","startSplit","co","points","getStaffBBox","y_change","tan","defaultSylActionContents","changeStaff","defaultActionContents","default","selector","dragBehaviour","drag","dragStartCoords","event","dx","dy","sourceEvent","dragging","dragEnded","activeNc","selection","relativeY","relativeX","attr","paramArray","singleAction","action","param","elementId","xDiff","yDiff","reset","resetToAction","hex_chr","md5cycle","md5blk","md5blks","charCodeAt","md5blk_array","md51","tail","tmp","lo","hi","substring","rhex","j","hex","toUtf8","str","unescape","hexToBinaryString","bytes","substr","fromCharCode","SparkMD5","ArrayBuffer","clamp","val","to","num","targetArray","sourceArray","byteLength","begin","end","Uint8Array","append","appendBinary","contents","_buff","_length","_hash","raw","buff","_finish","getState","hash","setState","destroy","hashBinary","content","first","second","returnUInt8Array","buffer","subarray","utf8Str2ArrayBuffer","md51_array","factory","uint8ToUuid","cb","previous","current","padStart","reduce","crypto","octets","modifiers","getRandomValues","punycode","util","Url","protocol","slashes","auth","host","port","hostname","query","pathname","href","parse","urlParse","source","relative","resolveObject","obj","isString","protocolPattern","portPattern","simplePathPattern","unwise","autoEscape","nonHostChars","hostEndingChars","hostnamePartPattern","hostnamePartStart","unsafeProtocol","hostlessProtocol","slashedProtocol","querystring","url","parseQueryString","slashesDenoteHost","isObject","u","queryIndex","splitter","uSplit","rest","trim","simplePath","exec","proto","lowerProto","toLowerCase","atSign","hostEnd","hec","lastIndexOf","parseHost","ipv6Hostname","hostparts","part","newpart","validParts","notHost","bit","toASCII","h","ae","esc","escape","qm","charAt","rel","tkeys","tk","tkey","rkeys","rk","rkey","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","isNullOrUndefined","authInHost","isNull","last","hasTrailingSlash","up","splice","isAbsolute","urilib","helpers","SchemaScanResult","found","ref","scan","scanSchema","baseuri","$ref","resolvedUri","ourBase","scanArray","items","extends","additionalItems","scanObject","properties","additionalProperties","definitions","patternProperties","dependencies","disallow","allOf","anyOf","oneOf","not","insertTabHtml","primitiveTab","groupingTab","systemTab","insertControlsPanel","editControlsPanel","groupingMenu","strokeWidth","escapeKeyListener","infoListeners","isSelByBBox","selByBBox","stopPropHandler","clickHandler","getUserMode","shiftKey","firstLigatureHalf","secondLigatureHalf","ncIndex","firstUse","assert","secondUse","navigator","userAgent","metaKey","ctrlKey","includes","container","pt","createSVGPoint","clientX","clientY","transformMatrix","getScreenCTM","matrixTransform","inverse","selectedStaves","dispatchEvent","MouseEvent","screenX","screenY","altKey","width","nv","dh","sel","initialX","initialY","panning","dragSelecting","canvas","dragSelectAction","userMode","nodeName","startDrag","mouse","initialP","currentPt","curX","curY","newX","newY","currentWidth","currentHeight","updateRect","rx","ry","lx","ly","node","ul","lr","transform","multiply","box","getBBox","height","resetTo","ExportedSet","ExportedMap","mangle","unmangle","Map$1","_store","Set$1","cloneBinaryObject","cloneArrayBuffer","webkitSlice","mangled","has","delete","Map","prop","getOwnPropertyDescriptor","species","supportsMapAndSet","funcToString","objectCtorString","clone","newObject","Date","toISOString","Blob","isBinaryObject","Ctor","isPlainObject","toPromise","func","self","usedCB","promise","Promise","fulfill","reject","resp","callback","mesg","adapterFun","_closed","_destroyed","logArgs","origCallback","responseArgs","logApiCall","taskqueue","isReady","addTask","failed","pick","hasLocal","identityFunction","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","numDocs","numDone","perDocResults","checkDone","results","allRequests","nextBatch","upTo","batch","offset","docId","docIdx","docRequests","docOpts","open_revs","rev","formatResult","processBatch","localStorage","setItem","getItem","hasLocalStorage","Changes","guardedConsole","method","defaultBackOff","maxTimeout","random","randomNumber","explainError","status","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","notifyLocalWindows","notify","$inject_Object_assign","assign","nextSource","nextKey","PouchError","reason","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","generateErrorFromResponse","filterChange","req","hasFilter","query_params","change","doc","filterReturn","tryFilter","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","parseDesignDocFunctionName","normalizeDesignDocFunctionName","normalized","qParser","parser","parseUri","encoded","$0","$1","$2","scopeEval","scope","upsert","diffFun","docRev","_rev","newDoc","updated","_id","put","tryAndPut","thisAtob","atob","thisBtoa","btoa","createBlob","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","getBlob","binaryStringToArrayBuffer","bin","buf","binStringToBluffer","binString","b64ToBluffer","b64","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","binary","arrayBufferToBinaryString","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","appendBlob","start","sliceBlob","arrayBuffer","appendString","string","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","next","loadNextChunk","done","rawToBase64","stringMd5","deterministic_revs","clonedDoc","_rev_tree","v4","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","rootToLeaf","paths","history","sortByPos$1","insertSorted","item","comparator","idx","mid","low","high","binarySearch","pathToTree","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parentIdx","elementsLen","merge","depth","newTree","stemmed","stemmedRevs","revHash","stem","getTrees","isDeleted","isLocalId","Changes$1","complete","ee","onDestroy","cancel","pending","lastSeq","isCancelled","tryCatchInChangeListener","validateChanges","processChange","changeList","_conflicts","compare","left","right","yankError","compareByIdThenRev","idCompare","_revisions","AbstractPouchDB","TaskQueue","PouchDB","__opts","auto_compaction","prefix","backend","adapter","adapters","preferredAdapters","adapterName","use_prefix","parseAdapter","_adapter","valid","fail","onDestroyed","from_constructor","onClosed","prepareForDestruction","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","descending","limit","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_deleted","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","putAttachment","attachmentId","rev$$1","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","_getRevisionTree","missingForId","processDoc","missingObj","compactDocument","maxHeight","revTree","edges","prnt","edge","computeHeight","candidates","_doCompaction","compact","_compactionQueue","doNextCompaction","catch","last_seq","_compact","return_docs","promises","row","all","_getLocal","finishOpenRevs","latest","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","skip","start_key","startkey","end_key","endkey","incompatibleOpt","allDocsKeysParse","_allDocs","close","_close","_info","db_name","_type","attachmentError","attachmentNameError","atts","cleanDocs","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","usePrefix","destroyDb","_destroy","localDoc","deletedMap","trueName","execute","AbortController","abort","f$1","fetch","Headers","eventEmitter","Pouch","destructListeners","_destructionListeners","dbList","setUpEventEmitter","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","getFieldFromDoc","parsedField","parseField","fieldName","fields","ch","combinationFields","isCombinationalField","field","getKey","mergeAndedSelectors","selectors","matcher","$eq","fieldMatchers","operator","$gte","$gt","mergeGtGte","$lte","$lt","mergeLtLte","$ne","mergeNe","mergeEq","massageSelector","wasAnded","isAndInSelector","isAnd","mergeAndedSelectorsNested","orOrNor","subSelector","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","ak","bk","objectCollate","Infinity","origKey","toJSON","indexify","expFormat","toExponential","magnitude","neg","magString","padWith","upToLength","padding","targetLength","pad","factor","factorStr","toFixed","numToIndexableString","toIndexableString","objKey","parseNumber","originalIdx","numAsString","magAsString","metaStack","lastMetaElement","lastElementIndex","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","getFieldValuesAsArray","sorting","aRow","bRow","collation","createFieldSorter","docFieldValue","some","orMatchers","find","matchCominationalSelector","matchSelector","userOperator","userValue","matchers","fieldExists","fieldIsNotUndefined","arrayContainsValue","divisor","mod","modField","neValue","arraySize","arrayContainsAllValues","regexMatch","typeMatch","filterName","changesHandler","doc_ids","viewName","ddoc","mapFun","views","rowsMatched","matchesSelector","filterFun","filters","toObject","version","reservedWords","dataWords","parseRevisionInfo","parseDoc","newEdits","dbOpts","nRevNum","revInfo","revisions","revisionIds","makeRevTreeFromRevisions","specialKey","preprocessString","blobType","asBinary","parseBase64","digest","preprocessAttachment","md5","preprocessBlob","updateDoc","revLimit","prev","docInfo","writeDoc","splitRev","targetPos","targetId","revExists","previousWinningRev","previouslyDeleted","isRoot","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","processDocs","docInfos","fetchedDocs","tx","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","resultsIdx","docWritten","nextDoc","rootIsMissing","insertDoc","DOC_STORE","META_STORE","safeJsonStringify","json","idbError","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","safeJsonParse","decodeDoc","_doc_id_rev","readBlobData","asBlob","fetchAttachmentsIfNecessary","txn","attObj","objectStore","onsuccess","fetchAttachment","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","IDBKeyRange","bound","deleteOrphanedAttachments","openCursor","only","cursor","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","onAllDocsProcessed","updateDocCountIfReady","docCount","newRevIsDeleted","isUpdate","collectResults","finishDoc","attachmentSaved","newAtt","saveAttachment","writeAttachments","afterPutDoc","revsToDelete","compactTree","metadataToStore","afterPutMetadata","attsAdded","attsToAdd","onerror","insertAttachmentMappings","putReq","overallErr","docv","recv","processedAttachment","preprocessAttachments","txnResult","onabort","ontimeout","oncomplete","finish","digests","filename","verifyAttachment","attErr","verifyAttachments","numFetched","revs_limit","readMetadata","fetchExistingDocs","startTransaction","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","newKeyRange","lastKey","upper","upperOpen","code","lowerBound","idbAllDocs","keyRangeError","inclusiveEnd","inclusive_end","upperBound","createKeyRange","onResultsReady","updateSeq","onSuccess","docIdRevIndex","allDocsInner","fetchDocAsynchronously","batchValues","batchValue","batchKeys","returnVal","total_rows","maxKey","allDocsKeys","running","applyNext","docIds","numResults","docIdsToMetadata","onGetMetadata","docIdRev","objectStores","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","processMetadataAndWinningDoc","onBatchDone","filtered","blobSupportPromise","cachedDBs","openReqList","IdbPouch","tryCode","enqueueTask","thisCallback","addDeletedOrLocalIndex","createIndex","unique","migrateLocalStore","localStore","local","range","seqCursor","migrateAttsAndSeqs","digestMap","migrateMetadata","onGetMetadataSeq","metadataSeq","fetchMetadataSeq","instanceId","reqOpts","historyNode","attachId","attachment","blobData","doc_count","idb_attachment_format","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createObjectStore","keyPath","autoIncrement","createSchema","currentTarget","createLocalStoreSchema","addAttachAndSeqStore","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","countDocs","blob$$1","matchedChrome","matchedEdge","checkBlobSupport","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","preprocessAttachments$1","getHost","hasUrlPrefix","user","password","username","genDBUrl","genUrl","pathDel","paramsToStr","params","HttpPouch","dbUrl","setupPromise","ourFetch","headers","credentials","nAuth","token","ua","isIE","isTrident","isEdge","isGET","shouldCacheBust","now","adapterFun$$1","setup","fetchJSON","response","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","promiseFactories","doNext","runNextBatch","onError","thisErr","pool","typeFieldDescriptor","__proto__","fetchData","docOrDocs","contentType","process","browser","paramStr","batch_size","heartbeat","requestTimeout","timeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","aborted","fetchOpts","signal","fetched","raw_results_length","finished","QueryParseError","NotFoundError","BuiltInError","promisedCallback","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createView","sourceDB","reduceFun","temporary","localDocName","cachedViews","viewSignature","createViewSignature","_cachedViews","promiseForView","depDbName","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","parseViewName","emitError","builtInReduce","sumsqr","_sumsqr","abstract","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","checkQueryParseError","startkeyName","endkeyName","group_level","optionName","checkPositiveInteger","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","isGenOne","getKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","processKeyValueDocs","getQueue","updateView","mapResults","currentSeq","listOfDocsToPersist","docsToPersist","saveKeyValues","processNextBatch","createIndexableKeysToKeyValues","createDocIdsToChangesAndEmits","emittedKeyValue","complexKey","updateViewInQueue","queryView","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","parsedNum","parsedStr","arrayElement","objElement","parseIndexableString","onMapResultsReady","finalResults","shouldGroup","lvl","POSITIVE_INFINITY","groupKey","reduceTry","reduceView","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","queryViewInQueue","queryPromised","_query","customQuery","keysAsString","httpQuery","finalPromiseFactory","designDocName","stale","coerceOptions","viewCleanup","_viewCleanup","customViewCleanup","httpViewCleanup","docsToViews","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","destroyPromises","localViewCleanup","createAbstractMapReduce","origMap","reduceFunString","builtIn","getBuiltIn","mapreduce","isGenOne$1","getDocAttachments","getDocs","diffs","resultDocs","fetchRevisionOneDocs","hasConflicts","bulkGetOpts","missingRev","createBulkGetOpts","bulkGetResponse","bulkGetInfo","remoteDoc","doCheckForLocalAttachments","fileHasChanged","getDocAttachmentsFromTargetOrSource","Boolean","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","hasSessionId","compareReplicationLogs","sessionId","props","floor","getCheckpoint","generateReplicationId","queryParams","filterViewName","sortObjectPropertiesByKey","queryData","md5sum","replicate","currentBatch","repId","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getBatchDocs","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","retry","back_off_function","backOffSet","current_back_off","backOff","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","out","success","_readyCalled","replicateMethods","other","parseManifest","manifest","NeumeEdit","TextEdit","TextView","prepareEditMode","textView","View","Display","image","title","core","Info","setupEdit","initDb","delay","pageNo","getCurrentPage","changePage","redo","undo","pageURI","elementID","updateDatabase","getAnnotations","timestamp","readAsDataURL","deleteDb","getMEI","mei","getSVG","v1","arrayPrefix","objPrefix","numChar","parsedString","lastCh","numConsecutiveSlashes","className","handleZoom","displayControlsPanel","addUpdateCallback","updateVisualization","DisplayControls","setZoomControls","initDisplayControls","setOpacityFromSlider","updateCallbacks","divaReady","diva","Diva","objectData","minHeight","indexMap","disableDragScrollable","displayPanel","loadDelay","initDivaEvents","setViewEventHandlers","onresize","innerHeight","innerWidth","Events","subscribe","settings","ID","didLoad","adjustZoom","pageIndex","checkAndLoad","page","getPageSVG","svg","updateSVG","containerId","pageIndexes","getActivePageIndex","zoomDuration","firstChild","inner","dimensions","getPageDimensionsAtCurrentZoomLevel","viewHandler","_viewerCore","getPageRegion","includePadding","incorporateViewport","marginLeft","getComputedStyle","getPropertyValue","top","setDisplayListeners","findIndex","visibility","clear","sequence","sequences","canvases","itemTitle","pages","panel","createElementNS","bg","setAttributeNS","hasAttribute","replaceChild","resetTransformations","_page","_delay","restoreTransformation","setSelectListeners","touches","scrollZoom","newHeight","initEditModeControls","insertHandler","bindInsertTabs","click","Select","setSelectHelperObjects","initInsertEditControls","editMenu","backgroundColor","setSelectStrokeWidth","initSelectionButtons","setHighlightSelectionControls","isInsertMode","clickSelect","dragSelect","neumeGroups","updateInfoVisibility","neumeInfo","checked","setInfoControls","block","label","resetInfoListeners","updateInfo","stopListeners","elementClass","attributes","ncs","getContour","ligated","pitches","getPitches","toUpperCase","updateInfoModule","pitchNameToNum","innerText","pname","cont","entries","notificationSent","textLabel","bboxLabel","textButton","bboxButton","setTextViewControls","updateTextViewVisibility","updateBBoxViewVisibility","initSelectByBBoxButton","sylText","getSylText","text","initTextEdit","lyrics","selBySylListener","addBBoxListeners","updateSylText","button","orig","corrected","prompt","copyAttributes","array1","array2","staffBasedMei","DOMParser","serializer","XMLSerializer","meiDoc","parseFromString","precedesSyllables","section","getElementsByTagName","newStaff","newLayer","layer","sb","custos","lastElementChild","lastElement","followsId","followsSyllable","previousElementSibling","firstElementChild","serializeToString","sbBasedMei","originalStaves","sbArray","origSyllable","neumeBehind","neumeAhead","childArray","sbIndex","ind","insertAdjacentElement","newSyllable","debug","sbs","currentSb","nextSb","childrenArray","copyArray","insertBefore","msCrypto","rnds8","rnds","byteToHex","bth","activate","insertActive","deactivate","editMode","initEditMode","tabIds","tab","selectedOption","insertDisabled","bindElements","toggleInsert","toggleEdit","insertContents","editContents","selBySyl","selByNeume","selByNc","selByStaff","selectBySylHandler","selectByNeumeHandler","selectByNcHandler","selectByStaffHandler","groupingAction","getChildrenIds","getIds","syllable0","syllable1","secondSyllable","groupType","neumeParent","Warnings","groupingNotRecognized","childrenIds","PointNames","TopLeft","Top","TopRight","Right","BottomRight","Bottom","BottomLeft","Left","GetPoints","sin","initialPoint","initialUly","initialLry","initialRectY","polyLen","initialRotate","redraw","pointString","_elem","pointName","point","pointStringRight","pointStringLeft","drawInitialRect","whichPoint","viewportElement","resizeStart","resizeDrag","resizeEnd","rotateStart","temp","tempRotate","rotateEnd","which","PI","currentPoint","firstClick","removeInsertClickHandlers","keydownListener","resetInsertHandler","clickawayHandler","insertMenu","staffHandler","cursorpt","coord","buttonId","alreadyInInsertMode","editModeButton","getGetParam","manifestLocation","storage","statusText","Response","location","verovioWrapper","Validation","undoStacks","redoStacks","neonCache","blankPages","annotations","mei_annotations","lastPageLoaded","annotation","timeZoneRegexp","getTime","newAnnotation","loadData","blankPage","convertSbToStaff","dirty","sendForValidation","handle","loadPage","entry","currentMEI","updateCache","svgText","meiPromise","svgPromise","updateTimestamp","pair","schemaResponse","worker","statusField","updateUI","line","link","panelBlock","pNotif","Worker","meiData","verovioWorker","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","currentQueue","queueIndex","cleanUpNextTick","drainQueue","run","marker","runClearTimeout","Item","noop","env","argv","versions","binding","cwd","chdir","dir","umask","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","clockseq","seedBytes","msecs","nsecs","dt","tl","tmh","ii","NeonSchema","NeonContext","manifestString","Validator","attribute","unresolvedRefs","types","validators","shouldResolve","addSchema","ourUri","addSubSchemaArray","addSubSchema","addSubSchemaObject","setSchemas","getSchema","urn","sch","validateSchema","switchSchema","schemaobj","schemaTraverser","superResolve","resolved","subctx","subschema","skipAttributes","ignoreProperties","validatorErr","allowUnknownAttributes","rewrite","parsed","fragment","testType","isFinite","integer","boolean","date","any","nodeType","freeGlobal","maxInt","regexPunycode","regexNonASCII","regexSeparators","stringFromCharCode","fn","mapDomain","ucs2decode","extra","counter","ucs2encode","digitToBasic","digit","flag","adapt","numPoints","firstTime","baseMinusTMin","decode","basic","oldi","baseMinusT","codePoint","inputLength","bias","encode","handledCPCount","basicLength","q","currentValue","handledCPCountPlusOne","qMinusT","webpackPolyfill","deprecate","qs","sep","eq","maxKeys","kstr","vstr","xs","stringifyPrimitive","objectKeys","ks","f","testSchemaNoThrow","testAdditionalProperty","preValidateProperty","nestedErrors","minProperties","maxProperties","minimum","exclusiveMinimum","maximum","exclusiveMaximum","validateMultipleOfOrDivisbleBy","validationType","errorMessage","validationArgument","instanceDecimals","divisorDecimals","maxDecimals","multiplier","pow","testArrays","multipleOf","divisibleBy","required","minLength","hsp","maxLength","minItems","maxItems","uniqueItems","dep","childContext","notTypes","schemaId","startEditMode","navbarDropdownMenu","undoRedoPanel","initNavbar","initUndoRedoPanel","selectionHighlight","divider","save","export","download","confirm","reload","getPageMEI","convertStaffToSb","getPageName","undoHandler","redoHandler","editItem","editButton","fileLink","navbarContents","navbarFinalize","ViewBox","imageWidth","imageHeight","z","zoomHeight","zoomWidth","ZoomHandler","bgimg","viewBox","updateViewBox","getViewBox","translate","rawViewBox","dragCoordinates","matrix","newCoordinates","deltaX","deltaY","newTransform","dragTransform","slider","newK","getZoom","cursorPt","splitDisable","capture","resetHandler"],"mappings":"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","file":"editor.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 38);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","module.exports = d3;","import * as Color from './Color';\nimport { updateHighlight } from '../DisplayPanel/DisplayControls';\nimport * as Grouping from '../SquareEdit/Grouping';\nimport { resize } from './Resize';\nimport { Attributes } from '../Types';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport * as SelectOptions from '../SquareEdit/SelectOptions';\n\nimport * as d3 from 'd3';\n/**\n * @returns The selection mode chosen by the user.\n */\nexport function getSelectionType (): string {\n  const element = document.getElementsByClassName('sel-by is-active');\n  if (element.length !== 0) {\n    return element[0].id;\n  } else {\n    return null;\n  }\n}\n\n/**\n * Unselect all selected elements and run undo any extra\n * actions.\n */\nexport function unselect (): void {\n  document.querySelectorAll('.selected').forEach((selected: SVGGElement) => {\n    selected.classList.remove('selected');\n    if (selected.classList.contains('staff')) {\n      selected.removeAttribute('style');\n      Color.unhighlight(selected);\n    } else {\n      selected.removeAttribute('style');\n      selected.style.fill = '';\n    }\n  });\n  Array.from(document.getElementsByClassName('text-select')).forEach((el: SVGElement) => {\n    el.style.color = '';\n    el.style.fontWeight = '';\n    el.classList.remove('text-select');\n  });\n  Array.from(document.getElementsByClassName('sylTextRect-display')).forEach((sylRect: HTMLElement) => {\n    sylRect.style.fill = 'blue';\n  });\n\n  Array.from(document.getElementsByClassName('syllable-highlighted')).forEach((syllable: HTMLElement) => {\n    syllable.style.fill = '';\n    syllable.classList.add('syllable');\n    syllable.classList.remove('syllable-highlighted');\n  });\n\n  d3.selectAll('#resizeRect').remove();\n  d3.selectAll('.resizePoint').remove();\n  d3.selectAll('.rotatePoint').remove();\n\n  if (!document.getElementById('selByStaff').classList.contains('is-active')) {\n    Grouping.endGroupingSelection();\n  } else {\n    SelectOptions.endOptionsSelection();\n  }\n  document.getElementById('extraEdit').innerHTML = '';\n  document.getElementById('extraEdit').classList.add('is-invisible');\n  updateHighlight();\n}\n\n/**\n * Generic select function.\n * @param el - Element to select.\n * @param dragHandler - Only used for staves.\n */\nexport function select (el: SVGGraphicsElement, dragHandler?: DragHandler): void {\n  if (el.classList.contains('staff')) {\n    return selectStaff(el, dragHandler);\n  }\n  if (!el.classList.contains('selected') && !el.classList.contains('sylTextRect') &&\n      !el.classList.contains('sylTextRect-display')) {\n    el.classList.add('selected');\n    el.style.fill = '#d00';\n    if (el.querySelectorAll('.sylTextRect-display').length) {\n      el.querySelectorAll('.sylTextRect-display').forEach((elem: HTMLElement) => {\n        elem.style.fill = 'red';\n      });\n    }\n    let sylId;\n    if (el.classList.contains('syllable')) {\n      sylId = el.id;\n    } else if (el.closest('.syllable') !== null) {\n      sylId = el.closest('.syllable').id;\n    }\n    if (sylId !== undefined) {\n      const spans = document.querySelectorAll('span.' + sylId);\n      spans.forEach((span: HTMLElement) => {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      });\n    }\n  }\n  updateHighlight();\n}\n\n/**\n * Select an nc.\n * @param el - The neume component.\n */\nexport async function selectNcs (el: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  if (!el.parentElement.classList.contains('selected')) {\n    const parent = el.parentElement as unknown as SVGGraphicsElement;\n    unselect();\n    select(parent);\n    if (await isLigature(parent, neonView)) {\n      const prevNc = parent.previousSibling as unknown as SVGGraphicsElement;\n      if (await isLigature(prevNc, neonView)) {\n        select(prevNc);\n      } else {\n        const nextNc = parent.nextSibling as unknown as SVGGraphicsElement;\n        if (await isLigature(nextNc, neonView)) {\n          select(nextNc);\n        } else {\n          console.warn('Error: Neither prev or next nc are ligatures');\n        }\n      }\n      Grouping.triggerGrouping('ligature');\n    } else if (parent.classList.contains('nc')) {\n      SelectOptions.triggerNcActions(parent);\n    } else {\n      console.warn('No action triggered!');\n    }\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * @param nc - The neume component.\n * @param neonView - The [[NeonView]] for this instance.\n * @returns True if the neume component is part of a ligature.\n */\nexport async function isLigature (nc: SVGGraphicsElement, neonView: NeonView): Promise<boolean> {\n  const attributes: Attributes = await neonView.getElementAttr(nc.id, neonView.view.getCurrentPageURI());\n  return (attributes.ligated);\n}\n\n/**\n * @param elements - The elements to compare.\n * @returns True if the elements have the same parent up two levels, otherwise false.\n */\nexport function sharedSecondLevelParent (elements: SVGElement[]): boolean {\n  const tempElements = Array.from(elements);\n  const firstElement = tempElements.pop();\n  const secondParent = firstElement.parentElement.parentElement;\n  for (const element of tempElements) {\n    const secPar = element.parentElement.parentElement;\n    if (secPar.id !== secondParent.id) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Get the bounding box of a staff based on its staff lines.\n * Rotate is included in radians.\n */\nexport function getStaffBBox (staff: SVGGElement): {ulx: number; uly: number; lrx: number; lry: number; rotate: number} {\n  let ulx, uly, lrx, lry, rotate;\n  staff.querySelectorAll('path').forEach(path => {\n    const coordinates: number[] = path.getAttribute('d')\n      .match(/\\d+/g)\n      .map(element => Number(element));\n    if (rotate === undefined) {\n      rotate = Math.atan((coordinates[3] - coordinates[1]) /\n        (coordinates[2] - coordinates[0]));\n    }\n\n    if (uly === undefined || Math.min(coordinates[1], coordinates[3]) < uly) {\n      uly = Math.min(coordinates[1], coordinates[3]);\n    }\n    if (ulx === undefined || coordinates[0] < ulx) {\n      ulx = coordinates[0];\n    }\n    if (lry === undefined || Math.max(coordinates[1], coordinates[3]) > lry) {\n      lry = Math.max(coordinates[1], coordinates[3]);\n    }\n    if (lrx === undefined || coordinates[2] > lrx) {\n      lrx = coordinates[2];\n    }\n  });\n  return { 'ulx': ulx, 'uly': uly, 'lrx': lrx, 'lry': lry, 'rotate': rotate };\n}\n\n/**\n * select a boundingbox element\n * @param el - the bbox (sylTextRect) element in the DOM\n * @param dragHandler - the drag handler in use\n */\nexport function selectBBox (el: SVGGraphicsElement, dragHandler: DragHandler, neonView: NeonView): void {\n  const bbox = el;\n  const syl = bbox.closest('.syl');\n  if (!syl.classList.contains('selected')) {\n    syl.classList.add('selected');\n    bbox.style.fill = '#d00';\n    const closest = el.closest('.syllable') as HTMLElement;\n    closest.style.fill = 'red';\n    closest.classList.add('syllable-highlighted');\n    if (neonView !== undefined ){\n      resize(syl as SVGGraphicsElement, neonView, dragHandler);\n    }\n    if (dragHandler !== undefined) {\n      dragHandler.dragInit();\n    }\n    const sylId = el.closest('.syllable').id;\n    if (sylId !== undefined) {\n      const span: HTMLSpanElement = document.querySelector('span.' + sylId);\n      if (span) {\n        span.style.color = '#d00';\n        span.style.fontWeight = 'bold';\n        span.classList.add('text-select');\n      }\n    }\n  }\n}\n\n/**\n * Select not neume elements.\n * @param notNeumes - An array of not neumes elements.\n */\nexport function selectNn (notNeumes: SVGGraphicsElement[]): boolean {\n  if (notNeumes.length > 0) {\n    notNeumes.forEach(nn => { select(nn); });\n    return false;\n  } else {\n    return true;\n  }\n}\n\n/**\n * Select a staff element.\n * @param staff - The staff element in the DOM.\n * @param dragHandler - The drag handler in use.\n */\nexport function selectStaff (staff: SVGGElement, dragHandler: DragHandler): void {\n  if (!staff.classList.contains('selected')) {\n    staff.classList.add('selected');\n    Color.unhighlight(staff);\n    Color.highlight(staff, '#d00');\n    dragHandler.dragInit();\n  }\n}\n\n/**\n * Handle selecting an array of elements based on the selection type.\n */\nexport async function selectAll (elements: Array<SVGGraphicsElement>, neonView: NeonView, dragHandler: DragHandler): Promise<void> {\n  const selectionType = getSelectionType();\n  unselect();\n  if (elements.length === 0) {\n    return;\n  }\n\n  let selectionClass;\n  let containsClefOrCustos = false;\n\n  switch (selectionType) {\n    case 'selBySyl':\n      selectionClass = '.syllable';\n      break;\n    case 'selByNeume':\n      selectionClass = '.neume';\n      break;\n    case 'selByNc':\n      selectionClass = '.nc';\n      break;\n    case 'selByStaff':\n      selectionClass = '.staff';\n      break;\n    case 'selByBBox':\n      selectionClass = '.sylTextRect-display';\n      break;\n    default:\n      console.error('Unknown selection type ' + selectionType);\n      return;\n  }\n\n  // Get the groupings specified by selectionClass\n  // that contain the provided elements to select.\n  const groupsToSelect = new Set();\n  for (const element of elements) {\n    let grouping = element.closest(selectionClass);\n    if (grouping === null) {\n      // Check if we click-selected a clef or a custos\n      grouping = element.closest('.clef, .custos');\n      if (grouping === null) {\n        console.warn('Element ' + element.id + ' is not part of specified group and is not a clef or custos.');\n        continue;\n      }\n      containsClefOrCustos = containsClefOrCustos || true;\n    }\n    groupsToSelect.add(grouping);\n\n    // Check for precedes/follows\n    const follows = grouping.getAttribute('mei:follows');\n    if (follows) {\n      groupsToSelect.add(document.getElementById(follows.slice(1)));\n    }\n    const precedes = grouping.getAttribute('mei:precedes');\n    if (precedes) {\n      groupsToSelect.add(document.getElementById(precedes.slice(1)));\n    }\n  }\n\n  // Select the elements\n  groupsToSelect.forEach((group: SVGGraphicsElement) => { select(group, dragHandler); });\n\n  /* Determine the context menu to display (if any) */\n\n  const groups = Array.from(groupsToSelect.values()) as SVGGraphicsElement[];\n\n  // Handle occurance of clef or custos\n  if (containsClefOrCustos) {\n    // A context menu will only be displayed if there is a single clef\n    if (groupsToSelect.size === 1 && groups[0].classList.contains('clef')) {\n      SelectOptions.triggerClefActions(groups[0]);\n    } else if (groupsToSelect.size === 1 && groups[0].classList.contains('custos')) {\n      SelectOptions.triggerCustosActions();\n    } else {\n      if (selectionType == 'selBySyl') {\n        SelectOptions.triggerDefaultSylActions();\n      } else {\n        SelectOptions.triggerDefaultActions();\n      }\n    }\n    return;\n  }\n\n  switch (selectionType) {\n    case 'selByStaff':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerSplitActions();\n          resize(groups[0], neonView, dragHandler);\n          break;\n        default:\n          SelectOptions.triggerStaffActions();\n      }\n      break;\n\n    case 'selBySyl':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a neume/nc.\n          SelectOptions.triggerSylActions();\n          break;\n        case 2:\n          // Check if this is a linked syllable split by a staff break\n          if ((groups[0].getAttribute('mei:follows') === '#' + groups[1].id) ||\n          (groups[0].getAttribute('mei:precedes') === '#' + groups[1].id)) {\n            Grouping.triggerGrouping('splitSyllable');\n          } else if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            // Check if this *could* be a selection with a single logical syllable split by a staff break.\n            const staff0 = groups[0].closest('.staff');\n            const staff1 = groups[1].closest('.staff');\n            const staffChildren = Array.from(staff0.parentElement.children);\n            // Check if these are adjacent staves (logically)\n            if (Math.abs(staffChildren.indexOf(staff0) - staffChildren.indexOf(staff1)) === 1) {\n              // Check if one syllable is the last in the first staff and the other is the first in the second.\n              // Determine which staff is first.\n              const firstStaff = (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) ? staff0 : staff1;\n              const secondStaff = (firstStaff.id === staff0.id) ? staff1 : staff0;\n              const firstLayer = firstStaff.querySelector('.layer');\n              const secondLayer = secondStaff.querySelector('.layer');\n\n              // Check that the first staff has either syllable as the last syllable\n              const firstSyllableChildren = Array.from(firstLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const secondSyllableChildren = Array.from(secondLayer.children)\n                .filter((elem: HTMLElement) => elem.classList.contains('syllable')) as HTMLElement[];\n              const lastSyllable = firstSyllableChildren[firstSyllableChildren.length - 1];\n              const firstSyllable = secondSyllableChildren[0];\n              if (lastSyllable.id === groups[0].id && firstSyllable.id === groups[1].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              } else if (lastSyllable.id === groups[1].id && firstSyllable.id === groups[0].id) {\n                Grouping.triggerGrouping('splitSyllable');\n                break;\n              }\n            }\n            SelectOptions.triggerDefaultSylActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('syl');\n          } else {\n            SelectOptions.triggerDefaultSylActions();\n          }\n      }\n      break;\n\n    case 'selByNeume':\n      switch (groups.length) {\n        case 1:\n          // TODO change context if it is only a nc.\n          SelectOptions.triggerNeumeActions();\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('neume');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n\n    case 'selByNc':\n      switch (groups.length) {\n        case 1:\n          SelectOptions.triggerNcActions(groups[0]);\n          break;\n        case 2:\n          if (sharedSecondLevelParent(groups)) {\n            // Check if this selection is a ligature or can be a ligature\n            // Check if these neume components are part of the same neume\n            if (groups[0].parentElement === groups[1].parentElement) {\n              const children = Array.from(groups[0].parentElement.children);\n              // Check that neume components are adjacent\n              if (Math.abs(children.indexOf(groups[0]) - children.indexOf(groups[1])) === 1) {\n                // Check that second neume component is lower than first.\n                // Note that the order in the list may not be the same as the\n                // order by x-position.\n                const orderFirstX = (groups[0].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                const orderSecondX = (groups[1].children[0] as SVGUseElement)\n                  .x.baseVal.value;\n                let posFirstY, posSecondY;\n\n                if (orderFirstX < orderSecondX) {\n                  posFirstY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                } else {\n                  posFirstY = (groups[1].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                  posSecondY = (groups[0].children[0] as SVGUseElement)\n                    .y.baseVal.value;\n                }\n\n                // Also ensure both components are marked or not marked as ligatures.\n                const isFirstLigature = await isLigature(groups[0], neonView);\n                const isSecondLigature = await isLigature(groups[1], neonView);\n                if ((posSecondY > posFirstY) && !(isFirstLigature !== isSecondLigature)) {\n                  Grouping.triggerGrouping('ligature');\n                  break;\n                }\n              }\n            }\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n          break;\n        default:\n          if (sharedSecondLevelParent(groups)) {\n            Grouping.triggerGrouping('nc');\n          } else {\n            SelectOptions.triggerDefaultActions();\n          }\n      }\n      break;\n    case 'selByBBox':\n      switch (groups.length) {\n        case 1:\n          selectBBox(groups[0], dragHandler, neonView);\n          break;\n        default:\n          groups.forEach(g => selectBBox(g, dragHandler, undefined));\n          break;\n      }\n      break;\n    default:\n      console.error('Unknown selection type. This should not have occurred.');\n  }\n}\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\n\nvar uri = require('url');\n\nvar ValidationError = exports.ValidationError = function ValidationError (message, instance, schema, propertyPath, name, argument) {\n  if (propertyPath) {\n    this.property = propertyPath;\n  }\n  if (message) {\n    this.message = message;\n  }\n  if (schema) {\n    if (schema.id) {\n      this.schema = schema.id;\n    } else {\n      this.schema = schema;\n    }\n  }\n  if (instance) {\n    this.instance = instance;\n  }\n  this.name = name;\n  this.argument = argument;\n  this.stack = this.toString();\n};\n\nValidationError.prototype.toString = function toString() {\n  return this.property + ' ' + this.message;\n};\n\nvar ValidatorResult = exports.ValidatorResult = function ValidatorResult(instance, schema, options, ctx) {\n  this.instance = instance;\n  this.schema = schema;\n  this.propertyPath = ctx.propertyPath;\n  this.errors = [];\n  this.throwError = options && options.throwError;\n  this.disableFormat = options && options.disableFormat === true;\n};\n\nValidatorResult.prototype.addError = function addError(detail) {\n  var err;\n  if (typeof detail == 'string') {\n    err = new ValidationError(detail, this.instance, this.schema, this.propertyPath);\n  } else {\n    if (!detail) throw new Error('Missing error detail');\n    if (!detail.message) throw new Error('Missing error message');\n    if (!detail.name) throw new Error('Missing validator type');\n    err = new ValidationError(detail.message, this.instance, this.schema, this.propertyPath, detail.name, detail.argument);\n  }\n\n  if (this.throwError) {\n    throw err;\n  }\n  this.errors.push(err);\n  return err;\n};\n\nValidatorResult.prototype.importErrors = function importErrors(res) {\n  if (typeof res == 'string' || (res && res.validatorType)) {\n    this.addError(res);\n  } else if (res && res.errors) {\n    Array.prototype.push.apply(this.errors, res.errors);\n  }\n};\n\nfunction stringizer (v,i){\n  return i+': '+v.toString()+'\\n';\n}\nValidatorResult.prototype.toString = function toString(res) {\n  return this.errors.map(stringizer).join('');\n};\n\nObject.defineProperty(ValidatorResult.prototype, \"valid\", { get: function() {\n  return !this.errors.length;\n} });\n\n/**\n * Describes a problem with a Schema which prevents validation of an instance\n * @name SchemaError\n * @constructor\n */\nvar SchemaError = exports.SchemaError = function SchemaError (msg, schema) {\n  this.message = msg;\n  this.schema = schema;\n  Error.call(this, msg);\n  Error.captureStackTrace(this, SchemaError);\n};\nSchemaError.prototype = Object.create(Error.prototype,\n  { constructor: {value: SchemaError, enumerable: false}\n  , name: {value: 'SchemaError', enumerable: false}\n  });\n\nvar SchemaContext = exports.SchemaContext = function SchemaContext (schema, options, propertyPath, base, schemas) {\n  this.schema = schema;\n  this.options = options;\n  this.propertyPath = propertyPath;\n  this.base = base;\n  this.schemas = schemas;\n};\n\nSchemaContext.prototype.resolve = function resolve (target) {\n  return uri.resolve(this.base, target);\n};\n\nSchemaContext.prototype.makeChild = function makeChild(schema, propertyName){\n  var propertyPath = (propertyName===undefined) ? this.propertyPath : this.propertyPath+makeSuffix(propertyName);\n  var base = uri.resolve(this.base, schema.id||'');\n  var ctx = new SchemaContext(schema, this.options, propertyPath, base, Object.create(this.schemas));\n  if(schema.id && !ctx.schemas[base]){\n    ctx.schemas[base] = schema;\n  }\n  return ctx;\n}\n\nvar FORMAT_REGEXPS = exports.FORMAT_REGEXPS = {\n  'date-time': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\\.\\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,\n  'date': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,\n  'time': /^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,\n\n  'email': /^(?:[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)*[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!\\.)){0,61}[a-zA-Z0-9]?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\\[(?:(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\.){3}(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\]))$/,\n  'ip-address': /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n  'ipv6': /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/,\n  'uri': /^[a-zA-Z][a-zA-Z0-9+-.]*:[^\\s]*$/,\n\n  'color': /^(#?([0-9A-Fa-f]{3}){1,2}\\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\\(\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*\\))|(rgb\\(\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*\\)))$/,\n\n  // hostname regex from: http://stackoverflow.com/a/1420225/5628\n  'hostname': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n  'host-name': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n\n  'alpha': /^[a-zA-Z]+$/,\n  'alphanumeric': /^[a-zA-Z0-9]+$/,\n  'utc-millisec': function (input) {\n    return (typeof input === 'string') && parseFloat(input) === parseInt(input, 10) && !isNaN(input);\n  },\n  'regex': function (input) {\n    var result = true;\n    try {\n      new RegExp(input);\n    } catch (e) {\n      result = false;\n    }\n    return result;\n  },\n  'style': /\\s*(.+?):\\s*([^;]+);?/,\n  'phone': /^\\+(?:[0-9] ?){6,14}[0-9]$/\n};\n\nFORMAT_REGEXPS.regexp = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.pattern = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.ipv4 = FORMAT_REGEXPS['ip-address'];\n\nexports.isFormat = function isFormat (input, format, validator) {\n  if (typeof input === 'string' && FORMAT_REGEXPS[format] !== undefined) {\n    if (FORMAT_REGEXPS[format] instanceof RegExp) {\n      return FORMAT_REGEXPS[format].test(input);\n    }\n    if (typeof FORMAT_REGEXPS[format] === 'function') {\n      return FORMAT_REGEXPS[format](input);\n    }\n  } else if (validator && validator.customFormats &&\n      typeof validator.customFormats[format] === 'function') {\n    return validator.customFormats[format](input);\n  }\n  return true;\n};\n\nvar makeSuffix = exports.makeSuffix = function makeSuffix (key) {\n  key = key.toString();\n  // This function could be capable of outputting valid a ECMAScript string, but the\n  // resulting code for testing which form to use would be tens of thousands of characters long\n  // That means this will use the name form for some illegal forms\n  if (!key.match(/[.\\s\\[\\]]/) && !key.match(/^[\\d]/)) {\n    return '.' + key;\n  }\n  if (key.match(/^\\d+$/)) {\n    return '[' + key + ']';\n  }\n  return '[' + JSON.stringify(key) + ']';\n};\n\nexports.deepCompareStrict = function deepCompareStrict (a, b) {\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (a instanceof Array) {\n    if (!(b instanceof Array)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    return a.every(function (v, i) {\n      return deepCompareStrict(a[i], b[i]);\n    });\n  }\n  if (typeof a === 'object') {\n    if (!a || !b) {\n      return a === b;\n    }\n    var aKeys = Object.keys(a);\n    var bKeys = Object.keys(b);\n    if (aKeys.length !== bKeys.length) {\n      return false;\n    }\n    return aKeys.every(function (v) {\n      return deepCompareStrict(a[v], b[v]);\n    });\n  }\n  return a === b;\n};\n\nfunction deepMerger (target, dst, e, i) {\n  if (typeof e === 'object') {\n    dst[i] = deepMerge(target[i], e)\n  } else {\n    if (target.indexOf(e) === -1) {\n      dst.push(e)\n    }\n  }\n}\n\nfunction copyist (src, dst, key) {\n  dst[key] = src[key];\n}\n\nfunction copyistWithDeepMerge (target, src, dst, key) {\n  if (typeof src[key] !== 'object' || !src[key]) {\n    dst[key] = src[key];\n  }\n  else {\n    if (!target[key]) {\n      dst[key] = src[key];\n    } else {\n      dst[key] = deepMerge(target[key], src[key])\n    }\n  }\n}\n\nfunction deepMerge (target, src) {\n  var array = Array.isArray(src);\n  var dst = array && [] || {};\n\n  if (array) {\n    target = target || [];\n    dst = dst.concat(target);\n    src.forEach(deepMerger.bind(null, target, dst));\n  } else {\n    if (target && typeof target === 'object') {\n      Object.keys(target).forEach(copyist.bind(null, target, dst));\n    }\n    Object.keys(src).forEach(copyistWithDeepMerge.bind(null, target, src, dst));\n  }\n\n  return dst;\n};\n\nmodule.exports.deepMerge = deepMerge;\n\n/**\n * Validates instance against the provided schema\n * Implements URI+JSON Pointer encoding, e.g. \"%7e\"=\"~0\"=>\"~\", \"~1\"=\"%2f\"=>\"/\"\n * @param o\n * @param s The path to walk o along\n * @return any\n */\nexports.objectGetPath = function objectGetPath(o, s) {\n  var parts = s.split('/').slice(1);\n  var k;\n  while (typeof (k=parts.shift()) == 'string') {\n    var n = decodeURIComponent(k.replace(/~0/,'~').replace(/~1/g,'/'));\n    if (!(n in o)) return;\n    o = o[n];\n  }\n  return o;\n};\n\nfunction pathEncoder (v) {\n  return '/'+encodeURIComponent(v).replace(/~/g,'%7E');\n}\n/**\n * Accept an Array of property names and return a JSON Pointer URI fragment\n * @param Array a\n * @return {String}\n */\nexports.encodePath = function encodePointer(a){\n\t// ~ must be encoded explicitly because hacks\n\t// the slash is encoded by encodeURIComponent\n\treturn a.map(pathEncoder).join('');\n};\n\n\n/**\n * Calculate the number of decimal places a number uses\n * We need this to get correct results out of multipleOf and divisibleBy\n * when either figure is has decimal places, due to IEEE-754 float issues.\n * @param number\n * @returns {number}\n */\nexports.getDecimalPlaces = function getDecimalPlaces(number) {\n\n  var decimalPlaces = 0;\n  if (isNaN(number)) return decimalPlaces;\n\n  if (typeof number !== 'number') {\n    number = Number(number);\n  }\n\n  var parts = number.toString().split('e');\n  if (parts.length === 2) {\n    if (parts[1][0] !== '-') {\n      return decimalPlaces;\n    } else {\n      decimalPlaces = Number(parts[1].slice(1));\n    }\n  }\n\n  var decimalParts = parts[0].split('.');\n  if (decimalParts.length === 2) {\n    decimalPlaces += decimalParts[1].length;\n  }\n\n  return decimalPlaces;\n};\n\n","/** @module DisplayPanel/DisplayControls */\n\nimport * as Color from '../utils/Color';\nimport ZoomHandler from '../SingleView/Zoom';\n\nlet lastGlyphOpacity: number, lastImageOpacity: number;\n\n/**\n * Initialize listeners and controls for display panel.\n * @param {string} meiClassName - The class used to signifiy the MEI element(s).\n * @param {string} background - The class used to signify the background.\n */\nexport function initDisplayControls (meiClassName: string, background: string): void {\n  setOpacityControls(meiClassName);\n  setBackgroundOpacityControls(background);\n  setHighlightControls();\n  setBurgerControls();\n\n  const displayContents = document.getElementById('displayContents');\n  const toggleDisplay = document.getElementById('toggleDisplay');\n\n  toggleDisplay.parentElement.addEventListener('click', () => {\n    if (displayContents.style.display === 'none') {\n      displayContents.style.display = '';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      displayContents.style.display = 'none';\n      toggleDisplay.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Set zoom control listener for button and slider\n * @param zoomHandler - A [[ZoomHandler]] is only necessary in Single Page mode as diva.js handles zooming otherwise.\n */\nexport function setZoomControls (zoomHandler?: ZoomHandler): void {\n  if (zoomHandler === undefined) {\n    return;\n  }\n  const zoomSlider = document.getElementById('zoomSlider') as HTMLInputElement;\n  const zoomOutput = document.getElementById('zoomOutput') as HTMLOutputElement;\n\n  zoomSlider.value = '100';\n  document.getElementById('reset-zoom').addEventListener('click', () => {\n    zoomOutput.value = '100';\n    zoomSlider.value = '100';\n    zoomHandler.resetZoomAndPan();\n  });\n\n  zoomSlider.addEventListener('input', inputChangeHandler);\n  zoomSlider.addEventListener('change', inputChangeHandler);\n\n  function inputChangeHandler (): void {\n    zoomOutput.value = zoomSlider.value;\n    zoomHandler.zoomTo(Number(zoomOutput.value) / 100.0);\n  }\n\n  document.body.addEventListener('keydown', (evt) => {\n    const currentZoom = parseInt(zoomOutput.value);\n    if (evt.key === '+') { // increase zoom by 20\n      const newZoom = Math.min(currentZoom + 20, parseInt(zoomSlider.getAttribute('max')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(newZoom);\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '-') { // decrease zoom by 20\n      const newZoom = Math.max(currentZoom - 20, parseInt(zoomSlider.getAttribute('min')));\n      zoomHandler.zoomTo(newZoom / 100.0);\n      zoomOutput.value = String(Math.round(newZoom));\n      zoomSlider.value = String(newZoom);\n    } else if (evt.key === '0') {\n      zoomOutput.value = '100';\n      zoomSlider.value = '100';\n      zoomHandler.resetZoomAndPan();\n    }\n  });\n}\n\n/**\n * Set rendered MEI opacity button and slider listeners.\n * @param meiClassName - Class that contains the rendered MEI.\n */\nfunction setOpacityControls (meiClassName: string): void {\n  lastGlyphOpacity = 100;\n  const opacitySlider = document.getElementById('opacitySlider') as HTMLInputElement;\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n\n  opacitySlider.value = '100';\n\n  document.getElementById('reset-opacity').addEventListener('click', () => {\n    // Definition scale is the root element of what is generated by verovio\n    const lowerOpacity = lastGlyphOpacity < 95 ? lastGlyphOpacity / 100.0 : 0;\n    const newOpacity = opacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.querySelectorAll('.' + meiClassName) as NodeListOf<HTMLElement>).forEach(g => {\n      g.style.opacity = newOpacity.toString();\n    });\n\n    lastGlyphOpacity = Number(opacitySlider.value);\n    opacitySlider.value = String(newOpacity * 100);\n    opacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  opacitySlider.addEventListener('input', inputChangeOpacity);\n  opacitySlider.addEventListener('change', inputChangeOpacity);\n\n  function inputChangeOpacity (): void {\n    opacityOutput.value = opacitySlider.value;\n    lastGlyphOpacity = Number(opacitySlider.value);\n    (document.querySelector('.' + meiClassName) as HTMLElement)\n      .style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Update MEI opacity to value from the slider.\n * @param meiClassName - Class that contains the rendered MEI.\n */\nexport function setOpacityFromSlider (meiClassName?: string): void {\n  const opacityOutput = document.getElementById('opacityOutput') as HTMLOutputElement;\n  opacityOutput.value = (document.getElementById('opacitySlider') as HTMLInputElement).value;\n  try {\n    ((document.querySelectorAll('.' + meiClassName)) as NodeListOf<HTMLElement>).forEach(g => {\n      g.style.opacity = (Number(opacityOutput.value) / 100.0).toString();\n    });\n  } catch (e) {}\n}\n\n/**\n * Set background image opacity button and slider listeners.\n * @param background - The background image selector.\n */\nfunction setBackgroundOpacityControls (background: string): void {\n  lastImageOpacity = 100;\n  const bgOpacitySlider = document.getElementById('bgOpacitySlider') as HTMLInputElement;\n  const bgOpacityOutput = document.getElementById('bgOpacityOutput') as HTMLOutputElement;\n\n  bgOpacitySlider.value = '100';\n  document.getElementById('reset-bg-opacity').addEventListener('click', () => {\n    const lowerOpacity = lastImageOpacity < 95 ? lastImageOpacity / 100.0 : 0;\n    const newOpacity = bgOpacitySlider.value === '100' ? lowerOpacity : 1;\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = newOpacity.toString();\n\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    bgOpacitySlider.value = String(newOpacity * 100);\n    bgOpacityOutput.value = String(Math.round(newOpacity * 100));\n  });\n\n  bgOpacitySlider.addEventListener('input', bgInputChangeHandler);\n  bgOpacitySlider.addEventListener('change', bgInputChangeHandler);\n\n  function bgInputChangeHandler (): void {\n    bgOpacityOutput.value = bgOpacitySlider.value;\n    lastImageOpacity = Number(bgOpacitySlider.value);\n    (document.getElementsByClassName(background)[0] as HTMLElement)\n      .style.opacity = (Number(bgOpacityOutput.value) / 100.0).toString();\n  }\n}\n\n/**\n * Set listener on staff highlighting checkbox.\n */\nexport function setHighlightControls (): void {\n  const highlightDropdown = document.getElementById('highlight-dropdown');\n  const highlightStaff = document.getElementById('highlight-staff');\n  const highlightSyllable = document.getElementById('highlight-syllable');\n  const highlightNeume = document.getElementById('highlight-neume');\n  const highlightNone = document.getElementById('highlight-none');\n  const highlightType = document.getElementById('highlight-type');\n\n  document.getElementById('highlight-button').addEventListener('click', (evt) => {\n    evt.stopPropagation();\n    highlightDropdown.classList.toggle('is-active');\n    if (highlightDropdown.classList.contains('is-active')) {\n      document.body.addEventListener('click', highlightClickaway);\n      highlightStaff.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightStaff.classList.add('highlight-selected');\n        highlightType.textContent = ' - Staff';\n        Color.setGroupingHighlight('staff');\n      });\n      highlightSyllable.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightSyllable.classList.add('highlight-selected');\n        highlightType.textContent = ' - Syllable';\n        Color.setGroupingHighlight('syllable');\n      });\n      highlightNeume.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightNeume.classList.add('highlight-selected');\n        highlightType.textContent = ' - Neume';\n        Color.setGroupingHighlight('neume');\n      });\n      highlightNone.addEventListener('click', () => {\n        highlightDropdown.classList.remove('is-active');\n        document.querySelectorAll('.highlight-selected').forEach(elem => {\n          elem.classList.remove('highlight-selected');\n        });\n        highlightType.textContent = ' - Off';\n        Color.unsetGroupingHighlight();\n      });\n    } else {\n      document.body.removeEventListener('click', highlightClickaway);\n    }\n  });\n}\n\nexport function setHighlightSelectionControls (): void {\n  const highlightSelection = document.getElementById('highlight-selection');\n  highlightSelection.addEventListener('click', () => {\n    document.getElementById('highlight-dropdown').classList.remove('is-active');\n    document.querySelectorAll('.highlight-selected').forEach(elem => {\n      elem.classList.remove('highlight-selected');\n    });\n    highlightSelection.classList.add('highlight-selected');\n    document.getElementById('highlight-type').textContent = ' - Selection';\n    Color.setGroupingHighlight('selection');\n  });\n}\n\n/**\n * Reset the highlight for different types based on the 'highlight-selected' class in the DOM.\n */\nexport function updateHighlight (): void {\n  let highlightId: string;\n  try {\n    highlightId = document.querySelector('.highlight-selected').id;\n  } catch (e) {\n    highlightId = '';\n  }\n  switch (highlightId) {\n    case 'highlight-staff':\n      Color.setGroupingHighlight('staff');\n      break;\n    case 'highlight-syllable':\n      Color.setGroupingHighlight('syllable');\n      break;\n    case 'highlight-neume':\n      Color.setGroupingHighlight('neume');\n      break;\n    case 'highlight-selection':\n      Color.setGroupingHighlight('selection');\n      break;\n    default:\n      Color.unsetGroupingHighlight();\n  }\n}\n\n/**\n * Set listener on burger menu for smaller screens.\n */\nfunction setBurgerControls (): void {\n  document.getElementById('burgerMenu').addEventListener('click', () => {\n    document.getElementById('burgerMenu').classList.toggle('is-active');\n    document.getElementById('navMenu').classList.toggle('is-active');\n  });\n}\n\n/**\n * Clickaway listener for the highlight dropdown.\n */\nfunction highlightClickaway (): void {\n  document.body.removeEventListener('click', highlightClickaway);\n  document.getElementById('highlight-dropdown').classList.remove('is-active');\n}\n","import { uuidv4 } from './random';\n\nconst notifications: Notification[] = new Array(0);\nlet currentModeMessage: Notification = null;\nlet notifying = false;\n\n/**\n * Number of notifications to display at a time.\n */\nconst NUMBER_TO_DISPLAY = 3;\n\n/**\n * Add a notification to the queue.\n * @param notification - Notification content.\n */\nexport function queueNotification (notification: string): void {\n  const notif = new Notification(notification);\n  notifications.push(notif);\n  if (!notifying || document.getElementById('notification-content').querySelectorAll('.neon-notification').length < NUMBER_TO_DISPLAY) {\n    startNotification();\n  }\n}\n\n/**\n * Start displaying notifications. Called automatically.\n */\nfunction startNotification (): void {\n  if (notifications.length > 0) {\n    notifying = true;\n    const currentNotification = notifications.pop();\n    displayNotification(currentNotification);\n    currentNotification.setTimeoutId(window.setTimeout(clearOrShowNextNotification, 5000, currentNotification.getId()));\n    document.getElementById(currentNotification.getId()).addEventListener('click', () => {\n      window.clearTimeout(currentNotification.timeoutID);\n      clearOrShowNextNotification(currentNotification.getId());\n    });\n  }\n}\n\n/**\n * Display a notification.\n * @param notification - Notification to display.\n */\nfunction displayNotification (notification: Notification): void {\n  if (notification.isModeMessage) {\n    if (currentModeMessage === null) {\n      currentModeMessage = notification;\n    } else {\n      window.clearTimeout(currentModeMessage.timeoutID);\n      notifications.push(notification);\n      clearOrShowNextNotification(currentModeMessage.getId());\n      return;\n    }\n  }\n  const notificationContent = document.getElementById('notification-content');\n  notificationContent.innerHTML += '<div class=\\'neon-notification\\' id=\\'' + notification.getId() + '\\'>' + notification.message + '</div> ';\n  notificationContent.style.display = '';\n  notification.display();\n}\n\n/**\n * Clear the notifications if no more exist or display another from the queue.\n * @param currentId - The ID of the notification to be cleared.\n */\nfunction clearOrShowNextNotification (currentId: string): void {\n  document.getElementById(currentId).remove();\n  if (currentModeMessage !== null && currentModeMessage.getId() === currentId) {\n    currentModeMessage = null;\n  }\n  if (notifications.length > 0) {\n    startNotification();\n  } else if (document.querySelectorAll('.neon-notification').length === 0) {\n    document.getElementById('notification-content').style.display = 'none';\n    notifying = false;\n  }\n}\n\n/**\n * A class to manage Neon notifications.\n */\nclass Notification {\n  message: string;\n  displayed: boolean;\n  id: string;\n  isModeMessage: boolean;\n  timeoutID: number;\n  /**\n   * Create a new notification.\n   * @param message - Notification content.\n   */\n  constructor (message: string) {\n    this.message = message;\n    this.displayed = false;\n    this.id = uuidv4();\n    this.isModeMessage = message.search('Mode') !== -1;\n    this.timeoutID = -1;\n  }\n\n  /** Set the ID from setTimeout. */\n  setTimeoutId (id: number): void {\n    this.timeoutID = Math.max(id, -1);\n  }\n\n  /** Display the Notification. */\n  display (): void {\n    this.displayed = true;\n  }\n\n  /**\n   * @returns The UUID for this notification.\n   */\n  getId (): string {\n    return this.id;\n  }\n}\n","/**\n * Adapted from color palette from Figure 2 (Colors optimized for color-blind\n * individuals) from\n * [\"Points of view: Color blindness\" by Bang Wong published in Nature Methods volume 8 on 27 May 2011](https://www.nature.com/articles/nmeth.1618?WT.ec_id=NMETH-201106)\n */\nconst ColorPalette: string[] = [\n  'rgb(230, 159, 0)',\n  'rgb(86, 180, 233)',\n  'rgb(0, 158, 115)',\n  'rgb(240, 228, 66)',\n  'rgb(0, 114, 178)',\n  'rgb(213, 94, 0)',\n  'rgb(204, 121, 167)'\n];\n\n/**\n * Remove the highlight from a staff.\n * @param staff If undefined, the all staves are unhighlighted.\n */\nexport function unhighlight (staff?: SVGGElement): void {\n  let children: NodeListOf<Element>;\n  if (staff) {\n    children = staff.querySelectorAll(':not(.selected) .highlighted');\n  } else {\n    children = document.querySelectorAll(':not(.selected) .highlighted');\n  }\n  children.forEach(elem => {\n    if (elem.tagName === 'path' && !elem.closest('.staff').classList.contains('selected')) {\n      elem.setAttribute('stroke', '#000000');\n    } else {\n      elem.removeAttribute('fill');\n      let rects = elem.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = elem.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        if (rect.closest('.syllable').classList.contains('selected') ||\n            rect.closest('.staff').classList.contains('selected') ||\n            rect.closest('.syl').classList.contains('selected')) {\n          rect.style.fill = 'red';\n        } else {\n          rect.style.fill = 'blue';\n        }\n        rect.classList.remove('highlighted');\n      });\n    }\n    elem.classList.remove('highlighted');\n  });\n}\n\n/**\n * Remove the highlight from each staff.\n */\nexport function unsetStaffHighlight (): void {\n  unhighlight();\n}\n\n/**\n * Unset highlight for all grouping types\n */\nexport function unsetGroupingHighlight (): void {\n  unsetStaffHighlight();\n  const highlighted = Array.from(document.getElementsByClassName('highlighted'))\n    .filter((elem: HTMLElement) => !elem.parentElement.classList.contains('selected'));\n  highlighted.forEach((elem: HTMLElement) => {\n    elem.setAttribute('fill', null);\n    let rects = elem.querySelectorAll('.sylTextRect-display');\n    if (!rects.length) {\n      if (elem.closest('.syllable') !== null) {\n        rects = elem.closest('.syllable').querySelectorAll('sylTextRect-display');\n      }\n    }\n    rects.forEach(function (rect: HTMLElement) {\n      if (rect.closest('.syllable').classList.contains('selected') || rect.closest('.syl').classList.contains('selected')) {\n        rect.style.fill = 'red';\n      } else {\n        rect.style.fill = 'blue';\n      }\n      rect.classList.remove('highlighted');\n    });\n    elem.classList.remove('highlighted');\n    elem.querySelectorAll('sylTextRect-display').forEach(rect => {\n      rect.classList.remove('highlighted');\n    });\n  });\n  Array.from(document.getElementsByClassName('selected')).forEach((el) => {el.setAttribute('fill', '');});\n}\n\n/**\n * Highlight a staff a certain color.\n */\nexport function highlight (staff: SVGGElement, color: string): void {\n  const children = Array.from(staff.children);\n  for (let i = 0; i < children.length; i++) {\n    const child = children[i];\n    if (child.tagName === 'path') {\n      child.setAttribute('stroke', color);\n    } else if (child.classList.contains('resizePoint') || child.id === 'resizeRect' || child.classList.contains('rotatePoint')) {\n      return;\n    } else if (child.classList.contains('layer')) {\n      Array.from(child.children).forEach(cchild => { children.push(cchild); });\n    } else if (document.getElementsByClassName('highlight-selected').length &&\n      document.getElementsByClassName('highlight-selected')[0].id === 'highlight-neume'\n      && child.classList.contains('syllable')) {\n      Array.from(child.children).filter(el => el.classList.contains('neume')).forEach(cchild => { children.push(cchild); });\n    } else {\n      child.setAttribute('fill', color);\n      let rects = child.querySelectorAll('.sylTextRect-display');\n      if (!rects.length) {\n        try {\n          rects = child.closest('.syllable').querySelectorAll('.sylTextRect-display');\n        } catch (e) {\n          rects = [] as unknown as NodeListOf<Element>;\n        }\n      }\n      rects.forEach(function (rect: HTMLElement) {\n        if (!(rect.closest('.syllable').classList.contains('selected') ||\n              rect.closest('.syl').classList.contains('selected') ||\n              rect.closest('.staff').classList.contains('selected'))) {\n          rect.style.fill = color;\n          rect.classList.add('highlighted');\n        }\n      });\n    }\n    child.classList.add('highlighted');\n  }\n  let width, height;\n  /*try {\n    width = Number(document.querySelector('.active-page').querySelector('svg').getAttribute('width').split('px')[0]);\n    height = Number(document.querySelector('.active-page').querySelector('svg').getAttribute('height').split('px')[0]);\n  } catch (e) {\n    console.debug(e);\n  }*/\n  let stroke: string;\n  if (width !== undefined && height !== undefined) {\n    // idk looks good :')\n    // TODO find a better way of calculating this as this actually doesn't work as well as 30px\n    stroke = (width*height/1000000).toString();\n  }\n  else {\n    stroke = '30px';\n  }\n  staff.querySelectorAll('.nc, .custos, .clef').forEach(el => {\n    el.setAttribute('stroke', 'black');\n    el.setAttribute('stroke-width', stroke);\n  });\n}\n\n/**\n * Highlight each staff a different color.\n */\nexport function setStaffHighlight (): void {\n  const staves = Array.from(document.getElementsByClassName('staff')) as SVGGElement[];\n  for (let i = 0; i < staves.length; i++) {\n    const staffColor = ColorPalette[i % ColorPalette.length];\n    highlight(staves[i], staffColor);\n  }\n}\n\n/**\n * Set a highlight by a different grouping.\n * @param grouping - Either \"staff\", \"syllable\", or \"neume\".\n */\nexport function setGroupingHighlight (grouping: string): void {\n  unsetGroupingHighlight();\n  if (grouping === 'staff') {\n    setStaffHighlight();\n    return;\n  } else if (grouping === 'selection') {\n    const temp = document.querySelector('.sel-by.is-active').id;\n    switch (temp) {\n      case 'selBySyl':\n      case 'selByBBox':\n        grouping = 'syllable';\n        break;\n      case 'selByStaff':\n        grouping = 'staff';\n        break;\n      default:\n        grouping = 'neume';\n        break;\n    }\n    setGroupingHighlight(grouping);\n    return;\n  }\n\n  const groups = document.getElementsByClassName(grouping) as HTMLCollectionOf<HTMLElement>;\n  for (let i = 0; i < groups.length; i++) {\n    const groupColor = ColorPalette[i % ColorPalette.length];\n    if ((groups[i].closest('.selected') === null) && !groups[i].classList.contains('selected')) {\n      groups[i].setAttribute('fill', groupColor);\n      const rects = groups[i].querySelectorAll('.sylTextRect-display') as NodeListOf<HTMLElement>;\n      rects.forEach(function (rect) {\n        if (rect.closest('.syl').classList.contains('selected') ||\n            rect.closest('.syllable').classList.contains('selected') ||\n            rect.closest('.staff').classList.contains('selected')) {\n          return;\n        }\n        rect.style.fill = groupColor;\n      });\n      groups[i].classList.add('highlighted');\n      groups[i].querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('highlighted');\n      });\n    } else {\n      if (!groups[i].classList.contains('selected')) {\n        groups[i].setAttribute('fill', null);\n      } else {\n        groups[i].setAttribute('fill', '#d00');\n      }\n      groups[i].classList.remove('highlighted');\n    }\n  }\n  document.querySelectorAll('.nc, .custos, .clef').forEach(el => {\n    el.setAttribute('stroke', 'black');\n    el.setAttribute('stroke-width', '30px');\n  });\n}\n","import * as Contents from './Contents';\nimport * as Grouping from './Grouping';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { SplitHandler } from './StaffTools';\nimport { EditorAction } from '../Types';\nimport { getStaffBBox } from '../utils/SelectTools';\n\n/**\n * The NeonView parent to call editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Initialize NeonView.\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n  Grouping.initNeonView(view);\n}\n\n/**\n * @param id - The id of the neume component.\n * @returns An action that unsets the inclinatum parameter of a neume component.\n */\nexport function unsetInclinatumAction (id: string): EditorAction {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * @param id - The id of the neume component.\n * @returns An action that unsets the virga parameter of a neume component.\n */\nexport function unsetVirgaAction (id: string): EditorAction {\n  return {\n    'action': 'set',\n    'param': {\n      'elementId': id,\n      'attrType': 'tilt',\n      'attrValue': ''\n    }\n  };\n}\n\n/**\n * Function to handle removing elements\n */\nexport function removeHandler (): void {\n  const toRemove = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toRemove.push(\n      {\n        'action': 'remove',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toRemove\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Function to handle re-associating elements to the nearest staff\n */\nexport function changeStaffHandler(): void {\n  const toChange: EditorAction[] = [];\n  const selected = Array.from(document.getElementsByClassName('selected'));\n  selected.forEach(elem => {\n    toChange.push(\n      {\n        'action': 'changeStaff',\n        'param': {\n          'elementId': elem.id\n        }\n      }\n    );\n  });\n  const chainAction: EditorAction = {\n    'action': 'chain',\n    'param': toChange\n  };\n  endOptionsSelection();\n  neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then(() => { neonView.updateForCurrentPage(); });\n}\n\n/**\n * Trigger the extra nc action menu for a selection.\n */\nexport function triggerNcActions (nc: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.custosActionContents;\n  } catch (e) {}\n  try {\n    const extraEdit = document.getElementById('extraEdit');\n    extraEdit.classList.remove('is-invisible');\n    extraEdit.innerHTML = Contents.ncActionContents;\n  } catch (e) {}\n  document.querySelector('#Punctum.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const unsetVirga = unsetVirgaAction(nc.id);\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, unsetVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Inclinatum.dropdown-item')\n    .addEventListener('click', () => {\n      const setInclinatum = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'se'\n        }\n      };\n      neonView.edit(setInclinatum, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  document.querySelector('#Virga.dropdown-item')\n    .addEventListener('click', () => {\n      const unsetInclinatum = unsetInclinatumAction(nc.id);\n      const setVirga = {\n        'action': 'set',\n        'param': {\n          'elementId': nc.id,\n          'attrType': 'tilt',\n          'attrValue': 'n'\n        }\n      };\n      neonView.edit({ 'action': 'chain', 'param': [ unsetInclinatum, setVirga ] }, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n}\n\n/**\n * Trigger extra neume actions.\n */\nexport function triggerNeumeActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.custosActionContents;\n  } catch (e) {}\n  try {\n    const extraEdit = document.getElementById('extraEdit');\n    extraEdit.classList.remove('is-invisible');\n    extraEdit.innerHTML = Contents.neumeActionContents;\n  } catch (e) {}\n  const neume = document.querySelectorAll('.selected');\n  if (neume.length !== 1) {\n    console.warn('More than one neume selected! Cannot trigger Neume ClickSelect actions.');\n    return;\n  }\n\n  document.querySelector('.grouping')\n    .addEventListener('click', (e) => {\n      const contour = neonView.info.getContourByValue((e.target as HTMLElement).id);\n      triggerChangeGroup(contour);\n    });\n\n  function triggerChangeGroup (contour): void {\n    const changeGroupingAction: EditorAction = {\n      'action': 'changeGroup',\n      'param': {\n        'elementId': neume[0].id,\n        'contour': contour\n      }\n    };\n    neonView.edit(changeGroupingAction, neonView.view.getCurrentPageURI()).then((result) => {\n      if (result) {\n        Notification.queueNotification('Grouping Changed');\n      } else {\n        Notification.queueNotification('Grouping Failed');\n      }\n      endOptionsSelection();\n      neonView.updateForCurrentPage();\n    });\n  }\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  initOptionsListeners();\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra syllable actions.\n */\nexport function triggerSylActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML =\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'ungroupNeumes\\'>Ungroup</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n          '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>' +\n      '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n  Grouping.initGroupingListeners();\n}\n\n/**\n * Trigger extra clef actions for a specific clef.\n * @param clef - The clef on which to trigger additional actions.\n */\nexport function triggerClefActions (clef: SVGGraphicsElement): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    // custos contents is just the delete button\n    moreEdit.innerHTML = Contents.custosActionContents;\n  } catch (e) {}\n  try {\n    const extraEdit = document.getElementById('extraEdit');\n    extraEdit.classList.remove('is-invisible');\n    extraEdit.innerHTML = Contents.clefActionContents;\n  } catch (e) {}\n  document.querySelector('#CClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setCClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'C'\n        }\n      };\n      neonView.edit(setCClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  document.querySelector('#FClef.dropdown-item')\n    .addEventListener('click', () => {\n      const setFClef: EditorAction = {\n        'action': 'setClef',\n        'param': {\n          'elementId': clef.id,\n          'shape': 'F'\n        }\n      };\n      neonView.edit(setFClef, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Shape Changed');\n        } else {\n          Notification.queueNotification('Shape Change Failed');\n        }\n        endOptionsSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.getElementById('changeStaff').addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n\n\n  initOptionsListeners();\n}\n\n/**\n * Trigger extra custos actions.\n */\nexport function triggerCustosActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML += Contents.custosActionContents;\n  } catch (e) {}\n\n  try {\n    document.getElementById('changeStaff')\n      .addEventListener('click', changeStaffHandler);\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n    document.body.addEventListener('keydown', deleteButtonHandler);\n  } catch (e) {}\n}\n\n/**\n * Trigger extra staff actions.\n */\nexport function triggerStaffActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.staffActionContents;\n  } catch (e) {}\n\n  document.getElementById('merge-systems')\n    .addEventListener('click', () => {\n      const systems = document.querySelectorAll('.staff.selected');\n      const elementIds = [];\n      systems.forEach(staff => {\n        elementIds.push(staff.id);\n      });\n      const editorAction: EditorAction = {\n        'action': 'merge',\n        'param': {\n          'elementIds': elementIds\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Staff Merged');\n          endOptionsSelection();\n          neonView.updateForCurrentPage();\n        } else {\n          Notification.queueNotification('Merge Failed');\n        }\n      });\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Trigger split staff option\n */\nexport function triggerSplitActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.splitActionContents;\n  } catch (e) {}\n\n  // TODO add trigger for split action\n  document.getElementById('split-system')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGGElement;\n      if (staff !== null) {\n        const split = new SplitHandler(neonView, staff);\n        split.startSplit();\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected!');\n        endOptionsSelection();\n      }\n    });\n\n  document.getElementById('reset-rotate')\n    .addEventListener('click', () => {\n      const staff = document.querySelector('.staff.selected') as SVGElement;\n      const rect = staff.querySelector('#resizeRect');\n      const co = rect.getAttribute('points').split(' ');\n      const dy = parseInt(co[0].split(',')[1]) - parseInt(co[1].split(',')[1]);\n      let points = getStaffBBox(staff as SVGGElement);\n      let y_change = Math.tan(points.rotate)*(points.lrx - points.ulx);\n      if (staff !== null) {\n        const editorAction: EditorAction = {\n          'action': 'resizeRotate',\n          'param': {\n            'elementId': staff.id,\n            \"ulx\": points.ulx,\n            \"uly\": points.rotate > 0 ? points.uly + y_change/2 : points.uly - y_change/2,\n            \"lrx\": points.lrx,\n            \"lry\": points.rotate > 0 ? points.lry - y_change/2 : points.lry + y_change/2,\n            \"rotate\": 0\n          }\n        };\n        neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n          if (result) {\n            await neonView.updateForCurrentPage();\n          }\n        });\n        endOptionsSelection();\n      } else {\n        console.error('No staff was selected');\n        endOptionsSelection();\n      }\n    });\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Trigger default actions when selecting by syl\n */\nexport function triggerDefaultSylActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.defaultSylActionContents;\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n  try {\n    const changeStaff = document.getElementById('changeStaff');\n    changeStaff.removeEventListener('click', changeStaffHandler);\n    changeStaff.addEventListener('click', changeStaffHandler);\n  } catch(e) {}\n}\n\n/**\n * Trigger default selection option.\n */\nexport function triggerDefaultActions (): void {\n  endOptionsSelection();\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.classList.remove('is-invisible');\n    moreEdit.innerHTML = Contents.defaultActionContents;\n  } catch (e) {}\n\n  try {\n    const del = document.getElementById('delete');\n    del.removeEventListener('click', removeHandler);\n    del.addEventListener('click', removeHandler);\n  } catch (e) {}\n  document.body.addEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * End the extra options menu.\n */\nexport function endOptionsSelection (): void {\n  try {\n    const moreEdit = document.getElementById('moreEdit');\n    moreEdit.innerHTML = '';\n    moreEdit.classList.add('is-invisible');\n  } catch (e) {}\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * Initialize extra dropdown options.\n */\nfunction initOptionsListeners (): void {\n  document.getElementById('drop_select').addEventListener('click', function () {\n    this.classList.toggle('is-active');\n  });\n}\n\n/** Event handler for delete button press. */\nexport function deleteButtonHandler (evt: KeyboardEvent): void {\n  if (evt.key === 'd' || evt.key === 'Backspace') { removeHandler(); evt.preventDefault(); }\n}\n","import NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\nclass DragHandler {\n  private dragStartCoords: Array<number>;\n  private resetToAction: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void;\n  readonly neonView: NeonView;\n  private selector: string;\n  private selection: Element[];\n  private dx: number;\n  private dy: number;\n\n  /**\n   * @param selector - CSS selector of element to apply drag handler to.\n   */\n  constructor (neonView: NeonView, selector: string) {\n    this.neonView = neonView;\n    this.selector = selector;\n  }\n\n  /**\n   * Initialize the dragging action and handler for selected elements.\n   */\n  dragInit (): void {\n    // Adding listeners\n    const dragBehaviour = d3.drag()\n      .on('start', dragStarted.bind(this))\n      .on('drag', this.dragging.bind(this))\n      .on('end', this.dragEnded.bind(this));\n\n    const activeNc = d3.selectAll('.selected');\n    const selection = Array.from(document.getElementsByClassName('selected'));\n    this.selection = selection.concat(Array.from(document.getElementsByClassName('resizePoint')));\n\n    this.dragStartCoords = new Array(activeNc.size());\n\n    activeNc.call(dragBehaviour);\n\n    // Drag effects\n    function dragStarted (): void {\n      this.dragStartCoords = [d3.event.x, d3.event.y];\n      this.dx = 0;\n      this.dy = 0;\n      const target = d3.event.sourceEvent.target;\n      if (target.classList.contains('staff')) {\n        d3.select(this.selector).call(dragBehaviour);\n      }\n    }\n  }\n\n  dragging (): void {\n    const relativeY = d3.event.y - this.dragStartCoords[1];\n    const relativeX = d3.event.x - this.dragStartCoords[0];\n    this.dx = d3.event.x - this.dragStartCoords[0];\n    this.dy = d3.event.y - this.dragStartCoords[1];\n    this.selection.forEach((el) => {\n      d3.select(el).attr('transform', function () {\n        return 'translate(' + [relativeX, relativeY] + ')';\n      });\n    });\n    /*\n     * if we're dragging a syllable (or neume etc) then there won't be a syl selected\n     * then we don't want the bounding box (if it is displayed) to move when dragging the neumes\n     * it will be a child of the element in selection, so it will get moved in the above loop\n     * so we cancel that movement out here\n     */\n    if (this.selection.filter((element: HTMLElement) => element.classList.contains('syl')).length === 0) {\n      d3.selectAll('.syllable.selected').selectAll('.sylTextRect-display').attr('transform', function () {\n        return 'translate(' + [-1 * relativeX, -1 * relativeY] + ')';\n      });\n    }\n  }\n\n  dragEnded (): void {\n    const paramArray = [];\n    this.selection.filter((el: SVGElement) => !el.classList.contains('resizePoint')).forEach((el: SVGElement) => {\n      const id = (el.tagName === 'rect') ? el.closest('.syl').id : el.id;\n      const singleAction = { action: 'drag',\n        param: { elementId: id,\n          x: this.dx,\n          y: (this.dy) * -1 }\n      };\n      paramArray.push(singleAction);\n    });\n    const editorAction: EditorAction = {\n      'action': 'chain',\n      'param': paramArray\n    };\n\n    const xDiff = Math.abs(this.dx);\n    const yDiff = Math.abs(this.dy);\n\n    if (xDiff > 5 || yDiff > 5) {\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.endOptionsSelection();\n        this.reset();\n        this.dragInit();\n      });\n    } else {\n      this.reset();\n      this.dragInit();\n    }\n  }\n\n  /** Set the d3 action to use for [[reset]]. */\n  resetTo (reset: (selection: d3.Selection<d3.BaseType, {}, HTMLElement, any>, args: any[]) => void): void {\n    this.resetToAction = reset;\n  }\n\n  /** Reset to a previous d3 action for [[this.selector]]. */\n  reset (): void {\n    if (this.resetToAction !== undefined) {\n      d3.select(this.selector).call(this.resetToAction);\n    }\n  }\n\n  endOptionsSelection (): void {\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('moreEdit').classList.add('is-invisible');\n    } catch (e) {}\n  }\n}\n\nexport { DragHandler as default };\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","/**\n * Formats raw UUID data into the proper string format.\n * @param data - Raw UUID data.\n * @returns Formatted UUID string.\n */\nfunction uint8ToUuid (data: Uint8Array): string {\n  if (data.length !== 16) {\n    return '';\n  }\n\n  function cb (previous: string, current: number): string {\n    return previous + current.toString(16).padStart(2, '0');\n  }\n\n  return data.slice(0, 4).reduce(cb, '') +\n    '-' + data.slice(4, 6).reduce(cb, '') +\n    '-' + data.slice(6, 8).reduce(cb, '') +\n    '-' + data.slice(8, 10).reduce(cb, '') +\n    '-' + data.slice(10).reduce(cb, '');\n}\n\n/**\n * @returns A [version 4 UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)).\n */\nexport function uuidv4 (): string {\n  // Check for crypto API\n  if (window.crypto === undefined) {\n    return uint8ToUuid(new Uint8Array(16));\n  }\n\n  // Get 16 octets for UUID\n  const octets = new Uint8Array(16);\n  const modifiers = Uint8Array.from([\n    parseInt('01000000', 2),  // Version bits (4 => 0100)\n    parseInt('10000000', 2),  // Variant bits (10x)\n    parseInt('00001111', 2),  // Mask to zero higher bits, version\n    parseInt('00111111', 2)   // Mask to zero higher bits, variant\n  ]);\n  window.crypto.getRandomValues(octets);\n  // Set version bits and variant bits\n  octets[6] = (octets[6] & modifiers[2]) | modifiers[0];\n  octets[8] = (octets[8] & modifiers[3]) | modifiers[1];\n\n  return uint8ToUuid(octets);\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","\nvar urilib = require('url');\nvar helpers = require('./helpers');\n\nmodule.exports.SchemaScanResult = SchemaScanResult;\nfunction SchemaScanResult(found, ref){\n  this.id = found;\n  this.ref = ref;\n}\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param string uri\n * @param object schema\n * @return {Object}\n */\nmodule.exports.scan = function scan(base, schema){\n  function scanSchema(baseuri, schema){\n    if(!schema || typeof schema!='object') return;\n    // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\n    if(schema.$ref){\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri]+1 : 0;\n      return;\n    }\n    var ourBase = schema.id ? urilib.resolve(baseuri, schema.id) : baseuri;\n    if (ourBase) {\n      // If there's no fragment, append an empty one\n      if(ourBase.indexOf('#')<0) ourBase += '#';\n      if(found[ourBase]){\n        if(!helpers.deepCompareStrict(found[ourBase], schema)){\n          throw new Error('Schema <'+schema+'> already exists with different definition');\n        }\n        return found[ourBase];\n      }\n      found[ourBase] = schema;\n      // strip trailing fragment\n      if(ourBase[ourBase.length-1]=='#'){\n        found[ourBase.substring(0, ourBase.length-1)] = schema;\n      }\n    }\n    scanArray(ourBase+'/items', ((schema.items instanceof Array)?schema.items:[schema.items]));\n    scanArray(ourBase+'/extends', ((schema.extends instanceof Array)?schema.extends:[schema.extends]));\n    scanSchema(ourBase+'/additionalItems', schema.additionalItems);\n    scanObject(ourBase+'/properties', schema.properties);\n    scanSchema(ourBase+'/additionalProperties', schema.additionalProperties);\n    scanObject(ourBase+'/definitions', schema.definitions);\n    scanObject(ourBase+'/patternProperties', schema.patternProperties);\n    scanObject(ourBase+'/dependencies', schema.dependencies);\n    scanArray(ourBase+'/disallow', schema.disallow);\n    scanArray(ourBase+'/allOf', schema.allOf);\n    scanArray(ourBase+'/anyOf', schema.anyOf);\n    scanArray(ourBase+'/oneOf', schema.oneOf);\n    scanSchema(ourBase+'/not', schema.not);\n  }\n  function scanArray(baseuri, schemas){\n    if(!(schemas instanceof Array)) return;\n    for(var i=0; i<schemas.length; i++){\n      scanSchema(baseuri+'/'+i, schemas[i]);\n    }\n  }\n  function scanObject(baseuri, schemas){\n    if(!schemas || typeof schemas!='object') return;\n    for(var p in schemas){\n      scanSchema(baseuri+'/'+p, schemas[p]);\n    }\n  }\n\n  var found = {};\n  var ref = {};\n  var schemaUri = base;\n  scanSchema(base, schema);\n  return new SchemaScanResult(found, ref);\n}\n","/**\n * HTML for each insert tab (neume, grouping, clef, system, and division).\n */\nexport const insertTabHtml: Record<string, string> = {\n  primitiveTab: '<p class=\\'control\\'>' +\n        '<button id=\\'punctum\\' class=\\'button insertel smallel\\' title=\\'punctum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/punctum.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'virga\\' class=\\'button insertel smallel\\' title=\\'virga\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/virga.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'diamond\\' class=\\'button insertel smallel\\' title=\\'inclinatum\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/diamond.png' + '\\' class=\\'image\\'/></button></p>' +\n  /*  \"<p class='control'>\" +\n        \"<button id='white_punct' class='button insertel smallel' title='white punctum'><img src='\" + White__ASSET_PREFIX__ + 'assets/img/punctum.png' + \"' class='image'/></button></p>\" +\n        \"<p class='control'>\" +\n        \"<button id='quilisma' class='button insertel smallel' title='quilisma'><img src='\" + __ASSET_PREFIX__ + 'assets/img/quilisma.png' + \"' class='image'/></button></p>\" + */\n        '<p class=\\'control\\'>' +\n        '<button id=\\'custos\\' class=\\'button insertel smallel\\' title=\\'custos\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/custos.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'cClef\\' class=\\'button insertel smallel\\' title=\\' C Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/cClef.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'fClef\\' class=\\'button insertel smallel\\' title=\\'F Clef\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/fClef.png' + '\\' class=\\'image\\'/></button></p>',\n  groupingTab: '<p class=\\'control\\'>' +\n        '<button id=\\'pes\\' class=\\'button insertel smallel\\' title=\\'pes\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pes.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'clivis\\' class=\\'button insertel smallel\\' title=\\'clivis\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/clivis.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'scandicus\\' class=\\'button insertel smallel\\' title=\\'scandicus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/scandicus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'climacus\\' class=\\'button insertel smallel\\' title=\\'climacus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/climacus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'torculus\\' class=\\'button insertel smallel\\' title=\\'toculus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/torculus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'porrectus\\' class=\\'button insertel smallel\\' title=\\'porrectus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/porrectus.png' + '\\' class=\\'image\\'/></button></p>' +\n        '<p class=\\'control\\'>' +\n        '<button id=\\'pressus\\' class=\\'button insertel smallel\\' title=\\'pressus\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/pressus.png' + '\\' class=\\'image\\'/></button></p>',\n  systemTab: '<p class=\\'control\\'>' +\n        '<button id=\\'staff\\' class=\\'button insertel longel\\' title=\\'system\\'><img src=\\'' + __ASSET_PREFIX__ + 'assets/img/staff.png' + '\\' class=\\'image\\' /></button></p>' +\n        '<p>Click upper left and lower right corners of new staff.</p>'\n  // divisionTab: \"<p class='control'>\" +\n  //     \"<button id='smallDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/smalldiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='minorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/minordiv.png' +\"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='majorDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/majordiv.png' + \"' class='image'/></button></p>\" +\n  //     \"<p class='control'>\" +\n  //     \"<button id='finalDiv' class='button insertel tallel'><img src='\" + __ASSET_PREFIX__ + 'assets/img/finaldiv.png' + \"' class='image'/></button></p>\"\n};\n\n/**\n * Structure of insert panel with basic grouping tabs.\n */\nexport const insertControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'insertMenu\\'>Insert' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleInsert\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'insertContents\\' style=\\'overflow-y: hidden;\\'>' +\n    '<p class=\\'panel-tabs\\'>' +\n    '<a id=\\'primitiveTab\\' class=\\'insertTab\\'>Primitive Elements</a>' +\n    '<a id=\\'groupingTab\\' class=\\'insertTab\\'>Grouping</a>' +\n    '<a id=\\'systemTab\\' class=\\'insertTab\\'>System</a></p>' +\n    // \"<a id='divisionTab' class='insertTab'>Division</a></p>\" +\n    '<a class=\\'panel-block has-text-centered\\'>' +\n    '<div id=\\'insert_data\\' class=\\'field is-grouped buttons\\'></div></a></div>';\n\n/**\n * Contents of edit panel with buttons.\n */\nexport const editControlsPanel: string =\n    '<p class=\\'panel-heading\\' id=\\'editMenu\\'>Edit' +\n    '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleEdit\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n    '<div id=\\'editContents\\'>' +\n    '<a class=\\'panel-block\\'>' +\n    '<label>Select By:&nbsp;</label>' +\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by is-active\\' id=\\'selBySyl\\'>Syllable</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNeume\\'>Neume</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByNc\\'>Neume Component</button></p>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button sel-by\\' id=\\'selByStaff\\'>Staff</button></p></div></a>' +\n    '<div class=\\'field is-grouped buttons\\'>' +\n    '<p class=\\'control\\'>' +\n    '<a id=\\'moreEdit\\' class=\\'panel-block is-invisible\\'>' +\n    '<a id=\\'extraEdit\\' class=\\'panel-block is-invisible\\'>' +\n    /*\n     * The extraEdit panel is added for edit options that have dropdown menus\n     * Like the Neume and Clef menus\n     * This is done because the moreEdit menu needs to have overflow for cases where it has lots of buttons\n     * But overflow ruins dropdown menus\n     */\n    '<a id=\\'neumeEdit\\' class=\\'panel-block is-invisible\\'></div>';\n\n/**\n * Contents of extra nc action menu.\n */\nexport const ncActionContents: string =\n        '<label>Change Head Shape:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Head Shapes</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content\\'>' +\n        '<a id=\\'Punctum\\' class=\\'dropdown-item\\'>Punctum</a>' +\n        '<a id=\\'Virga\\' class=\\'dropdown-item\\'>Virga</a>' +\n        '<a id=\\'Inclinatum\\' class=\\'dropdown-item\\'>Inclinatum</a></div></div></div>' +\n        '<p class=\\'control\\'></p></div>';\n\n/**\n * Contents of extra neume action menu.\n */\nexport const neumeActionContents: string =\n        '<label>Change Grouping:&nbsp;</label>' +\n        '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n        '<div class=\\'dropdown-trigger\\'>' +\n        '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n        '<span>Groupings</span>' +\n        '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n        '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n        '<div class=\\'dropdown-content scrollable-dropdown\\'>' +\n        '<a id=\\'Pes\\' class=\\'dropdown-item grouping\\'>Pes</a>' +\n        '<a id=\\'Pes subpunctis\\' class=\\'dropdown-item grouping\\'>Pes Subpunctis</a>' +\n        '<a id=\\'Clivis\\' class=\\'dropdown-item grouping\\'>Clivis</a>' +\n        '<a id=\\'Scandicus\\' class=\\'dropdown-item grouping\\'>Scandicus</a>' +\n        '<a id=\\'Scandicus flexus\\' class=\\'dropdown-item grouping\\'>Scandicus Flexus</a>' +\n        '<a id=\\'Scandicus subpunctis\\' class=\\'dropdown-item grouping\\'>Scandicus Subpunctis</a>' +\n        '<a id=\\'Climacus\\' class=\\'dropdown-item grouping\\'>Climacus</a>' +\n        '<a id=\\'Climacus resupinus\\' class=\\'dropdown-item grouping\\'>Climacus Resupinus</a>' +\n        '<a id=\\'Torculus\\' class=\\'dropdown-item grouping\\'>Torculus</a>' +\n        '<a id=\\'Torculus resupinus\\' class=\\'dropdown-item grouping\\'>Torculus Resupinus</a>' +\n        '<a id=\\'Porrectus\\' class=\\'dropdown-item grouping\\'>Porrectus</a>' +\n        '<a id=\\'Porrectus flexus\\' class=\\'dropdown-item grouping\\'>Porrectus Flexus</a>' +\n        '<a id=\\'Porrectus subpunctis\\' class=\\'dropdown-item grouping\\'>Porrectus Subpunctis</a>' +\n        '<a id=\\'Pressus\\' class=\\'dropdown-item grouping\\'>Pressus</a>' +\n        '</div></div></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'ungroupNcs\\'>Ungroup</button></p></div>';\n\n/**\n * Contents of extra staff action menu.\n */\nexport const staffActionContents: string =\n    '<label>Merge Systems:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'merge-systems\\' class=\\'button\\'>Merge</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of default action menu.\n */\nexport const defaultActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of default action menu when selecting by syllable\n * Same as above except includes re-associate to nearest staff\n */\n export const defaultSylActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n    \n/**\n * Contents of custos action menu.\n */\nexport const custosActionContents: string =\n    '<div><p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n    '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>';\n\n/**\n * Contents of split action menu.\n * @type {string}\n */\nexport const splitActionContents: string=\n    '<label>Split System:&nbsp;</label>' +\n    '<div><p class=\\'control\\'>' +\n    '<button id=\\'split-system\\' class=\\'button\\'>Split</button>' +\n    '<button id=\\'reset-rotate\\' class=\\'button\\'>Reset Rotate</button>' +\n    '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>';\n\n/**\n * Contents of extra clef action menu.\n */\nexport const clefActionContents: string =\n    '<label>Change Clef Shape:&nbsp;</label>' +\n    '<div id=\\'drop_select\\' class=\\'dropdown\\'>' +\n    '<div class=\\'dropdown-trigger\\'overflow=\\'auto\\'>' +\n    '<button id=\\'select-options\\' class=\\'button\\' aria-haspopup=\\'true\\' aria-controls=\\'dropdown-menu\\'>' +\n    '<span>Clef Shapes</span>' +\n    '<svg class=\\'icon\\'><use xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></button></div>' +\n    '<div class=\\'dropdown-menu\\' id=\\'dropdown-menu\\' role=\\'menu\\'>' +\n    '<div class=\\'dropdown-content\\'>' +\n    '<a id=\\'CClef\\' class=\\'dropdown-item\\'>C Clef</a>' +\n    '<a id=\\'FClef\\' class=\\'dropdown-item\\'>F Clef</a></div></div></div></div>';\n\n/**\n * HTML for grouping selection menu.\n */\nexport const groupingMenu: object = {\n  'nc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'neume': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNeumes\\'>Group Neumes</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div>',\n  'syl': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'mergeSyls\\'>Merge Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button>' +\n        '<button class=\\'button\\' id=\\'changeStaff\\'>Re-associate to nearest staff</button></p></div>',\n  'ligatureNc': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'groupNcs\\'>Group Neume Components</button></p></div>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'ligature': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-ligature\\'>Toggle Ligature</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>',\n  'splitSyllable': '<div class=\\'field is-grouped\\'>' +\n        '<div><p class=\\'control\\'>' +\n        '<button class=\\'button\\' id=\\'toggle-link\\'>Toggle Linked Syllables</button>' +\n        '<button class=\\'button\\' id=\\'delete\\'>Delete</button></p></div></div>'\n};\n","/** @module utils/Select */\n\nimport {\n  unselect, getStaffBBox, selectStaff, selectAll, getSelectionType\n} from './SelectTools';\nimport { resize } from './Resize';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\nimport { InfoInterface } from '../Interfaces';\nimport ZoomHandler from '../SingleView/Zoom';\n\nimport * as d3 from 'd3';\n\nlet dragHandler: DragHandler, neonView: NeonView, info: InfoInterface, zoomHandler: ZoomHandler;\nlet strokeWidth = 7;\n\n/**\n * Set stroke width on drag select box.\n * @param width - Stroke width in pixels.\n */\nexport function setSelectStrokeWidth (width: number): void {\n  strokeWidth = width;\n}\n\n/**\n * Set the objects for this module.\n */\nexport function setSelectHelperObjects (nv: NeonView, dh: DragHandler): void {\n  dragHandler = dh;\n  neonView = nv;\n  info = neonView.info;\n  zoomHandler = neonView.view.zoomHandler;\n}\n\nfunction escapeKeyListener (evt: KeyboardEvent): void {\n  if (evt.key === 'Escape') {\n    if (document.getElementsByClassName('selected').length > 0) {\n      info.infoListeners();\n    }\n    unselect();\n  }\n}\n\nfunction isSelByBBox (): boolean {\n  const selByBBox = document.getElementById('selByBBox');\n  if (selByBBox) {\n    return selByBBox.classList.contains('is-active');\n  }\n  return false;\n}\n\nfunction stopPropHandler (evt): void { evt.stopPropagation(); }\n\n/**\n * Apply listeners for click selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function clickSelect (selector: string): void {\n  document.querySelectorAll(selector).forEach(sel => {\n    sel.removeEventListener('mousedown', clickHandler);\n    sel.addEventListener('mousedown', clickHandler);\n  });\n\n  // Click away listeners\n  document.body.removeEventListener('keydown', escapeKeyListener);\n  document.body.addEventListener('keydown', escapeKeyListener);\n\n  document.getElementById('container')\n    .addEventListener('contextmenu', (evt) => { evt.preventDefault(); });\n\n  document.querySelectorAll('use,rect,#moreEdit').forEach(sel => {\n    sel.removeEventListener('click', stopPropHandler);\n    sel.addEventListener('click', stopPropHandler);\n  });\n}\n\n/**\n * Handle click events related to element selection.\n */\nfunction clickHandler (evt: MouseEvent): void {\n  if (!neonView) return;\n  const mode = neonView.getUserMode();\n\n  // If in insert mode or panning is active from shift key\n  if (mode === 'insert' || evt.shiftKey) { return; }\n  // Check if the element being clicked on is part of a drag Selection\n  if (this.tagName === 'use' && getSelectionType() !== 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [this];\n      // Check if this is part of a ligature and, if so, add all of it to the selection.\n      const firstLigatureHalf = /E9B[45678]/;\n      const secondLigatureHalf = /E9B[9ABC]/;\n      if (this.getAttribute('xlink:href').match(secondLigatureHalf)) {\n        // This is the second part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const firstUse = neume.children[ncIndex - 1].children[0];\n        console.assert(firstUse.getAttribute('xlink:href').match(firstLigatureHalf), 'First glyph of ligature unexpected!');\n        if (firstUse.closest('.selected') === null) {\n          selection.unshift(firstUse);\n        }\n      } else if (this.getAttribute('xlink:href').match(firstLigatureHalf)) {\n        // This is the first part of a ligature\n        const nc = this.closest('.nc');\n        const neume = this.closest('.neume');\n        const ncIndex = Array.from(neume.children).indexOf(nc);\n        const secondUse = neume.children[ncIndex + 1].children[0];\n        console.assert(secondUse.getAttribute('xlink:href').match(secondLigatureHalf), 'Second glyph of ligature unexpected!');\n        if (secondUse.closest('.selected') === null) {\n          selection.push(secondUse);\n        }\n      }\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')));\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n    else {\n      let selection = [];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        // determine which selection mode we're in\n        const temp = document.querySelector('.sel-by.is-active').id;\n        let mode = '';\n        switch (temp) {\n          case 'selByStaff':\n            mode = '.staff';\n            break;\n          case 'selByNeume':\n            mode = '.neume';\n            break;\n          case 'selByNc':\n            mode = '.nc';\n            break;\n          default:\n            mode = '.syllable';\n            break;\n        }\n        const remove = [this.closest(mode)];\n        selection = Array.from(document.getElementsByClassName('selected'));\n        selection = selection.filter( (el) => {\n          return !remove.includes(el);\n        });\n        selectAll(selection, neonView, dragHandler);\n        if (dragHandler) {\n          dragHandler.dragInit();\n        }\n      }\n    }\n  } else if ((evt.target as HTMLElement).tagName === 'rect' && getSelectionType() === 'selByBBox') {\n    if (this.closest('.selected') === null) {\n      let selection = [evt.target] as SVGGElement[];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        selection = selection.concat(Array.from(document.getElementsByClassName('selected')) as SVGGElement[]);\n        selection = selection.map( (el) => {\n          if (el.tagName == 'rect') {\n            return el;\n          }\n          return el.querySelector('.sylTextRect-Display');\n        });\n      }\n      selectAll(selection, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    } else {\n      let selection = [];\n      if (window.navigator.userAgent.match(/Mac/) ? evt.metaKey : evt.ctrlKey) {\n        const remove = [this];\n        selection = Array.from(document.getElementsByClassName('selected'));\n        selection = selection.map( (el) => {\n          if (el.tagName == 'rect') {\n            return el;\n          }\n          return el.querySelector('.sylTextRect-Display');\n        });\n        selection = selection.filter( (el) => {\n          return !remove.includes(el);\n        });\n        selectAll(selection, neonView, dragHandler);\n        if (dragHandler) {\n          dragHandler.dragInit();\n        }\n      }\n    }\n  } else {\n    // Check if the point being clicked on is a staff selection (if applicable)\n    if (getSelectionType() !== 'selByStaff') {\n      info.infoListeners();\n      return;\n    }\n\n    // Check if the point is in a staff.\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    let pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    pt = pt.matrixTransform(transformMatrix.inverse());\n\n    const selectedStaves = Array.from(document.getElementsByClassName('staff'))\n      .filter((staff: SVGGElement) => {\n        const bbox = getStaffBBox(staff);\n        const ulx = bbox.ulx;\n        const uly = bbox.uly;\n        const lrx = bbox.lrx;\n        const lry = bbox.lry;\n        const rotate = bbox.rotate;\n\n        return (pt.x > ulx && pt.x < lrx) &&\n          (pt.y > (uly + (pt.x - ulx) * Math.tan(rotate))) &&\n          (pt.y < (lry - (lrx - pt.x) * Math.tan(rotate)));\n      });\n\n    unselect();\n    if (selectedStaves.length == 0) {\n      return;\n    }\n\n    // Select a staff\n    const staff = selectedStaves[0] as SVGGElement;\n    if (!staff.classList.contains('selected')) {\n      // Select previously unselected staff\n      selectStaff(staff, dragHandler);\n      resize(staff, neonView, dragHandler);\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n    }\n    // Trigger mousedown event on the staff\n    staff.dispatchEvent(new MouseEvent('mousedown', {\n      screenX: evt.screenX,\n      screenY: evt.screenY,\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      ctrlKey: evt.ctrlKey,\n      shiftKey: evt.shiftKey,\n      altKey: evt.altKey,\n      metaKey: evt.metaKey,\n      view: evt.view\n    }));\n  }\n}\n\n/**\n * Apply listeners for drag selection.\n * @param selector - The CSS selector used to choose where listeners are applied.\n */\nexport function dragSelect (selector: string): void {\n  let initialX = 0;\n  let initialY = 0;\n  let panning = false;\n  let dragSelecting = false;\n  // var canvas = d3.select('#svg_group');\n  d3.selectAll(selector.replace('.active-page', '').trim())\n    .on('.drag', null);\n  const canvas = d3.select(selector);\n  const dragSelectAction = d3.drag()\n    .on('start', selStart)\n    .on('drag', selecting)\n    .on('end', selEnd);\n  canvas.call(dragSelectAction);\n  if (dragHandler) {\n    dragHandler.resetTo(dragSelectAction);\n  }\n\n  function selStart (): void {\n    if (!neonView) return;\n    const userMode = neonView.getUserMode();\n    if (d3.event.sourceEvent.target.nodeName !== 'use' && userMode !== 'insert' && d3.event.sourceEvent.target.nodeName !== 'rect') {\n      if (!d3.event.sourceEvent.shiftKey) { // If not holding down shift key to pan\n        if (!document.getElementById('selByStaff').classList.contains('is-active') ||\n          pointNotInStaff(d3.mouse(this))) {\n          unselect();\n          dragSelecting = true;\n          const initialP = d3.mouse(this);\n          initialX = initialP[0];\n          initialY = initialP[1];\n          initRect(initialX, initialY);\n        }\n      } else {\n        panning = true;\n        if (zoomHandler !== undefined) {\n          zoomHandler.startDrag();\n        }\n      }\n    } else if (d3.event.sourceEvent.shiftKey) {\n      panning = true;\n      if (zoomHandler !== undefined) {\n        zoomHandler.startDrag();\n      }\n    }\n  }\n\n  /**\n   * Check if a point is in the bounds of a staff element.\n   * Rotate is not taken into account.\n   */\n  function pointNotInStaff (pt: number[]): boolean {\n    const staves = Array.from(document.getElementsByClassName('staff'));\n    const filtered = staves.filter((staff: SVGGElement) => {\n      const bbox = getStaffBBox(staff);\n      const ulx = bbox.ulx;\n      const uly = bbox.uly;\n      const lrx = bbox.lrx;\n      const lry = bbox.lry;\n      const rotate = bbox.rotate;\n\n      return (pt[0] > ulx && pt[0] < lrx) &&\n        (pt[1] > (uly + (pt[0] - ulx) * Math.tan(rotate))) &&\n        (pt[1] < (lry - (lrx - pt[0]) * Math.tan(rotate)));\n    });\n    return (filtered.length === 0);\n  }\n\n  function selecting (): void {\n    if (!panning && dragSelecting) {\n      const currentPt = d3.mouse(this);\n      const curX = currentPt[0];\n      const curY = currentPt[1];\n\n      const newX = curX < initialX ? curX : initialX;\n      const newY = curY < initialY ? curY : initialY;\n      const width = curX < initialX ? initialX - curX : curX - initialX;\n      const height = curY < initialY ? initialY - curY : curY - initialY;\n\n      updateRect(newX, newY, width, height);\n    } else if (panning) {\n      if (zoomHandler !== undefined) {\n        zoomHandler.dragging();\n      }\n    }\n  }\n\n  function selEnd (): void {\n    if (!panning && dragSelecting) {\n      const rx = parseInt(document.getElementById('selectRect').getAttribute('x'));\n      const ry = parseInt(document.getElementById('selectRect').getAttribute('y'));\n      const lx = parseInt(document.getElementById('selectRect').getAttribute('x')) +\n        parseInt(document.getElementById('selectRect').getAttribute('width'));\n      const ly = parseInt(document.getElementById('selectRect').getAttribute('y')) +\n        parseInt(document.getElementById('selectRect').getAttribute('height'));\n      // Transform to the correct coordinate system\n      const node = canvas.node() as SVGSVGElement;\n      let ul = node.createSVGPoint();\n      ul.x = rx;\n      ul.y = ry;\n      let lr = node.createSVGPoint();\n      lr.x = lx;\n      lr.y = ly;\n      const transform = node.getScreenCTM().inverse()\n        .multiply((canvas.select('.system').node() as SVGGraphicsElement)\n          .getScreenCTM()).inverse();\n      ul = ul.matrixTransform(transform);\n      lr = lr.matrixTransform(transform);\n\n      let nc;\n      if (document.getElementById('selByStaff').classList.contains('is-active')) {\n        nc = document.querySelectorAll(selector + ' use, ' + selector + ' .staff');\n      } else if (isSelByBBox()) {\n        nc = document.querySelectorAll(selector + ' .sylTextRect-display');\n      } else {\n        nc = document.querySelectorAll(selector + ' use');\n      }\n      const els = Array.from(nc);\n\n      const elements = els.filter(function (d: SVGGraphicsElement): boolean {\n        let ulx, uly, lrx, lry;\n        if (isSelByBBox()) {\n          ulx = Number(d.getAttribute('x'));\n          uly = Number(d.getAttribute('y'));\n          lrx = +ulx + +(d.getAttribute('width').slice(0, -2));\n          lry = +uly + +(d.getAttribute('height').slice(0, -2));\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else if (d.tagName === 'use') {\n          const box = (d.parentNode as SVGGElement).getBBox();\n          ulx = box.x;\n          uly = box.y;\n          lrx = box.x + box.width;\n          lry = box.y + box.height;\n          return !(((ul.x < ulx && lr.x < ulx) || (ul.x > lrx && lr.x > lrx)) || ((ul.y < uly && lr.y < uly) || (ul.y > lry && lr.y > lry)));\n        } else {\n          const box = getStaffBBox(d);\n          return !((ul.x < box.ulx && lr.x < box.ulx) ||\n                  (ul.x > box.lrx && lr.x > box.lrx) ||\n                  (ul.y < (box.uly + Math.abs(box.ulx - ul.x) * Math.tan(box.rotate)) &&\n                    lr.y < (box.uly + Math.abs(box.ulx - ul.x) * Math.tan(box.rotate))) ||\n                  (ul.y > (box.lry + Math.abs(box.lry - lr.y) * Math.tan(box.rotate)) &&\n                    lr.y > (box.lry + Math.abs(box.lry - lr.y) * Math.tan(box.rotate))));\n        }\n      }) as SVGGraphicsElement[];\n\n      // Get other halves of ligatures if only one is selected\n      elements.forEach((element: SVGElement) => {\n        if (element.tagName === 'use' && element.getAttribute('xlink:href').match(/E9B[456789ABC]/)) {\n          const neume = element.closest('.neume');\n          const ncIndex = Array.from(neume.children).indexOf(element.closest('.nc'));\n          if (element.getAttribute('xlink:href').match(/E9B[45678]/)) {\n            // Add second half of ligature to selected list if not already present\n            const secondNc = neume.children[ncIndex + 1];\n            const secondUse = secondNc.querySelector('use');\n            if (elements.indexOf(secondUse) < 0) {\n              elements.push(secondUse);\n            }\n          } else {\n            // Add first half of ligature to selected list if not already present\n            const firstNc = neume.children[ncIndex - 1];\n            const firstUse = firstNc.querySelector('use');\n            if (elements.indexOf(firstUse) < 0) {\n              elements.push(firstUse);\n            }\n          }\n        }\n      });\n      selectAll(elements, neonView, dragHandler);\n\n      if (dragHandler) {\n        dragHandler.dragInit();\n      }\n      d3.selectAll('#selectRect').remove();\n      dragSelecting = false;\n    }\n    panning = false;\n  }\n\n  /**\n     * Create an initial dragging rectangle.\n     * @param ulx - The upper left x-position of the new rectangle.\n     * @param uly - The upper left y-position of the new rectangle.\n     */\n  function initRect (ulx: number, uly: number): void {\n    canvas.append('rect')\n      .attr('x', ulx)\n      .attr('y', uly)\n      .attr('width', 0)\n      .attr('height', 0)\n      .attr('id', 'selectRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', strokeWidth)\n      .attr('fill', 'none');\n  }\n\n  /**\n     * Update the dragging rectangle.\n     * @param newX - The new ulx.\n     * @param newY - The new uly.\n     * @param currentWidth - The width of the rectangle in pixels.\n     * @param currentHeight - The height of the rectangle in pixels.\n     */\n  function updateRect (newX: number, newY: number, currentWidth: number, currentHeight: number): void {\n    d3.select('#selectRect')\n      .attr('x', newX)\n      .attr('y', newY)\n      .attr('width', currentWidth)\n      .attr('height', currentHeight);\n  }\n}\n","import immediate from 'immediate';\nimport uuidV4 from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport { EventEmitter } from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.2.1\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-/.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending – no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function (e) {\n    var msg = e.target.error && e.target.error.message;\n\n    if (!msg) {\n      msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    } else if (msg.indexOf(\"stored database is a higher version\") !== -1) {\n      msg = new Error('This DB was created with the newer \"indexeddb\" adapter, but you are trying to open it with the older \"idb\" adapter');\n    }\n\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if ('buffer' in response) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            var typeFieldDescriptor = Object.getOwnPropertyDescriptor(blob.__proto__, 'type');\n            if (!typeFieldDescriptor || typeFieldDescriptor.set) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser && typeof response.buffer === 'function') {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import NeonCore from './NeonCore';\n\nimport { parseManifest } from './utils/NeonManifest';\nimport { prepareEditMode } from './utils/EditControls';\nimport setBody from './utils/template/Template';\nimport * as Types from './Types';\nimport * as Interfaces from './Interfaces';\n\n\n/**\n * NeonView class. Manages the other modules of Neon and communicates with\n * NeonCore.\n */\nclass NeonView {\n  /** The manifest describing what to load and where to find it. */\n  manifest: Types.NeonManifest;\n  /** Module that displays rendered MEI. */\n  view: Interfaces.ViewInterface;\n  /** Name of the document loaded. */\n  name: string;\n  /** Module that handles managing resources, rendering SVGs. */\n  core: NeonCore;\n  /** Module that provides additional information on musical elements. */\n  info: Interfaces.InfoInterface;\n  /** Module that allows editing of musical elements. */\n  NeumeEdit: Interfaces.NeumeEditInterface;\n  /** Module that allows viewing of syllable text. */\n  textView: Interfaces.TextViewInterface;\n  /** Module that allows editing of syllable text. */\n  TextEdit: Interfaces.TextEditInterface;\n\n  params: Interfaces.NeonViewParams;\n\n\n  /**\n   * Constructor for NeonView. Sets mode and passes constructors.\n   */\n  constructor (params: Interfaces.NeonViewParams) {\n    if (!parseManifest(params.manifest)) {\n      console.error('Unable to parse the manifest');\n    }\n\n    this.params = params;\n    this.manifest = params.manifest;\n  }\n\n  /**\n   * Set up Neon for any provided editing modules.\n   */\n  setupEdit(params: Interfaces.NeonViewParams): void {\n    if (params.NeumeEdit !== undefined || (params.TextEdit !== undefined && params.TextView !== undefined)) {\n      // Set up display for edit button\n      prepareEditMode(this);\n    }\n\n    if (params.NeumeEdit !== undefined) {\n      this.NeumeEdit = new params.NeumeEdit(this);\n    }\n    if (params.TextView !== undefined) {\n      this.textView = new params.TextView(this);\n      if (params.TextEdit !== undefined) {\n        this.TextEdit = new params.TextEdit(this);\n      }\n    }\n  }\n\n  /**\n   * Start Neon\n   */\n  start (): void {\n    /* this.core.db.info().then((info) => {\n      if (info.doc_count === 0) {\n        this.core.initDb().then(() => { this.updateForCurrentPage(); });\n      } else {\n        Notification.queueNotification('Existing database found. Revert to start from the beginning.');\n        this.updateForCurrentPage();\n      }\n    }); */\n    setBody().then(() => {\n      this.view = new this.params.View(this, this.params.Display, this.manifest.image);\n      this.name = this.manifest.title;\n\n      this.core = new NeonCore(this.manifest);\n      this.info = new this.params.Info(this);\n\n      window.setTimeout(this.setupEdit.bind(this), 2000, this.params);\n      return this.core.initDb();\n    }).then(() => {\n      this.updateForCurrentPage(true);\n    });\n  }\n\n  /**\n   * Get the current page from the loaded view and then display the\n   * most up to date SVG.\n   */\n  updateForCurrentPage (delay = false): Promise<void> {\n    const pageNo = this.view.getCurrentPage();\n    return this.view.changePage(pageNo, delay);\n  }\n\n  /**\n   * Redo an action performed on the current page (if there is one).\n   */\n  redo (): Promise<boolean> {\n    return this.core.redo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Undo the last action performed on the current page (if there is one).\n   */\n  undo (): Promise<boolean> {\n    return this.core.undo(this.view.getCurrentPageURI());\n  }\n\n  /**\n   * Get the mode Neon is in.\n   * @returns Value is \"viewer\", \"insert\", or \"edit\".\n   */\n  getUserMode (): string {\n    if (this.NeumeEdit !== undefined) {\n      return this.NeumeEdit.getUserMode();\n    } else if (this.TextEdit !== undefined) {\n      return 'edit';\n    } else {\n      return 'viewer';\n    }\n  }\n\n  /**\n   * Attempt to perform an editor action.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the page to perform the action on\n   */\n  edit (action: Types.EditorAction, pageURI: string): Promise<boolean> {\n    return this.core.edit(action, pageURI);\n  }\n\n  /**\n   * Get the attributes for a specific musical element.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the page the element is found on.\n   */\n  getElementAttr (elementID: string, pageURI: string): Promise<Types.Attributes> {\n    return this.core.getElementAttr(elementID, pageURI);\n  }\n\n  /**\n   * Updates browser database and creates JSON-LD save file.\n   * @returns The contents of this file.\n   */\n  export (): Promise<string | ArrayBuffer> {\n    return (new Promise((resolve, reject): void => {\n      this.core.updateDatabase().then(() => {\n        this.manifest['mei_annotations'] = this.core.getAnnotations();\n        this.manifest.timestamp = (new Date()).toISOString();\n        const data = new window.Blob([JSON.stringify(this.manifest, null, 2)], { type: 'application/ld+json' });\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n          resolve(reader.result);\n        });\n        reader.readAsDataURL(data);\n      }).catch(err => { reject(err); });\n    }));\n  }\n\n  /**\n   * Save the current state to the browser database.\n   */\n  save (): Promise<void> {\n    return this.core.updateDatabase();\n  }\n\n  /**\n   * Deletes the local database of the loaded MEI file(s).\n   */\n  deleteDb (): Promise<{}[]> {\n    return this.core.deleteDb();\n  }\n\n  /**\n   * Get the page's MEI file encoded as a data URI.\n   * @param pageNo - The URI specifying the page.\n   * @returns A [Data URI](https://en.wikipedia.org/wiki/Data_URI_scheme).\n   */\n  getPageURI (pageNo?: string): Promise<string> {\n    if (pageNo === undefined) {\n      pageNo = this.view.getCurrentPageURI();\n    }\n    return new Promise((resolve): void => {\n      this.core.getMEI(pageNo).then((mei) => {\n        resolve('data:application/mei+xml;charset=utf-8,' + encodeURIComponent(mei));\n      });\n    });\n  }\n\n  /**\n   * Get the page's MEI file as a string.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageMEI (pageNo: string): Promise<string> {\n    return this.core.getMEI(pageNo);\n  }\n\n  /**\n   * Get the page's SVG.\n   * @param pageNo - The identifying URI of the page.\n   */\n  getPageSVG (pageNo: string): Promise<SVGSVGElement> {\n    return this.core.getSVG(pageNo);\n  }\n}\n\nexport { NeonView as default };\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","import * as DisplayControls from './DisplayControls';\nimport ZoomHandler from '../SingleView/Zoom';\nimport { DisplayInterface, ViewInterface } from '../Interfaces';\n\n/**\n * Return the HTML for the display panel.\n * @param {ZoomHandler} handleZoom - Includes zoom controls if defined.\n * @returns {string}\n */\nfunction displayControlsPanel (handleZoom: ZoomHandler): string {\n  let contents =\n  '<p class=\\'panel-heading\\' id=\\'displayHeader\\'>Display' +\n  '<svg class=\\'icon is-pulled-right\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use></svg></p>' +\n  '<div id=\\'displayContents\\'>';\n  if (handleZoom !== undefined) {\n    contents +=\n    '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-zoom\\'>Zoom</button>' +\n    '<input class=\\'slider is-fullwidth\\' id=\\'zoomSlider\\' step=\\'5\\' min=\\'25\\' max=\\'400\\' value=\\'100\\' type=\\'range\\'/>' +\n    '<output id=\\'zoomOutput\\' for=\\'zoomSlider\\'>100</output></a>';\n  }\n  contents +=\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-opacity\\'>Glyph Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'opacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'opacityOutput\\' for=\\'opacitySlider\\'>100</output></a>' +\n  '<a class=\\'panel-block has-text-centered\\'><button class=\\'button\\' id=\\'reset-bg-opacity\\'>Image Opacity</button>' +\n  '<input class=\\'slider is-fullwidth\\' id=\\'bgOpacitySlider\\' step=\\'5\\' min=\\'0\\' max=\\'100\\' value=\\'100\\' type=\\'range\\'/>' +\n  '<output id=\\'bgOpacityOutput\\' for=\\'bgOpacitySlider\\'>100</output></a>' +\n  '<div class=\\'panel-block\\' id=\\'extensible-block\\'>' +\n  '<div class=\\'dropdown\\' id=\\'highlight-dropdown\\'><div class=\\'dropdown-trigger\\'>' +\n  '<button class=\\'button\\' id=\\'highlight-button\\' aria-haspopup=\\'true\\' aria-controls=\\'highlight-menu\\' style=\\'width: auto\\'>' +\n  '<span>Highlight</span><span id=\\'highlight-type\\'>&nbsp;- Off</span>' +\n  '<svg class=\\'icon\\'><use id=\\'toggleDisplay\\' xlink:href=\\'' + __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down\\'></use>' +\n  '</svg></button></div><div class=\\'dropdown-menu\\' id=\\'highlight-menu\\' role=\\'menu\\'>' +\n  '<div class=\\'dropdown-content\\'><a class=\\'dropdown-item\\' id=\\'highlight-staff\\'>Staff</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-syllable\\'>Syllable</a>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-neume\\'>Neume</a><hr class=\\'dropdown-divider\\'/>' +\n  '<a class=\\'dropdown-item\\' id=\\'highlight-none\\'>None</a></div></div></div></div></div>';\n  return contents;\n}\n\n/**\n * A class that sets the content of the display panel to the right and\n * manages controls for viewing.\n */\nclass DisplayPanel implements DisplayInterface {\n  view: ViewInterface;\n  className: string;\n  background: string;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * Constructor for DisplayPanel.\n   * @param {SingleView | DivaView} view - The View parent.\n   * @param {string} className - The class name for the rendered SVG object(s).\n   * @param {string} background - The class name associated with the background.\n   * @param {ZoomHandler} [zoomHandler] - The ZoomHandler object, if SingleView.\n   */\n  constructor (view: ViewInterface, className: string,\n    background: string, zoomHandler: ZoomHandler = undefined) {\n    this.view = view;\n    this.className = className;\n    this.background = background;\n    this.zoomHandler = zoomHandler;\n\n    const displayPanel = document.getElementById('display_controls');\n    displayPanel.innerHTML = displayControlsPanel(this.zoomHandler);\n    this.view.addUpdateCallback(this.updateVisualization.bind(this));\n  }\n\n  /**\n   * Apply event listeners related to the DisplayPanel.\n   */\n  setDisplayListeners (): void {\n    if (this.zoomHandler) {\n      // Zoom handler stuff\n      DisplayControls.setZoomControls(this.zoomHandler);\n    }\n    DisplayControls.initDisplayControls(this.className, this.background);\n  }\n\n  /**\n   * Update SVG based on visualization settings\n   */\n  updateVisualization (): void {\n    DisplayControls.setOpacityFromSlider(this.className);\n    DisplayControls.updateHighlight();\n  }\n}\n\nexport { DisplayPanel as default };\n","import NeonView from './NeonView';\nimport DisplayPanel from './DisplayPanel/DisplayPanel';\nimport { DisplayConstructable, ViewInterface } from './Interfaces';\nimport ZoomHandler from './SingleView/Zoom';\n\ndeclare let Diva: any;\n\n/**\n * View module that uses the diva.js viewer to render the pages of a IIIF manifests\n * and then display the rendered MEI files over the proper pages.\n */\nclass DivaView implements ViewInterface {\n  readonly neonView: NeonView;\n  /** Callbacks that run whenever the display updates. */\n  private updateCallbacks: Array<() => void>;\n  divaReady: boolean;\n  /** The diva.js instance. */\n  private diva: any;\n  /** Map zero-index page numbers to the actual URI/IRI identifier. */\n  private indexMap: Map<number, string>;\n  private displayPanel: DisplayPanel;\n  /** Time to wait after a page becomes active before loading it. In milliseconds. */\n  private loadDelay: number;\n  zoomHandler: ZoomHandler;\n\n  /**\n   * @param manifest - URI/IRI to the IIIF manifest.\n   */\n  constructor (neonView: NeonView, Display: DisplayConstructable, manifest: string) {\n    this.neonView = neonView;\n    this.updateCallbacks = [];\n    this.divaReady = false;\n    this.diva = new Diva('container', {\n      objectData: manifest\n    });\n    document.getElementById('container').style.minHeight = '100%';\n    this.indexMap = new Map();\n    this.diva.disableDragScrollable();\n    this.displayPanel = new Display(this, 'neon-container', 'diva-viewer-canvas');\n    this.loadDelay = 500; // in milliseconds\n    this.initDivaEvents();\n    this.setViewEventHandlers();\n\n    window.onresize = (): void => {\n      const height = window.innerHeight;\n      const width = window.innerWidth;\n\n      window.setTimeout((): void => {\n        if ((height === window.innerHeight) && (width === window.innerWidth)) {\n          this.changePage(this.getCurrentPage(), false);\n        }\n      }, this.loadDelay);\n    };\n  }\n\n  /**\n   * Set the listeners for certain events internal to diva.js\n   */\n  initDivaEvents (): void {\n    Diva.Events.subscribe('ManifestDidLoad', this.parseManifest.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ObjectDidLoad', this.didLoad.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ActivePageDidChange', this.changePage.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.adjustZoom.bind(this), this.diva.settings.ID);\n  }\n\n  /**\n   * Called when the visible page changes in the diva.js viewer.\n   * @param pageIndex - The zero-indexed page that is most visible.\n   * @param delay - Whether to delay the loading of the page so that neon doesn't lag while scrolling.\n   */\n  async changePage (pageIndex: number, delay = true): Promise<void> {\n    function checkAndLoad (page: number): void {\n      if (page === this.getCurrentPage()) {\n        const pageURI = this.indexMap.get(page);\n        this.neonView.getPageSVG(pageURI).then((svg: SVGSVGElement) => {\n          this.updateSVG(svg, page);\n          const containerId = 'neon-container-' + page;\n          const container = document.getElementById(containerId);\n          if (container !== null) {\n            container.classList.add('active-page');\n          }\n          this.updateCallbacks.forEach((callback: Function) => callback());\n        }).catch((err: { name: string }) => {\n          if (err.name !== 'not_found' && err.name !== 'missing_mei') {\n            console.error(err);\n          }\n        });\n      }\n    }\n\n    const pageIndexes = [pageIndex];\n    Array.from(document.getElementsByClassName('active-page')).forEach(elem => {\n      elem.classList.remove('active-page');\n    });\n    for (const page of pageIndexes) {\n      if (delay) {\n        window.setTimeout(checkAndLoad.bind(this), (this.loadDelay), page);\n      } else {\n        checkAndLoad.bind(this)(page);\n      }\n    }\n  }\n\n  /**\n   * @returns Active zero-indexed page in the diva.js viewer.\n   */\n  getCurrentPage (): number {\n    return this.diva.getActivePageIndex();\n  }\n\n  /**\n   * @returns The active page URI in the diva.js viewer.\n   */\n  getCurrentPageURI (): string {\n    return this.indexMap.get(this.getCurrentPage());\n  }\n\n  /**\n   * Adjust the rendered SVG(s) to be the correct size after zooming.\n   */\n  adjustZoom (): void {\n    (new Promise((resolve): void => {\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => { elem.style.display = 'none'; });\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.changePage(this.diva.getActivePageIndex(), true);\n      Array.from(document.getElementsByClassName('neon-container'))\n        .forEach((elem: HTMLElement) => {\n          const svg = elem.firstChild as SVGSVGElement;\n          const pageNo = parseInt(elem.id.match(/\\d+/)[0]);\n          this.updateSVG(svg, pageNo);\n          elem.style.display = '';\n        });\n    });\n  }\n\n  /**\n   * Update the SVG being displayed for the specified page.\n   * @param svg - The SVG of the page to update to.\n   * @param pageNo - The zero-indexed page number.\n   */\n  updateSVG (svg: SVGSVGElement, pageNo: number): void {\n    const inner = document.getElementById('diva-1-inner');\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(pageNo);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(pageNo, {\n      includePadding: true,\n      incorporateViewport: true\n    });\n    const marginLeft = window.getComputedStyle(inner, null)\n      .getPropertyValue('margin-left');\n\n    const containerId = 'neon-container-' + pageNo.toString();\n    let container = document.getElementById(containerId);\n    if (container === null) {\n      container = document.createElement('div');\n      container.id = containerId;\n      container.classList.add('neon-container');\n      inner.appendChild(container);\n    }\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n\n    svg.setAttribute('width', dimensions.width);\n    svg.setAttribute('height', dimensions.height);\n    container.style.position = 'absolute';\n    container.style.top = `${offset.top}px`;\n    container.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    container.appendChild(svg);\n  }\n\n  /**\n   * Function called when diva.js finishes loading.\n   */\n  didLoad (): void {\n    this.divaReady = true;\n    this.displayPanel.setDisplayListeners();\n    document.getElementById('loading').style.display = 'none';\n    console.log(this.diva);\n  }\n\n  /**\n   * Add a callback function that will be run whenever an SVG is updated.\n   * @param cb - The callback function.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback function previously added to the list of functions to call.\n   * @param cb - The callback function.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Set listeners on the body element for global events.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = 'hidden';\n          }\n          break;\n        default: break;\n      }\n    });\n\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'h':\n          for (const container of document.getElementsByClassName('neon-container') as HTMLCollectionOf<HTMLElement>) {\n            container.style.visibility = '';\n          }\n          break;\n        default: break;\n      }\n    });\n  }\n\n  /**\n   * Use the IIIF manifest to create a map between IIIF canvases and page indexes.\n   * @param manifest - The IIIF manifest object.\n   */\n  parseManifest (manifest: { sequences: { canvases: object[] }[] }): void {\n    this.indexMap.clear();\n    for (const sequence of manifest.sequences) {\n      for (const canvas of sequence.canvases) {\n        this.indexMap.set(sequence.canvases.indexOf(canvas), canvas['@id']);\n      }\n    }\n  }\n\n  /**\n   * @returns The name of the active page/canvas combined with the manuscript name.\n   */\n  getPageName (): string {\n    const manuscriptName = this.diva.settings.manifest.itemTitle;\n    const pageName = this.diva.settings.manifest.pages[this.getCurrentPage()].l;\n    return manuscriptName + ' \\u2014 ' + pageName;\n  }\n}\n\nexport { DivaView as default };\n","import { updateHighlight, setOpacityFromSlider } from '../DisplayPanel/DisplayControls';\nimport NeonView from '../NeonView';\nimport DisplayPanel from '../DisplayPanel/DisplayPanel';\nimport ZoomHandler from './Zoom';\nimport { ViewInterface, DisplayConstructable } from '../Interfaces';\n\nimport * as d3 from 'd3';\n\n/**\n * A view module for displaying a single page of a manuscript.\n */\nclass SingleView implements ViewInterface {\n  readonly neonView: NeonView;\n  private container: HTMLElement;\n  private updateCallbacks: Array<() => void>;\n  private group: SVGSVGElement;\n  private bg: SVGImageElement;\n  private mei: SVGSVGElement;\n  zoomHandler: ZoomHandler;\n  private displayPanel: DisplayPanel;\n  readonly pageURI: string;\n  /**\n   * Constructor for SingleView.\n   * @param image - The URI to the background image for the page.\n   */\n  constructor (neonView: NeonView, panel: DisplayConstructable, image: string) {\n    this.neonView = neonView;\n    this.container = document.getElementById('container');\n    this.updateCallbacks = new Array(0);\n    // Group will contain the image and the rendered SVG\n    this.group = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    this.group.id = 'svg_group';\n    this.group.setAttribute('height', window.innerHeight.toString());\n    this.group.setAttribute('width', '100%');\n\n    this.bg = document.createElementNS('http://www.w3.org/2000/svg', 'image');\n    this.bg.id = 'bgimg';\n    this.bg.classList.add('background');\n    this.bg.setAttribute('x', '0');\n    this.bg.setAttribute('y', '0');\n\n    const reader = new FileReader();\n    fetch(image).then(result => {\n      if (result.ok) {\n        reader.addEventListener('load', () => {\n          this.bg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', reader.result.toString());\n          const bbox = this.bg.getBBox();\n          if (!this.group.hasAttribute('viewBox')) {\n            this.group.setAttribute('viewBox', '0 0 ' + bbox.width.toString() + ' ' + bbox.height.toString());\n          }\n        });\n        return result.blob();\n      }\n    }).then(blob => {\n      reader.readAsDataURL(blob);\n    });\n\n    this.mei = document.createElementNS('http://www.w3.org/svg', 'svg') as SVGSVGElement;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n\n    this.group.appendChild(this.bg);\n    this.group.appendChild(this.mei);\n    this.container.appendChild(this.group);\n\n    this.zoomHandler = new ZoomHandler();\n    this.displayPanel = new panel(this, 'neon-container', 'background', this.zoomHandler);\n\n    this.setViewEventHandlers();\n    this.displayPanel.setDisplayListeners();\n\n    this.pageURI = image;\n\n    document.getElementById('loading').style.display = 'none';\n  }\n\n  /**\n   * Update the SVG being displayed.\n   * @param svg - New rendered SVG to use.\n   */\n  updateSVG (svg: SVGSVGElement): void {\n    this.group.replaceChild(svg, this.mei);\n    this.mei = svg;\n    this.mei.id = 'mei_output';\n    this.mei.classList.add('neon-container', 'active-page');\n    const height = parseInt(this.mei.getAttribute('height'));\n    const width = parseInt(this.mei.getAttribute('width'));\n\n    this.bg.setAttribute('height', height.toString());\n    this.bg.setAttribute('width', width.toString());\n    this.group.setAttribute('viewBox', '0 0 ' + width + ' ' + height);\n    updateHighlight();\n    this.resetTransformations();\n    this.updateCallbacks.forEach(callback => callback());\n  }\n\n  /**\n   * Change to a certain page\n   * Since there is only one page, this is essentially a wrapper for updateSVG\n   */\n  async changePage (_page: number, _delay: boolean): Promise<void> {\n    const svg = await this.neonView.getPageSVG(this.getCurrentPageURI());\n    this.updateSVG(svg);\n  }\n\n  /**\n   * Add a callback to the list of those be called when the page updates.\n   * @param cb - The callback function.\n   */\n  addUpdateCallback (cb: () => void): void {\n    this.updateCallbacks.push(cb);\n  }\n\n  /**\n   * Remove a callback from the list of callbacks if it is part of the list.\n   * @param cb - The callback function.\n   */\n  removeUpdateCallback (cb: () => void): void {\n    const index = this.updateCallbacks.findIndex((elem) => {\n      return elem === cb;\n    });\n    if (index !== -1) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Reset the transformations that have been applied to the SVG upon update.\n   */\n  resetTransformations (): void {\n    this.displayPanel.zoomHandler.restoreTransformation();\n    setOpacityFromSlider();\n  }\n\n  /**\n   * @returns The zero-indexed number of the current page. This will always be zero.\n   */\n  getCurrentPage (): number {\n    return 0;\n  }\n\n  /**\n   * @returns The URI of the page.\n   */\n  getCurrentPageURI (): string {\n    return this.pageURI;\n  }\n\n  /**\n   * Set event handlers for the view and display panel.\n   */\n  setViewEventHandlers (): void {\n    document.body.addEventListener('keydown', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          d3.select('#svg_group').call(\n            d3.drag().on('start', this.displayPanel.zoomHandler.startDrag.bind(this.displayPanel.zoomHandler))\n              .on('drag', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler))\n          );\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'hidden');\n          break;\n        default: break;\n      }\n    });\n    document.body.addEventListener('keyup', (evt) => {\n      switch (evt.key) {\n        case 'Shift':\n          d3.select('#svg_group').on('.drag', null);\n          if (this.neonView.getUserMode() !== 'viewer') {\n            this.neonView.NeumeEdit.setSelectListeners();\n          }\n          break;\n        case 'h':\n          document.getElementById('mei_output').setAttribute('visibility', 'visible');\n          break;\n        default: break;\n      }\n    });\n\n    d3.select('#container').on('touchstart', () => {\n      if (d3.event.touches.length === 2) {\n        this.displayPanel.zoomHandler.startDrag();\n        d3.select('#container').on('touchmove', this.displayPanel.zoomHandler.dragging.bind(this.displayPanel.zoomHandler));\n        d3.select('#container').on('touchend', () => {\n          d3.select('#container').on('touchmove', null);\n        });\n      }\n    });\n    d3.select('#container').on('wheel', this.displayPanel.zoomHandler.scrollZoom.bind(this.displayPanel.zoomHandler), false);\n    // Update height of container based on window\n    window.onresize = (): void => {\n      const newHeight = window.innerHeight;\n      const container = document.getElementById('container');\n      if (newHeight > Number(container.getAttribute('height'))) {\n        container.setAttribute('height', newHeight.toString());\n      }\n    };\n  }\n\n  /**\n   * @returns A human readable name for the page. Used for downloads.\n   */\n  getPageName (): string {\n    return this.neonView.name;\n  }\n}\n\nexport { SingleView as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\nclass DivaEdit implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '.active-page > svg');\n    this.insertHandler = new InsertHandler(this.neonView, '.active-page > svg');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    Select.setSelectStrokeWidth(1);\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('.active-page > svg > svg, .active-page > svg > svg use, .active-page > svg > svg rect');\n    Select.dragSelect('.active-page svg');\n  }\n}\n\nexport { DivaEdit as default };\n","import { bindInsertTabs, initInsertEditControls, initEditModeControls, initSelectionButtons } from './Controls';\nimport { setHighlightSelectionControls } from '../DisplayPanel/DisplayControls';\nimport * as Select from '../utils/Select';\nimport InsertHandler from './InsertHandler';\nimport NeonView from '../NeonView';\nimport * as SelectOptions from './SelectOptions';\nimport DragHandler from '../utils/DragHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * An Edit Module for a single page of a manuscript.\n * Works with the SingleView module.\n */\nclass SingleEditMode implements NeumeEditInterface {\n  neonView: NeonView;\n  dragHandler: DragHandler;\n  insertHandler: InsertHandler;\n  /**\n   * Constructor for an EditMode object.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    initEditModeControls(this);\n  }\n\n  /**\n   * Initialize the start of edit mode when first leaving viewer mode.\n   */\n  initEditMode (): void {\n    this.dragHandler = new DragHandler(this.neonView, '#svg_group');\n    this.insertHandler = new InsertHandler(this.neonView, '#svg_group');\n    bindInsertTabs(this.insertHandler);\n    document.getElementById('primitiveTab').click();\n    Select.setSelectHelperObjects(this.neonView, this.dragHandler);\n    this.setSelectListeners();\n\n    SelectOptions.initNeonView(this.neonView);\n    initInsertEditControls();\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n\n    initSelectionButtons();\n\n    setHighlightSelectionControls();\n\n    this.neonView.view.addUpdateCallback(this.setSelectListeners.bind(this));\n  }\n\n  /**\n   * Get the user mode that Neon is in. Either insert, edit, or viewer.\n   * @returns {string}\n   */\n  getUserMode (): string {\n    if (this.insertHandler !== undefined) {\n      if (this.insertHandler.isInsertMode()) {\n        return 'insert';\n      }\n      return 'edit';\n    }\n    return 'viewer';\n  }\n\n  setSelectListeners (): void {\n    Select.clickSelect('#svg_group, #svg_group use, #svg_group rect');\n    Select.dragSelect('#svg_group');\n  }\n}\n\nexport { SingleEditMode as default };\n","/** @module InfoModule */\n\nimport NeonView from './NeonView';\nimport { InfoInterface } from './Interfaces';\nimport { Attributes } from './Types';\n\n/**\n * Map of contours to neume names.\n */\nconst neumeGroups = new Map(\n  [['', 'Punctum'], ['u', 'Pes'], ['d', 'Clivis'], ['uu', 'Scandicus'], ['ud', 'Torculus'], ['du', 'Porrectus'], ['s', 'Distropha'], ['ss', 'Tristopha'],\n    ['sd', 'Pressus'], ['dd', 'Climacus'], ['ddu', 'Climacus resupinus'], ['udu', 'Torculus resupinus'], ['dud', 'Porrectus flexus'],\n    ['udd', 'Pes subpunctis'], ['uud', 'Scandicus flexus'], ['uudd', 'Scandicus subpunctis'], ['dudd', 'Porrectus subpunctis']]\n);\n\nfunction startInfoVisibility (): void {\n  document.getElementById('neume_info').innerHTML =\n    '<article class=\\'message\\'><div class=\\'message-header\\'><p></p></div>' +\n      '<div class=\\'message-body\\'></div>';\n  document.getElementById('neume_info').setAttribute('style', 'display: none');\n}\n\n/**\n * Update the visibility of infoBox\n */\nfunction updateInfoVisibility (): void {\n  const neumeInfo = document.getElementById('neume_info');\n  if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n    neumeInfo.setAttribute('style', '');\n  } else {\n    neumeInfo.setAttribute('style', 'display: none');\n  }\n}\n\n/**\n * Set listener on info visibility checkbox.\n */\nfunction setInfoControls (): void {\n  startInfoVisibility();\n  updateInfoVisibility();\n  document.getElementById('displayInfo').addEventListener('click', updateInfoVisibility);\n}\n\n/**\n * Class that manages getting information for elements in Neon from Verovio.\n */\nclass InfoModule implements InfoInterface {\n  private neonView: NeonView;\n\n  /**\n   * A constructor for an InfoModule.\n   * @param {NeonView} neonView - The NeonView parent.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    // Add info box enable/disable check box\n    const block = document.getElementById('extensible-block');\n    const label = document.createElement('label');\n    label.classList.add('checkbox');\n    label.textContent = 'Display Info: ';\n    const input = document.createElement('input');\n    input.classList.add('checkbox');\n    input.id = 'displayInfo';\n    input.type = 'checkbox';\n    input.checked = false;\n    label.appendChild(input);\n    block.prepend(label);\n\n    this.neonView.view.addUpdateCallback(this.resetInfoListeners.bind(this));\n    setInfoControls();\n    this.resetInfoListeners();\n  }\n\n  /**\n   * Set listeners for the InfoModule.\n   * Trigger action on mouseover of specific musical element classes.\n   */\n  infoListeners (): void {\n    try {\n      document.getElementsByClassName('active-page')[0]\n        .querySelectorAll('.neume,.custos,.clef')\n        .forEach(node => {\n          node.addEventListener('mouseover', this.updateInfo.bind(this));\n        });\n    } catch (e) {}\n  }\n\n  /**\n   * Stop listeners for the InfoModule.\n   */\n  stopListeners (): void {\n    document.querySelectorAll('.neume,.custos,.clef').forEach(node => {\n      node.removeEventListener('mouseover', this.updateInfo.bind(this));\n    });\n  }\n\n  /**\n   * Restart listeners for the InfoModule.\n   */\n  resetInfoListeners (): void {\n    this.stopListeners();\n    this.infoListeners();\n  }\n\n  /**\n   * Get updated info for the calling element based on its element type.\n   * Makes calls to NeonCore to get the information necessary.\n   */\n  async updateInfo (event: MouseEvent): Promise<void> {\n  // For now, since Clefs do not have their own element tag in mei4, there is not a way to select the <g> element\n  // So we will simply return if ID does not exist for now\n    const id = (event.currentTarget as HTMLElement).id;\n    if (id === '') {\n      Array.from(document.getElementById('neume_info').children).forEach(child => {\n        child.remove();\n      });\n      console.log('No id!');\n      return;\n    }\n\n    const element = document.getElementById(id);\n    const classRe = /neume|nc|clef|custos|staff/;\n    const elementClass = element.getAttribute('class').match(classRe)[0];\n    let body = '';\n    let attributes: Attributes;\n\n    // Gets the pitches depending on element type and\n    switch (elementClass) {\n      case 'neume':\n        // Select neume components of selected neume\n        const ncs = element.querySelectorAll('.nc') as NodeListOf<SVGGraphicsElement>;\n        let contour = await this.getContour(ncs);\n        if (contour === 'Clivis') {\n          const attr: Attributes = await this.neonView.getElementAttr(ncs[0].id, this.neonView.view.getCurrentPageURI());\n          if (attr.ligated) {\n            contour = 'Ligature';\n          }\n        }\n        let pitches = await this.getPitches(ncs);\n\n        pitches = pitches.trim().toUpperCase();\n        body = 'Shape: ' + (contour === undefined ? 'Compound' : contour) + '\\r\\n' +\n                'Pitch(es): ' + pitches;\n        break;\n      case 'custos':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Pitch: ' + (attributes['pname']).toUpperCase() + attributes['oct'];\n        break;\n      case 'clef':\n        attributes = await this.neonView.getElementAttr(id, this.neonView.view.getCurrentPageURI());\n        body += 'Shape: ' + attributes['shape'] + '\\r\\n' +\n                'Line: ' + attributes['line'];\n        break;\n      default:\n        body += 'nothing';\n        break;\n    }\n    this.updateInfoModule(elementClass, body);\n  }\n\n  /**\n   * Get the individual pitches of a neume.\n   * @param ncs - Neume components in the neume.\n   * @returns Space separated pitches of the neume components in order.\n   */\n  async getPitches (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let pitches = '';\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      pitches += attributes['pname'] + attributes['oct'] + ' ';\n    }\n    return pitches;\n  }\n\n  /**\n   * Get the contour of a neume.\n   * @param ncs - Neume components in the neume.\n   */\n  async getContour (ncs: Iterable<SVGGraphicsElement>): Promise<string> {\n    let contour = '';\n    let previous: Attributes = null;\n    for (const nc of ncs) {\n      const attributes: Attributes = await this.neonView.getElementAttr(nc.id, this.neonView.view.getCurrentPageURI());\n      if (previous !== null) {\n        if (previous['oct'] > attributes['oct']) {\n          contour += 'd';\n        } else if (previous['oct'] < attributes['oct']) {\n          contour += 'u';\n        } else {\n          if (this.pitchNameToNum(previous['pname']) < this.pitchNameToNum(attributes['pname'])) {\n            contour += 'u';\n          } else if (this.pitchNameToNum(previous['pname']) > this.pitchNameToNum(attributes['pname'])) {\n            contour += 'd';\n          } else {\n            contour += 's';\n          }\n        }\n      }\n      previous = attributes;\n    }\n    if (neumeGroups.get(contour) === undefined) {\n      console.warn('Unknown contour: ' + contour);\n    }\n    return neumeGroups.get(contour);\n  }\n\n  /**\n   * Show and update the info box.\n   * @param title - The info box title.\n   * @param body - The info box contents.\n   */\n  updateInfoModule (title: string, body: string): void {\n    document.getElementsByClassName('message-header')[0].querySelector('p')\n      .textContent = title;\n    (document.getElementsByClassName('message-body')[0] as HTMLElement).innerText = body;\n\n    if ((document.getElementById('displayInfo') as HTMLInputElement).checked) {\n      (document.getElementsByClassName('message')[0] as HTMLElement).style.display = '';\n    }\n  }\n\n  /**\n   * Convert a pitch name (a-g) to a number (where c is 1, d is 2, ...and b is 7).\n   * @param pname - The pitch name.\n   * @returns Equivalent pitch name as a number from 1 to 7.\n   */\n  pitchNameToNum (pname: string): number {\n    switch (pname) {\n      case 'c':\n        return 1;\n      case 'd':\n        return 2;\n      case 'e':\n        return 3;\n      case 'f':\n        return 4;\n      case 'g':\n        return 5;\n      case 'a':\n        return 6;\n      case 'b':\n        return 7;\n      default:\n        console.log('Unknown pitch name');\n    }\n  }\n\n  /**\n   * Find the contour of an neume grouping based on the grouping name.\n   * @param value - The contour name.\n   * @returns Best guess name of the neume shape.\n   */\n  getContourByValue (value: string): string {\n    for (const [cont, v] of neumeGroups.entries()) {\n      if (v === value) {\n        return cont;\n      }\n    }\n  }\n}\n\nexport { InfoModule as default };\n","import * as Notification from './utils/Notification';\nimport NeonView from './NeonView';\nimport { unselect } from './utils/SelectTools';\nimport { updateHighlight } from './DisplayPanel/DisplayControls';\nimport { TextViewInterface } from './Interfaces';\n\n/*\n * Class that manages getting the text for syllables in Neon from the mei file\n */\nclass TextView implements TextViewInterface {\n  private neonView: NeonView;\n  /** Whether or not the user has been notified about blank syllables. */\n  private notificationSent: boolean;\n  /**\n   * A constructor for a TextView.\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.notificationSent = false;\n\n    // add checkbox to enable/disable the view\n    const block = document.getElementById('extensible-block');\n    const textLabel = document.createElement('label');\n    const bboxLabel = document.createElement('label');\n    const textButton = document.createElement('input');\n    const bboxButton = document.createElement('input');\n    textLabel.classList.add('checkbox');\n    bboxLabel.classList.add('checkbox');\n    textLabel.textContent = 'Display Text: ';\n    bboxLabel.textContent = 'Display Text BBoxes: ';\n    textButton.classList.add('checkbox');\n    bboxButton.classList.add('checkbox');\n    textButton.id = 'displayText';\n    textButton.type = 'checkbox';\n    bboxButton.id = 'displayBBox';\n    bboxButton.type = 'checkbox';\n    textButton.checked = false;\n    bboxButton.checked = false;\n    textLabel.appendChild(textButton);\n    bboxLabel.appendChild(bboxButton);\n    block.prepend(bboxLabel);\n    block.prepend(textLabel);\n\n    this.setTextViewControls();\n    this.neonView.view.addUpdateCallback(this.updateTextViewVisibility.bind(this));\n    this.neonView.view.addUpdateCallback(this.updateBBoxViewVisibility.bind(this));\n  }\n\n  /**\n  * Set listeners on textview visibility checkbox\n  */\n  setTextViewControls (): void {\n    function textViewVis (): void { this.updateTextViewVisibility(); }\n    function bboxViewVis (): void { this.updateBBoxViewVisibility(); }\n\n    this.updateTextViewVisibility();\n    this.updateBBoxViewVisibility();\n    document.getElementById('displayText')\n      .addEventListener('click', textViewVis.bind(this));\n    document.getElementById('displayBBox')\n      .addEventListener('click', bboxViewVis.bind(this));\n  }\n\n  /**\n   * Update visibility of text bounding boxes\n   */\n  updateBBoxViewVisibility (): void {\n    if ((document.getElementById('displayBBox')as HTMLInputElement).checked) {\n      document.querySelectorAll('.sylTextRect').forEach(rect => {\n        rect.classList.add('sylTextRect-display');\n        rect.classList.remove('sylTextRect');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect-display')\n        .forEach((rect: HTMLElement) => { rect.style.fill = 'red'; });\n\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initSelectByBBoxButton();\n      }\n    } else {\n      if ((document.getElementById('selByBBox') !== null) &&\n        document.getElementById('selByBBox').classList.contains('is-active')) {\n        unselect();\n        document.getElementById('selByBBox').classList.remove('is-active');\n        document.getElementById('selBySyl').classList.add('is-active');\n      }\n      document.querySelectorAll('.sylTextRect-display').forEach(rect => {\n        rect.classList.add('sylTextRect');\n        rect.classList.remove('sylTextRect-display');\n      });\n      document.querySelectorAll('.syl.selected .sylTextRect').forEach((rect: HTMLElement) => {\n        rect.style.fill = 'none';\n      });\n      try {\n        document.getElementById('selByBBox').style.display = 'none';\n      } catch (e) {}\n    }\n    updateHighlight();\n  }\n\n  /**\n  * Update the visibility of the textview box\n  * and add the event listeners to make sure the syl highlights when moused over\n  */\n  updateTextViewVisibility (): void {\n    if ((document.getElementById('displayText') as HTMLInputElement).checked) {\n      const sylText = document.getElementById('syl_text');\n      sylText.style.display = '';\n      sylText.innerHTML = '<p>' + this.getSylText() + '</p>';\n      const spans = sylText.querySelectorAll('p > span');\n      spans.forEach(span => {\n        const syllable = document.getElementById(span.className);\n        const syl = syllable.querySelector('.syl');\n        const text = syl.querySelector('text');\n        const rect = syl.querySelector('rect');\n        if (text.classList.length === 0) {\n          text.classList.add('text');\n        }\n\n        span.addEventListener('mouseover', () => {\n          syllable.classList.add('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.add('selected');\n          });\n          if (rect !== null) {\n            rect.style.fill = '#d00';\n          }\n          // syl.attr('fill', '#ffc7c7');\n          // this.highlightBoundingBox(span);\n        });\n\n        span.addEventListener('mouseleave', () => {\n          syllable.classList.remove('selected');\n          syllable.querySelectorAll('.neume').forEach(neume => {\n            neume.classList.remove('selected');\n          });\n          if (rect !== null) {\n            if (syllable.style.fill !== 'rgb(0, 0, 0)') { // syllable.getAttributeNS('http://www.w3.org/2000/SVG', 'fill');\n              rect.style.fill = syllable.getAttribute('fill');\n            } else {\n              rect.style.fill = 'blue';\n            }\n          }\n          // syl.attr('fill', null);\n          // this.removeBoundingBox(span);\n        });\n      });\n      if (this.neonView.getUserMode() !== 'viewer' && this.neonView.TextEdit !== undefined) {\n        this.neonView.TextEdit.initTextEdit();\n      }\n    } else {\n      document.getElementById('syl_text').style.display = 'none';\n    }\n  }\n\n  /**\n   * Get the syllable text of the loaded file\n   */\n  getSylText (): string {\n    let lyrics = '';\n    const uniToDash = /\\ue551/g;\n    const syllables = document.querySelectorAll('.active-page .syllable');\n    syllables.forEach(syllable => {\n      if (syllable.querySelector('.syl') !== null) {\n        const syl = syllable.querySelector('.syl');\n        lyrics += '<span class=\\'' + syllable.id + '\\'>';\n        if (syl.textContent.trim() === '') {\n          lyrics += '&#x25CA; ';\n        } else {\n          Array.from(syl.children[0].children[0].children).forEach(text => {\n            lyrics += text.textContent !== '' ? text.textContent : '&#x25CA; ';\n          });\n        }\n        lyrics += ' </span>';\n      }\n    });\n    if (!this.notificationSent) {\n      Notification.queueNotification('Blank syllables are represented by &#x25CA;!');\n      this.notificationSent = true;\n    }\n    return lyrics.replace(uniToDash, '-');\n  }\n}\n\nexport { TextView as default };\n","import { unselect } from './utils/SelectTools';\nimport DragHandler from './utils/DragHandler';\nimport NeonView from './NeonView';\nimport { setSelectHelperObjects, dragSelect, clickSelect } from './utils/Select';\nimport { setGroupingHighlight } from './utils/Color';\nimport { TextEditInterface } from './Interfaces';\n\n/**\n * Format a string for prompting the user.\n * @param rawString - The unformatted string.\n */\nfunction formatRaw (rawString: string): string {\n  const removeSymbol = /\\u{25CA}/u;\n  return rawString.replace(removeSymbol, '').trim();\n}\n\nfunction selBySylListener (): void {\n  if (!document.getElementById('selByBBox').classList.contains('is-active')) {\n    unselect();\n    try {\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n    } catch (e) {}\n    document.getElementById('selByBBox').classList.add('is-active');\n    try {\n      document.getElementById('selByNc').classList.remove('is-active');\n      document.getElementById('selByNeume').classList.remove('is-active');\n      document.getElementById('selByStaff').classList.remove('is-active');\n      document.getElementById('selBySyl').classList.remove('is-active');\n    } catch (e) {}\n    try {\n      if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n        setGroupingHighlight('syllable');\n      }\n    } catch (e) {}\n  }\n  this.addBBoxListeners();\n}\n\n/**\n * A Text editing module that works with the SingleView and DivaView modules\n */\nexport default class TextEditMode implements TextEditInterface {\n  private dragHandler: DragHandler;\n  private neonView: NeonView;\n\n  /**\n   * Constructor for a TextEdit\n   * @param neonView - The calling [[NeonView]] for the instance.\n   */\n  constructor (neonView: NeonView) {\n    this.neonView = neonView;\n    this.initEditModeControls();\n  }\n\n  /**\n   * Set listener on edit mode button to start editing.\n   */\n  initEditModeControls (): void {\n    document.getElementById('edit_mode').addEventListener('click', () => {\n      this.initTextEdit();\n      if ((document.getElementById('displayBBox') as HTMLInputElement).checked) {\n        this.initSelectByBBoxButton();\n      }\n    });\n  }\n\n  /**\n  * Set text to edit mode\n  */\n  initTextEdit (): void {\n    const spans = document.getElementById('syl_text').querySelectorAll('p > span');\n    spans.forEach(span => {\n      function updateSylText (): void {\n        this.updateSylText(span);\n      }\n\n      span.removeEventListener('click', updateSylText.bind(this));\n      span.addEventListener('click', updateSylText.bind(this));\n    });\n  }\n\n  /**\n  * Add the selectByBBox button.\n  * If neume edit mode is there, add it to the bar with the other select by buttons.\n  * Otherwise add an invisible button\n  * since the only edit mode is selectByRect in that case\n  */\n  initSelectByBBoxButton (): void {\n    if (this.neonView.NeumeEdit !== undefined) {\n      const selByBBox = document.getElementById('selByBBox');\n      if (selByBBox) {\n        selByBBox.style.display = '';\n        return;\n      }\n\n      const block = document.getElementById('selBySyl')\n        .closest('.control')\n        .closest('.field');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.addEventListener('click', selBySylListener.bind(this));\n      document.body.addEventListener('keydown', (evt) => {\n        if (evt.key === '5') {\n          if (document.getElementById('selByBBox').style.display === '') {\n            selBySylListener.bind(this)();\n          }\n        }\n      });\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    } else {\n      const block = document.getElementById('undo').closest('.control');\n      const p = document.createElement('p');\n      p.classList.add('control');\n      const button = document.createElement('button');\n      button.classList.add('button', 'sel-by');\n      button.id = 'selByBBox';\n      button.textContent = 'BBox';\n      p.appendChild(button);\n      block.appendChild(p);\n      button.classList.add('is-active');\n      button.style.display = 'none';\n      this.addBBoxListeners();\n      this.neonView.view.addUpdateCallback(this.addBBoxListeners.bind(this));\n    }\n  }\n\n  /**\n   * Initialize select by bbox mode\n   */\n  addBBoxListeners (): void {\n    if (document.getElementById('selByBBox').classList.contains('is-active')) {\n      unselect();\n      if (this.neonView.NeumeEdit === undefined) {\n        // just in case\n        this.dragHandler = new DragHandler(this.neonView, '.sylTextRect-display');\n        setSelectHelperObjects(this.neonView, this.dragHandler);\n        if (this.neonView.view.constructor.name === 'SingleView') {\n          clickSelect('#mei_output, #mei_output rect');\n          dragSelect('#svg_group');\n        } else {\n          clickSelect('.active-page > svg > svg, .active-page > svg > svg rect');\n          dragSelect('.active-page svg');\n        }\n      }\n    }\n  }\n\n  /**\n  * Update the text for a single syl element\n  */\n  updateSylText (span: HTMLSpanElement): void {\n    const orig = formatRaw(span.textContent);\n    const corrected = window.prompt('', orig);\n    if (corrected !== null && corrected !== orig) {\n      const editorAction = {\n        'action': 'setText',\n        'param': {\n          'elementId': [...span.classList.entries()].filter(e => e[1] !== 'text-select')[0][1],\n          'text': corrected\n        }\n      };\n      this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then((response) => {\n        if (response) {\n          this.neonView.updateForCurrentPage();\n        }\n      });\n    }\n  }\n}\n","import { uuidv4 } from './random';\n\nexport function zip<T> (array1: Array<T>, array2: Array<T>): Array<T> {\n  const result = [];\n  for (let i = 0; i < (array1.length > array2.length ? array2.length : array1.length); i++) {\n    result.push([array1[i], array2[i]]);\n  }\n  return result;\n}\n\nfunction copyAttributes(src: Element, dst: Element): void {\n  for (const attr of src.attributes) {\n    dst.setAttribute(attr.name, attr.value);\n  }\n}\n\nexport function convertStaffToSb(staffBasedMei: string): string {\n  const parser = new DOMParser();\n  const serializer = new XMLSerializer();\n  const meiDoc = parser.parseFromString(staffBasedMei, 'text/xml');\n  const mei = meiDoc.documentElement;\n\n  const precedesSyllables: Set<Element> = new Set();\n\n  for (const section of mei.getElementsByTagName('section')) {\n    const newStaff = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'staff');\n    const newLayer = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'layer');\n    newStaff.setAttribute('n', '1');\n    newLayer.setAttribute('n', '1');\n    newStaff.appendChild(newLayer);\n\n    const staves = Array.from(section.getElementsByTagName('staff'));\n\n    for (const staff of staves) {\n      const layer = staff.getElementsByTagName('layer')[0];\n\n      const sb = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'sb');\n      sb.setAttribute('n', staff.getAttribute('n'));\n      sb.setAttribute('facs', staff.getAttribute('facs'));\n      sb.setAttribute('xml:id', staff.getAttribute('xml:id'));\n\n      // Handle custos\n      let custos: Element = undefined;\n      if ((newLayer.lastElementChild !== null) &&\n        (newLayer.lastElementChild.tagName === 'custos')) {\n        custos = newLayer.removeChild(newLayer.lastElementChild);\n      }\n\n      // Insert sb either as last child of layer or in the last syllable\n      const lastElement = newLayer.lastElementChild;\n      if ((lastElement !== null) && (lastElement.tagName === 'syllable') && lastElement.hasAttribute('precedes')) {\n        if (custos !== undefined) lastElement.appendChild(custos);\n        lastElement.appendChild(sb);\n      }\n      else {\n        if (custos !== undefined) newLayer.appendChild(custos);\n        newLayer.appendChild(sb);\n      }\n\n      // Handle split syllables\n      for (const precedes of precedesSyllables) {\n        const followsId = precedes.getAttribute('precedes');\n        const followsSyllable = Array.from(layer.getElementsByTagName('syllable'))\n          .filter(syllable => { return '#' + syllable.getAttribute('xml:id') === followsId; })\n          .pop();\n        if (followsSyllable !== undefined) {\n          // Check for preceeding clef\n          if ((followsSyllable.previousElementSibling !== null) &&\n          (followsSyllable.previousElementSibling.tagName === 'clef')) {\n            precedes.append(followsSyllable.previousElementSibling);\n          }\n          while (followsSyllable.firstChild !== null) {\n            precedes.append(followsSyllable.firstChild);\n          }\n          followsSyllable.remove();\n          precedes.removeAttribute('precedes');\n          precedesSyllables.delete(precedes);\n        }\n      }\n\n      // Add remaining elements of layer to newLayer\n      while (layer.firstElementChild !== null) {\n        if (layer.firstElementChild.hasAttribute('precedes')) {\n          precedesSyllables.add(layer.firstElementChild);\n        }\n        newLayer.appendChild(layer.firstElementChild);\n      }\n      staff.remove();\n    }\n    section.appendChild(newStaff);\n  }\n\n  return serializer.serializeToString(meiDoc);\n}\n\nexport function convertSbToStaff(sbBasedMei: string): string {\n  const parser = new DOMParser();\n  const meiDoc = parser.parseFromString(sbBasedMei, 'text/xml');\n  const mei = meiDoc.documentElement;\n\n  // Go section by section just in case\n  for (const section of mei.getElementsByTagName('section')) {\n    // In case there are multiple staves here we want to preserve those\n    // A separate array is necessary as the HTMLCollection will update!\n    const originalStaves = Array.from(section.getElementsByTagName('staff'));\n    for (const staff of originalStaves) {\n      const layer = staff.getElementsByTagName('layer')[0];\n      // First pass: get all sb elements as direct children of layer\n      const sbArray = Array.from(layer.getElementsByTagName('sb'));\n      for (const sb of sbArray) {\n        if (sb.parentElement.tagName !== 'layer') {\n          const origSyllable: Element = sb.parentElement;\n          let neumeBehind = false, neumeAhead = false;\n          const childArray = Array.from(origSyllable.children);\n          const sbIndex = childArray.indexOf(sb);\n          for (const neume of origSyllable.getElementsByTagName('neume')) {\n            const ind = childArray.indexOf(neume);\n            if (ind < sbIndex) {\n              neumeBehind = true;\n            }\n            else if (ind > sbIndex) {\n              neumeAhead = true;\n            }\n          }\n\n          if (!neumeBehind && neumeAhead) {\n            origSyllable.insertAdjacentElement('beforebegin', sb);\n          }\n          else if (neumeBehind && !neumeAhead) {\n            origSyllable.insertAdjacentElement('afterend', sb);\n          }\n          else if (neumeBehind && neumeAhead){\n            // We may need to split the syllable here\n            const newSyllable = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'syllable');\n            newSyllable.setAttribute('xml:id', 'm-' + uuidv4());\n            newSyllable.setAttribute('follows', '#' + origSyllable.getAttribute('xml:id'));\n            origSyllable.setAttribute('precedes', '#' + newSyllable.getAttribute('xml:id'));\n\n            const sbIndex = childArray.indexOf(sb);\n\n            for (const child of childArray) {\n              const index = childArray.indexOf(child);\n              if (index > sbIndex) {\n                newSyllable.appendChild(child);\n              }\n            }\n\n            origSyllable.insertAdjacentElement('afterend', sb);\n            sb.insertAdjacentElement('afterend', newSyllable);\n\n            // Move any custos in origSyllable out of it\n            for (const custos of origSyllable.getElementsByTagName('custos')) {\n              origSyllable.insertAdjacentElement('afterend', custos);\n            }\n\n            // Move any clef in newSyllable out of it\n            for (const clef of newSyllable.getElementsByTagName('clef')) {\n              newSyllable.insertAdjacentElement('beforebegin', clef);\n            }\n          }\n          else {\n            console.warn('NONE BEHIND NONE AHEAD');\n            console.debug(origSyllable);\n          }\n        }\n      }\n\n      const sbs = Array.from(layer.getElementsByTagName('sb'));\n      for (let i = 0; i < sbs.length; i++) {\n        const currentSb = sbs[i];\n        const nextSb = (sbs.length > i + 1) ? sbs[i + 1] : undefined;\n\n        const newStaff = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'staff');\n        copyAttributes(currentSb, newStaff);\n        const newLayer = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'layer');\n        newLayer.setAttribute('n', '1');\n        newLayer.setAttribute('xml:id', 'm-' + uuidv4());\n        newStaff.appendChild(newLayer);\n\n        const childrenArray = Array.from(layer.children);\n        const copyArray = childrenArray.slice(childrenArray.indexOf(currentSb) + 1, childrenArray.indexOf(nextSb));\n\n        for (const child of copyArray) {\n          newLayer.appendChild(child);\n        }\n\n        section.insertBefore(newStaff, staff);\n      }\n      staff.remove();\n    }\n  }\n\n  // Second pass on all syllables to handle clefs and custos that might remain\n  for (const syllable of mei.querySelectorAll('syllable')) {\n    for (const clef of syllable.querySelectorAll('clef')) {\n      syllable.insertAdjacentElement('beforebegin', clef);\n    }\n    for (const custos of syllable.querySelectorAll('custos')) {\n      syllable.insertAdjacentElement('afterend', custos);\n    }\n  }\n\n  const serializer = new XMLSerializer();\n  return serializer.serializeToString(meiDoc);\n}\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","/** @module SquareEdit/Controls */\n\nimport * as Contents from './Contents';\nimport { setGroupingHighlight } from '../utils/Color';\nimport { unselect } from '../utils/SelectTools';\nimport InsertHandler from './InsertHandler';\nimport { NeumeEditInterface } from '../Interfaces';\n\n/**\n * Set listener on EditMode button.\n */\nexport function initEditModeControls (editMode: NeumeEditInterface) {\n  document.getElementById('edit_mode').addEventListener('click', function () {\n    document.getElementById('insert_controls').innerHTML += Contents.insertControlsPanel;\n    document.getElementById('edit_controls').innerHTML += Contents.editControlsPanel;\n    editMode.initEditMode();\n  });\n}\n\n/**\n * Bind listeners to insert tabs.'\n */\nexport function bindInsertTabs (insertHandler: InsertHandler) {\n  const insertTabs: Element[] = Array.from(document.getElementsByClassName('insertTab'));\n  const tabIds: string[] = insertTabs.map((tab) => { return tab.id; });\n\n  document.body.addEventListener('keydown', (evt: KeyboardEvent) => {\n    if (evt.code.match(/^Digit\\d$/) && evt.shiftKey) {\n      try {\n        const index = Number(evt.code[evt.code.length - 1]) - 1;\n        const insertOptions = document.getElementsByClassName('insertel');\n        const selectedOption = insertOptions[index];\n        deactivate('.insertel');\n        insertHandler.insertDisabled();\n        activate(selectedOption.id, insertHandler);\n      } catch (e) {\n        console.debug(e);\n      }\n    }\n  });\n\n  tabIds.forEach((tab) => {\n    document.getElementById(tab).addEventListener('click', () => {\n      deactivate('.insertTab');\n      activate(tab, insertHandler);\n      document.getElementById('insert_data').innerHTML = Contents.insertTabHtml[tab];\n      bindElements(insertHandler);\n      deactivate('.insertel');\n      const firstOption = document.getElementsByClassName('insertel')[0];\n      activate(firstOption.id, insertHandler);\n    });\n  });\n}\n\n/**\n * Initialize Edit and Insert control panels.\n */\nexport function initInsertEditControls () {\n  const toggleInsert = document.getElementById('toggleInsert');\n  const toggleEdit = document.getElementById('toggleEdit');\n  const insertContents = document.getElementById('insertContents');\n  const editContents = document.getElementById('editContents');\n  toggleInsert.parentElement.addEventListener('click', () => {\n    if (insertContents.style.display === 'none') {\n      insertContents.style.display = '';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      insertContents.style.display = 'none';\n      toggleInsert.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n\n  toggleEdit.parentElement.addEventListener('click', () => {\n    if (editContents.style.display === 'none') {\n      editContents.style.display = '';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-down');\n    } else {\n      editContents.style.display = 'none';\n      toggleEdit.setAttribute('xlink:href', __ASSET_PREFIX__ + 'assets/img/icons.svg' + '#dropdown-side');\n    }\n  });\n}\n\n/**\n * Activate a certain insert action.\n * @param id - The ID of the insert action tab.\n */\nfunction activate (id: string, insertHandler: InsertHandler) {\n  document.getElementById(id).classList.add('is-active');\n  if (document.getElementById(id).classList.contains('insertel')) {\n    insertHandler.insertActive(id);\n  }\n}\n\n/**\n * Deactivate a certain insert action.\n * @param type - A CSS selector for the action tab.\n */\nfunction deactivate (type: string) {\n  const elList = document.querySelectorAll(type);\n  elList.forEach(el => {\n    el.classList.remove('is-active');\n  });\n}\n\n/**\n * Bind listeners to insert tab elements.\n */\nfunction bindElements (insertHandler: InsertHandler) {\n  const insertElements = Array.from(document.getElementsByClassName('insertel'));\n  const elementIds = insertElements.map(el => el.id);\n  elementIds.forEach(el => {\n    document.getElementById(el).addEventListener('click', () => {\n      deactivate('.insertel');\n      activate(el, insertHandler);\n    });\n  });\n}\n\n/**\n * Set listeners on the buttons to change selection modes.\n */\nexport function initSelectionButtons () {\n  const selBySyl = document.getElementById('selBySyl');\n  const selByNeume = document.getElementById('selByNeume');\n  const selByNc = document.getElementById('selByNc');\n  const selByStaff = document.getElementById('selByStaff');\n\n  selBySyl.addEventListener('click', selectBySylHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '1') {\n      selectBySylHandler();\n    }\n  });\n\n  selByNeume.addEventListener('click', selectByNeumeHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '2') {\n      selectByNeumeHandler();\n    }\n  });\n\n  selByNc.addEventListener('click', selectByNcHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '3') {\n      selectByNcHandler();\n    }\n  });\n\n  selByStaff.addEventListener('click', selectByStaffHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === '4') {\n      selectByStaffHandler();\n    }\n  });\n\n  function selectBySylHandler () {\n    if (!selBySyl.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selBySyl.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('syllable');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNeumeHandler () {\n    if (!selByNeume.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selByNeume.classList.add('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByNcHandler () {\n    if (!selByNc.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selByNc.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      selByStaff.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('neume');\n        }\n      } catch (e) {}\n    }\n  }\n\n  function selectByStaffHandler () {\n    if (!selByStaff.classList.contains('is-active')) {\n      unselect();\n      document.getElementById('moreEdit').innerHTML = '';\n      document.getElementById('extraEdit').innerHTML = '';\n      document.getElementById('extraEdit').classList.add('is-invisible');\n      selByStaff.classList.add('is-active');\n      selByNeume.classList.remove('is-active');\n      selByNc.classList.remove('is-active');\n      selBySyl.classList.remove('is-active');\n      try {\n        document.getElementById('selByBBox').classList.remove('is-active');\n      } catch (e) {}\n      try {\n        if (document.querySelector('.highlight-selected').id === 'highlight-selection') {\n          setGroupingHighlight('staff');\n        }\n      } catch (e) {}\n    }\n  }\n}\n","import * as Contents from './Contents';\nimport * as Warnings from '../Warnings';\nimport * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport { unsetVirgaAction, unsetInclinatumAction, removeHandler, deleteButtonHandler } from './SelectOptions';\n\n/**\n * The NeonView parent to access editor actions.\n */\nlet neonView: NeonView;\n\n/**\n * Set the neonView member.\n */\nexport function initNeonView (view: NeonView): void {\n  neonView = view;\n}\n\n/**\n * Trigger the grouping selection menu.\n * @param type - The grouping type: nc, neume, syl, ligatureNc, or ligature\n */\nexport function triggerGrouping (type: string): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.classList.remove('is-invisible');\n  moreEdit.innerHTML += Contents.groupingMenu[type];\n  initGroupingListeners();\n}\n\n/**\n * Remove the grouping selection menu.\n */\nexport function endGroupingSelection (): void {\n  const moreEdit = document.getElementById('moreEdit');\n  moreEdit.innerHTML = '';\n  moreEdit.classList.add('is-invisible');\n  document.body.removeEventListener('keydown', deleteButtonHandler);\n}\n\n/**\n * The grouping dropdown listener.\n */\nexport function initGroupingListeners (): void {\n  const del = document.getElementById('delete');\n  del.removeEventListener('click', removeHandler);\n  del.addEventListener('click', removeHandler);\n  document.body.addEventListener('keydown', deleteButtonHandler);\n  try {\n    document.getElementById('mergeSyls').addEventListener('click', () => {\n      const elementIds = getChildrenIds().filter(e =>\n        document.getElementById(e).classList.contains('neume')\n      );\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNeumes').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('groupNcs').addEventListener('click', () => {\n      const elementIds = getIds();\n      groupingAction('group', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNeumes').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'neume', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('ungroupNcs').addEventListener('click', () => {\n      const elementIds = getChildrenIds();\n      groupingAction('ungroup', 'nc', elementIds);\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-ligature').addEventListener('click', async () => {\n      const elementIds = getIds();\n      let isLigature;\n      const ligatureRegex = /#E99[016]/;\n      if (!ligatureRegex.test(document.getElementById(elementIds[0]).children[0].getAttribute('xlink:href'))) { // SMUFL codes for ligature glyphs\n        isLigature = true;\n      } else {\n        isLigature = false;\n        const chainAction: EditorAction = { 'action': 'chain',\n          'param': [\n            unsetInclinatumAction(elementIds[0]), unsetVirgaAction(elementIds[0]),\n            unsetInclinatumAction(elementIds[1]), unsetVirgaAction(elementIds[1])\n          ] };\n        await neonView.edit(chainAction, neonView.view.getCurrentPageURI());\n      }\n\n      const editorAction: EditorAction = {\n        'action': 'toggleLigature',\n        'param': {\n          'elementIds': elementIds,\n          'isLigature': isLigature.toString()\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Ligature Toggled');\n        } else {\n          Notification.queueNotification('Ligature Toggle Failed');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n\n  try {\n    document.getElementById('toggle-link').addEventListener('click', () => {\n      const elementIds = getIds();\n      const chainAction: EditorAction = {\n        'action': 'chain',\n        'param': []\n      };\n      const param = new Array<EditorAction>();\n      if (document.getElementById(elementIds[0]).getAttribute('mei:precedes')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[1],\n            'text': ''\n          }\n        });\n      } else if (document.getElementById(elementIds[0]).getAttribute('mei:follows')) {\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[0],\n            'attrType': 'follows',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': elementIds[1],\n            'attrType': 'precedes',\n            'attrValue': ''\n          }\n        });\n        param.push({\n          'action': 'setText',\n          'param': {\n            'elementId': elementIds[0],\n            'text': ''\n          }\n        });\n      } else {\n        // Associate syllables. Will need to find which is first. Use staves.\n        const syllable0 = document.getElementById(elementIds[0]);\n        const syllable1 = document.getElementById(elementIds[1]);\n        const staff0 = syllable0.closest('.staff');\n        const staff1 = syllable1.closest('.staff');\n        const staffChildren = Array.from(staff0.parentElement.children).filter((elem: HTMLElement) => elem.classList.contains('staff'));\n\n        let firstSyllable, secondSyllable;\n        // Determine first syllable comes first by staff\n        if (staffChildren.indexOf(staff0) < staffChildren.indexOf(staff1)) {\n          firstSyllable = syllable0;\n          secondSyllable = syllable1;\n        } else {\n          firstSyllable = syllable1;\n          secondSyllable = syllable0;\n        }\n\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': firstSyllable.id,\n            'attrType': 'precedes',\n            'attrValue': '#' + secondSyllable.id\n          }\n        });\n        param.push({\n          'action': 'set',\n          'param': {\n            'elementId': secondSyllable.id,\n            'attrType': 'follows',\n            'attrValue': '#' + firstSyllable.id\n          }\n        });\n        // Delete syl on second syllable\n        const syl = secondSyllable.querySelector('.syl');\n        if (syl !== null) {\n          param.push({\n            'action': 'remove',\n            'param': {\n              'elementId': syl.id\n            }\n          });\n        }\n      }\n      chainAction.param = param;\n      neonView.edit(chainAction, neonView.view.getCurrentPageURI()).then((result) => {\n        if (result) {\n          Notification.queueNotification('Toggled Syllable Link');\n        } else {\n          Notification.queueNotification('Failed to Toggle Syllable Link');\n        }\n        endGroupingSelection();\n        neonView.updateForCurrentPage();\n      });\n    });\n  } catch (e) {}\n}\n\n/**\n * Form and execute a group/ungroup action.\n * @param action - The action to execute. Either \"group\" or \"ungroup\".\n * @param groupType - The type of elements to group. Either \"neume\" or \"nc\".\n * @param elementIds - The IDs of the elements.\n */\nfunction groupingAction (action: string, groupType: string, elementIds: string[]): void {\n  const editorAction: EditorAction = {\n    'action': action,\n    'param': {\n      'groupType': groupType,\n      'elementIds': elementIds\n    }\n  };\n  neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then((result) => {\n    if (result) {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Success');\n      } else {\n        Notification.queueNotification('Ungrouping Success');\n      }\n    } else {\n      if (action === 'group') {\n        Notification.queueNotification('Grouping Failed');\n      } else {\n        Notification.queueNotification('Ungrouping Failed');\n      }\n    }\n    neonView.updateForCurrentPage();\n\n    // Prompt user to confirm if Neon does not re cognize contour\n    if (groupType === 'nc') {\n      const neumeParent = document.getElementById(elementIds[0]).parentElement;\n      const ncs = Array.from(neumeParent.children) as SVGGraphicsElement[];\n      const contour = neonView.info.getContour(ncs);\n      if (contour === undefined) {\n        Warnings.groupingNotRecognized();\n      }\n    }\n    endGroupingSelection();\n  });\n}\n\n/**\n * @returns The IDs of selected elements.\n */\nfunction getIds (): string[] {\n  const ids = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    ids.push(el.id);\n  });\n  return ids;\n}\n\n/**\n * @returns The IDs of the selected elements' children.\n */\nfunction getChildrenIds (): string[] {\n  const childrenIds = [];\n  const elements = Array.from(document.getElementsByClassName('selected'));\n  elements.forEach(el => {\n    const children = Array.from(el.children);\n    children.forEach(ch => {\n      childrenIds.push(ch.id);\n    });\n  });\n  return childrenIds;\n}\n","import { getStaffBBox, selectBBox, selectStaff } from './SelectTools';\nimport NeonView from '../NeonView';\nimport DragHandler from './DragHandler';\n\nimport * as d3 from 'd3';\n\n/**\n * Resize a staff or a syllable text bounding box.\n * For staves, this also supports adjusting the rotate.\n */\ntype Point = { x: number; y: number; name: number };\n\n/**\n * The points you can click and drag to resize\n */\nconst PointNames = {\n  TopLeft: 0,\n  Top: 1,\n  TopRight: 2,\n  Right: 3,\n  BottomRight: 4,\n  Bottom: 5,\n  BottomLeft: 6,\n  Left: 7\n};\n\nfunction GetPoints(ulx: number, uly: number, lrx: number, lry: number, rotate: number): Point[] {\n  // Note that arc functions return an angle x in [-pi/2, pi/2].\n  let points: Array<Point>;\n  // ul is ulx, uly, lr is lrx, lry\n  if (rotate >= 0) {\n    points = [\n      { x: ulx, y: uly, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + (lrx - ulx) / 2 * Math.sin(rotate), name: PointNames.Top },\n      { x: lrx, y: uly + (lrx - ulx) * Math.sin(rotate), name: PointNames.TopRight },\n      { x: lrx, y: (uly + lry + (lrx - ulx) * Math.sin(rotate)) / 2, name: PointNames.Right },\n      { x: lrx, y: lry, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - (lrx - ulx) / 2 * Math.sin(rotate), name: PointNames.Bottom },\n      { x: ulx, y: lry - (lrx - ulx) * Math.sin(rotate), name: PointNames.BottomLeft },\n      { x: ulx, y: (uly + lry - (lrx - ulx) * Math.sin(rotate)) / 2, name: PointNames.Left }\n    ];\n  }\n  // Not that\n  else {\n    const a = (lrx - ulx) * Math.tan(Math.abs(rotate));\n    const b = lry - uly - a;\n    points = [\n      { x: ulx, y: uly + a, name: PointNames.TopLeft },\n      { x: (ulx + lrx) / 2, y: uly + a / 2, name: PointNames.Top },\n      { x: lrx, y: uly, name: PointNames.TopRight },\n      { x: lrx, y: uly + b / 2, name: PointNames.Right },\n      { x: lrx, y: uly + b, name: PointNames.BottomRight },\n      { x: (ulx + lrx) / 2, y: lry - a / 2, name: PointNames.Bottom },\n      { x: ulx, y: lry, name: PointNames.BottomLeft },\n      { x: ulx, y: lry - b / 2, name: PointNames.Left }\n    ];\n  }\n  return points;\n}\n\nexport function resize (element: SVGGraphicsElement, neonView: NeonView, dragHandler: DragHandler): void {\n  /**\n   * The upper-left x-coordinate of the element.\n   */\n  let ulx: number;\n  /**\n   * The upper-left y-coordinate of the element.\n   */\n  let uly: number;\n  /**\n   * The lower-right x-coordinate of the element.\n   */\n  let lrx: number;\n  /**\n   * The lower-right y-coordinate of the element.\n   */\n  let lry: number;\n\n  /**\n   * The rotate of the rect in radians.\n   */\n  let rotate: number;\n\n  let initialPoint: number[], initialUly: number, initialLry: number,\n    initialY: number, initialRectY: number, polyLen: number, dy: number, initialRotate: number;\n\n  drawInitialRect();\n  /**\n   * Draw the initial rectangle around the element\n   * and add the listeners to support dragging to resize.\n   */\n  function drawInitialRect (): void {\n    if (element === null) return;\n\n    // if it's a boundingbox just get the coordinates\n    if (element.classList.contains('syl')) {\n      const rect = element.querySelector('.sylTextRect-display');\n      if (rect === null) {\n        console.warn('Tried to draw resize rect for a sylTextRect that doesn\\'t exist (or isn\\'t displaying)');\n        return;\n      }\n      ulx = Number(rect.getAttribute('x'));\n      uly = Number(rect.getAttribute('y'));\n      lrx = +ulx + +rect.getAttribute('width');\n      lry = +uly + +rect.getAttribute('height');\n\n      rotate = 0;\n    }\n\n    // if it's a staff use the paths to get it's boundingbox\n    if (element.classList.contains('staff')) {\n      const bbox = getStaffBBox(element);\n      ulx = bbox.ulx;\n      uly = bbox.uly;\n      lrx = bbox.lrx;\n      lry = bbox.lry;\n\n      const coordinates: number[] = element.querySelector('path')\n        .getAttribute('d')\n        .match(/\\d+/g)\n        .map(element => Number(element));\n      rotate = Math.atan((coordinates[3] - coordinates[1]) /\n        (coordinates[2] - coordinates[0]));\n    }\n\n    let whichPoint: string;\n\n    const points = GetPoints(ulx, uly, lrx, lry, rotate);\n\n    polyLen = points[2].x - points[0].x;\n\n    const pointString = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#' + element.id).append('polygon')\n      .attr('points', pointString)\n      .attr('id', 'resizeRect')\n      .attr('stroke', 'black')\n      .attr('stroke-width', 10)\n      .attr('fill', 'none')\n      .style('cursor', 'move')\n      .style('stroke-dasharray', '20 10');\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select(element.viewportElement).append('circle')\n        .attr('cx', point.x)\n        .attr('cy', point.y)\n        .attr('r', 25)\n        .attr('stroke', 'black')\n        .attr('stroke-width', 4)\n        .attr('fill', '#0099ff')\n        .attr('class', 'resizePoint')\n        .attr('id', 'p-' + pointName);\n    }\n\n    // do it as a loop instead of selectAll so that you can easily know which point was\n    for (const name in PointNames) {\n      d3.select('#p-' + name).filter('.resizePoint').call(\n        d3.drag()\n          .on('start', () => { resizeStart(name); })\n          .on('drag', resizeDrag)\n          .on('end', resizeEnd.bind(this)));\n    }\n\n    if (element.classList.contains('staff')) {\n      let x = points[3].x;\n      let y = points[3].y;\n      const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n        (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n      x = points[7].x;\n      y = points[7].y;\n      const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n        (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringRight)\n        .attr('id', 'rotateRight')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'rotatePoint');\n\n      d3.select('#' + element.id).append('polygon')\n        .attr('points', pointStringLeft)\n        .attr('id', 'rotateLeft')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 7)\n        .attr('fill', '#0099ff')\n        .attr('class', 'rotatePoint');\n\n      d3.select('#rotateLeft').call(\n        d3.drag()\n          .on('start', rotateStart)\n          .on('drag', rotateDragLeft)\n          .on('end', rotateEnd));\n\n      d3.select('#rotateRight').call(\n        d3.drag()\n          .on('start', rotateStart)\n          .on('drag', rotateDragRight)\n          .on('end', rotateEnd));\n    }\n\n    function rotateStart (): void {\n      const which = d3.event.sourceEvent.target.id;\n      initialY = d3.mouse(this)[1];\n      initialLry = lry;\n      initialUly = uly;\n      initialRectY = (which === 'rotateRight' ? lry : uly);\n      initialRotate = rotate;\n    }\n\n    function rotateDragLeft (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempRotate = initialRotate - Math.atan(temp / polyLen);\n      if (tempRotate > -0.2 && tempRotate < 0.2) {\n        dy = temp;\n        uly = initialRectY + dy;\n        rotate = tempRotate;\n        if (rotate >= 0) {\n          uly = dy + points.filter(point => point.name === PointNames.TopLeft)[0].y;\n          lry = points.filter(point => point.name === PointNames.BottomRight)[0].y;\n        } else {\n          uly = points.filter(point => point.name === PointNames.TopRight)[0].y;\n          lry = dy + points.filter(point => point.name === PointNames.BottomLeft)[0].y;\n        }\n      }\n      redraw();\n    }\n\n    function rotateDragRight (): void {\n      const currentY = d3.mouse(this)[1];\n      const temp = currentY - initialY;\n      const tempRotate = initialRotate + Math.atan(temp / polyLen);\n      if (tempRotate > -0.2 && tempRotate < 0.2) {\n        dy = temp;\n        rotate = tempRotate;\n        if (rotate >= 0 ) {\n          lry = dy + points.filter(point => point.name === PointNames.BottomRight)[0].y;\n          uly = points.filter(point => point.name === PointNames.TopLeft)[0].y;\n        } else {\n          uly = dy + points.filter(point => point.name === PointNames.TopRight)[0].y;\n          lry = points.filter(point => point.name === PointNames.BottomLeft)[0].y;\n        }\n      }\n      redraw();\n    }\n\n    function rotateEnd (): void {\n      if (dy === undefined) {\n        dy = 0;\n      }\n      const editorAction = {\n        'action': 'resizeRotate',\n        'param': {\n          'elementId': element.id,\n          'ulx': ulx,\n          'uly': uly,\n          'lrx': lrx,\n          'lry': lry,\n          'rotate': rotate * 180 / Math.PI\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPage();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        dy = undefined;\n        drawInitialRect();\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          selectStaff(element, dragHandler);\n        }\n      });\n    }\n\n    function resizeStart (name: string): void {\n      whichPoint = name;\n      const point = points.find(point => { return point.name === PointNames[name]; });\n      initialPoint = [point.x, point.y];\n      initialUly = uly;\n      initialLry = lry;\n    }\n\n    function resizeDrag (): void {\n      const currentPoint = d3.mouse(this);\n      switch (PointNames[whichPoint]) {\n        case PointNames.TopLeft:\n          ulx = currentPoint[0];\n          uly = currentPoint[1];\n          break;\n        case PointNames.Top:\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(rotate) / 2;\n          break;\n        case PointNames.TopRight:\n          lrx = currentPoint[0];\n          uly = currentPoint[1] - (lrx - ulx) * Math.tan(rotate);\n          break;\n        case PointNames.Right:\n          lrx = currentPoint[0];\n          lry = initialLry + (currentPoint[0] - initialPoint[0]) * Math.tan(rotate);\n          break;\n        case PointNames.BottomRight:\n          lrx = currentPoint[0];\n          lry = currentPoint[1];\n          break;\n        case PointNames.Bottom:\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(rotate) / 2;\n          break;\n        case PointNames.BottomLeft:\n          ulx = currentPoint[0];\n          lry = currentPoint[1] + (lrx - ulx) * Math.tan(rotate);\n          break;\n        case PointNames.Left:\n          ulx = currentPoint[0];\n          uly = initialUly + (currentPoint[0] - initialPoint[0]) * Math.tan(rotate);\n          break;\n        default:\n          console.error('Something that wasn\\'t a side of the rectangle was dragged. This shouldn\\'t happen.');\n      }\n      redraw();\n    }\n\n    function resizeEnd (): void {\n      const editorAction = {\n        'action': 'resize',\n        'param': {\n          'elementId': element.id,\n          'ulx': ulx,\n          'uly': uly,\n          'lrx': lrx,\n          'lry': lry\n        }\n      };\n      neonView.edit(editorAction, neonView.view.getCurrentPageURI()).then(async (result) => {\n        if (result) {\n          await neonView.updateForCurrentPage();\n        }\n        element = document.getElementById(element.id) as unknown as SVGGraphicsElement;\n        ulx = undefined;\n        uly = undefined;\n        lrx = undefined;\n        lry = undefined;\n        d3.selectAll('.resizePoint').remove();\n        d3.selectAll('#resizeRect').remove();\n        d3.selectAll('.rotatePoint').remove();\n        drawInitialRect();\n        if (element.classList.contains('syl')) {\n          selectBBox(element.querySelector('.sylTextRect-display'), dragHandler, this);\n        } else {\n          try {\n            document.getElementById('moreEdit').innerHTML = '';\n            document.getElementById('moreEdit').classList.add('is-invisible');\n          } catch (e) {}\n        }\n      });\n    }\n  }\n\n  /**\n   * Redraw the rectangle with the new bounds\n   */\n  function redraw (): void {\n    const points: Point[] = GetPoints(ulx, uly, lrx, lry, rotate);\n\n    const pointString: string = points.filter((_elem, index) => { return index % 2 === 0; })\n      .map(elem => elem.x + ',' + elem.y)\n      .join(' ');\n\n    d3.select('#resizeRect').attr('points', pointString);\n\n    for (const pointName in PointNames) {\n      const point: Point = points[PointNames[pointName]];\n      d3.select('#p-' + pointName).filter('.resizePoint')\n        .attr('cx', point.x)\n        .attr('cy', point.y);\n    }\n\n    let x = points[3].x;\n    let y = points[3].y;\n    const pointStringRight = (x + 100) + ',' + (y + 85) + ' ' +\n      (x + 70) + ',' + (y + 50) + ' ' + (x + 100) + ',' + (y + 15) + ' ' + (x + 130) + ',' + (y + 50);\n    x = points[7].x;\n    y = points[7].y;\n    const pointStringLeft = (x - 100) + ',' + (y - 15) + ' ' +\n      (x - 130) + ',' + (y - 50) + ' ' + (x - 100) + ',' + (y - 85) + ' ' + (x - 70) + ',' + (y - 50);\n\n    d3.select('#rotateLeft').attr('points', pointStringLeft);\n    d3.select('#rotateRight').attr('points', pointStringRight);\n  }\n}\n","import NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport * as d3 from 'd3';\n\n/**\n * Class that handles insert mode, events, and actions.\n */\nclass InsertHandler {\n  type: string;\n  firstClick = true;\n  coord: DOMPoint;\n  attributes: object;\n  selector: string;\n  neonView: NeonView;\n\n  /**\n   * @param neonView - NeonView parent.\n   * @param sel - The CSS selector to apply insert listeners to.\n   */\n  constructor (neonView: NeonView, sel: string) {\n    this.neonView = neonView;\n    this.selector = sel;\n  }\n\n  /**\n   * Called when an insert button is clicked.\n   * Triggers the start of insert mode.\n   * @param buttonId - The ID of the button that was clicked.\n   */\n  insertActive (buttonId: string): void {\n    const alreadyInInsertMode = this.isInsertMode();\n    switch (buttonId) {\n      case 'punctum':\n        this.type = 'nc';\n        this.attributes = null;\n        break;\n      case 'diamond':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'se' };\n        break;\n      case 'virga':\n        this.type = 'nc';\n        this.attributes = { 'tilt': 'n' };\n        break;\n      case 'pes':\n      case 'clivis':\n      case 'scandicus':\n      case 'climacus':\n      case 'torculus':\n      case 'porrectus':\n      case 'pressus':\n        const contour = this.neonView.info.getContourByValue(\n          buttonId.charAt(0).toUpperCase() + buttonId.slice(1)\n        );\n        this.type = 'grouping';\n        this.attributes = { 'contour': contour };\n        break;\n      case 'cClef':\n      case 'fClef':\n        this.type = 'clef';\n        this.attributes = { 'shape': buttonId.charAt(0).toUpperCase() };\n        break;\n      case 'custos':\n        this.type = 'custos';\n        this.attributes = null;\n        break;\n      case 'staff':\n        this.type = 'staff';\n        this.attributes = null;\n        break;\n      default:\n        this.type = '';\n        this.attributes = null;\n        console.error('Invalid button for insertion: ' + buttonId + '.');\n        return;\n    }\n\n    this.removeInsertClickHandlers();\n    if (this.type === 'staff') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.staffHandler);\n    } else {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.handler);\n    }\n\n    // Disable edit mode listeners\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetInsertHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    // Add 'return to edit mode' button\n    if (!alreadyInInsertMode) {\n      const editModeButton = document.createElement('button');\n      editModeButton.id = 'returnToEditMode';\n      editModeButton.classList.add('button');\n      editModeButton.innerHTML = 'Return to Edit Mode';\n      document.getElementById('redo').parentNode.appendChild(editModeButton);\n      editModeButton.addEventListener('click', this.insertDisabled);\n    }\n    const editMenu = document.getElementById('editMenu');\n    editMenu.style.backgroundColor = 'whitesmoke';\n    editMenu.style.fontWeight = '';\n    const insertMenu = document.getElementById('insertMenu');\n    insertMenu.style.backgroundColor = '#ffc7c7';\n    insertMenu.style.fontWeight = 'bold';\n  }\n\n  /**\n   * Disable insert mode and remove event listeners.\n   */\n  insertDisabled = (function insertDisabled (): void {\n    this.type = '';\n    this.removeInsertClickHandlers();\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetInsertHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    const selected = document.querySelector('.insertel.is-active');\n    if (selected !== null) {\n      selected.classList.remove('is-active');\n    }\n    this.firstClick = true;\n    try {\n      document.getElementById('returnToEditMode').remove();\n    } catch (e) {\n      // console.debug(e);\n    }\n    const editMenu = document.getElementById('editMenu');\n    const insertMenu = document.getElementById('insertMenu');\n    editMenu.style.backgroundColor = '#ffc7c7';\n    editMenu.style.fontWeight = 'bold';\n    insertMenu.style.backgroundColor = 'whitesmoke';\n    insertMenu.style.fontWeight = '';\n  }).bind(this);\n\n  /**\n   * Event handler to handle a user clicking away from the active page\n   * causing insert mode to end.\n   */\n  clickawayHandler = (function clickawayHandler (evt: MouseEvent): void {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null &&\n      target.closest('#insert_controls') === null &&\n      target.closest('#svg_group') === null) {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown',\n        this.staffHandler);\n      document.body.removeEventListener('keydown',\n        this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Resets an insert event listener after temporarily removing it.\n   */\n  resetInsertHandler = (function resetInsertHandler (evt: KeyboardEvent): void {\n    if (evt.key === 'Shift') {\n      document.querySelector(this.selector)\n        .addEventListener('click', this.type === 'staff' ?\n          this.staffHandler : this.handler);\n    }\n  }).bind(this);\n\n  /**\n   * Listens to key presses to either exit edit mode (if Escape) or\n   * temporarily remove insert event listeners (if Shift).\n   */\n  keydownListener = (function keydownListener (evt: KeyboardEvent): void {\n    if (evt.key === 'Escape') {\n      this.insertDisabled();\n      document.body.removeEventListener('keydown', this.staffHandler);\n      document.body.removeEventListener('keydown', this.handler);\n    } else if (evt.key === 'Shift') {\n      this.removeInsertClickHandlers();\n    }\n  }).bind(this);\n\n  /**\n   * Event handler for clicking to insert any element except a staff.\n   */\n  handler = (function handler (evt: MouseEvent): void {\n    evt.stopPropagation();\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    // Transform pt to SVG context\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    const editorAction: EditorAction = {\n      'action': 'insert',\n      'param': {\n        'elementType': this.type,\n        'staffId': 'auto',\n        'ulx': cursorpt.x,\n        'uly': cursorpt.y\n      }\n    };\n\n    if (this.attributes !== null) {\n      editorAction['param']['attributes'] = this.attributes;\n      if (this.attributes['shape'] === 'F') {\n        editorAction['param']['ulx'] -= 50;\n      }\n    }\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(() => {\n      return this.neonView.updateForCurrentPage();\n    }).then(() => {\n      document.querySelector(this.selector).addEventListener('click', this.handler);\n    });\n  }).bind(this);\n\n  /**\n   * Event handler to insert a staff.\n   */\n  staffHandler = (function staffHandler (evt: MouseEvent): void {\n    const container = document.getElementsByClassName('active-page')[0].getElementsByClassName('definition-scale')[0] as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGraphicsElement).getScreenCTM();\n    const cursorpt = pt.matrixTransform(transformMatrix.inverse());\n\n    if (this.firstClick) {\n      this.coord = cursorpt;\n      d3.select(container).append('circle').attr('cx', cursorpt.x)\n        .attr('cy', cursorpt.y)\n        .attr('r', 10)\n        .attr('id', 'staff-circle')\n        .attr('fill', 'green');\n      this.firstClick = false;\n    } else {\n      let ul, lr;\n      if (cursorpt.x < this.coord.x || cursorpt.y < this.coord.y) { // second point is not lr\n        ul = cursorpt;\n        lr = this.coord;\n      } else {\n        ul = this.coord;\n        lr = cursorpt;\n      }\n      document.getElementById('staff-circle').remove();\n      const action: EditorAction = {\n        'action': 'insert',\n        'param': {\n          'elementType': 'staff',\n          'staffId': 'auto',\n          'ulx': ul.x,\n          'uly': ul.y,\n          'lrx': lr.x,\n          'lry': lr.y\n        }\n      };\n\n      this.neonView.edit(action, this.neonView.view.getCurrentPageURI()).then(() => {\n        this.neonView.updateForCurrentPage();\n        this.firstClick = true;\n      });\n    }\n  }).bind(this);\n\n  /**\n   * Remove the insert listeners while not leaving insert mode entirely.\n   */\n  removeInsertClickHandlers = (function removeInsertClickHandlers (): void {\n    document.querySelector(this.selector).removeEventListener('click', this.staffHandler);\n    document.querySelector(this.selector).removeEventListener('click', this.handler);\n  }).bind(this);\n\n  isInsertMode (): boolean {\n    return (this.type !== '');\n  }\n}\nexport { InsertHandler as default };\n","import NeonView from '../../src/NeonView';\nimport DisplayPanel from '../../src/DisplayPanel/DisplayPanel';\nimport DivaView from '../../src/DivaView';\nimport SingleView from '../../src/SingleView/SingleView';\nimport DivaEdit from '../../src/SquareEdit/DivaEditMode';\nimport SingleEditMode from '../../src/SquareEdit/SingleEditMode';\nimport InfoModule from '../../src/InfoModule';\nimport TextView from '../../src/TextView';\nimport TextEditMode from '../../src/TextEditMode';\n\nimport PouchDB from 'pouchdb';\n\nlet name = getGetParam('manifest');\nlet manifestLocation = 'manifests/' + name + '.jsonld';\nlet storage = getGetParam('storage');\n\nif (name) {\n  window.fetch(manifestLocation).then(response => {\n    if (response.ok) {\n      return response.text();\n    } else {\n      throw new Error(response.statusText);\n    }\n  }).then(async text => {\n    let manifest;\n    try {\n      manifest = JSON.parse(text);\n    } catch (e) {\n      console.error(e);\n      console.debug(text);\n      return;\n    }\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n    // Determine if it is a single page or multiple by media type\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n} else {\n  let db = new PouchDB('Neon-User-Storage');\n  db.getAttachment(storage, 'manifest').then(blob => {\n    return new window.Response(blob).json();\n  }).then(async manifest => {\n    console.log(manifest);\n    let params = {\n      manifest: manifest,\n      Display: DisplayPanel,\n      Info: InfoModule,\n      TextView: TextView,\n      TextEdit: TextEditMode\n    };\n\n    let mediaType = await new Promise((resolve, reject) => {\n      window.fetch(manifest.image).then(response => {\n        resolve(response.headers.get('Content-Type'));\n      }).catch(err => {\n        reject(err);\n      });\n    });\n    if (mediaType.match(/image\\/*/)) {\n      params.View = SingleView;\n      params.NeumeEdit = SingleEditMode;\n    } else {\n      params.View = DivaView;\n      params.NeumeEdit = DivaEdit;\n    }\n\n    var view = new NeonView(params);\n    view.start();\n  });\n}\n\nfunction getGetParam (paramName) {\n  let result = null;\n\n  let tmp = [];\n  window.location.search\n    .substr(1)\n    .split('&')\n    .forEach((item) => {\n      tmp = item.split('=');\n      if (tmp[0] === paramName) {\n        result = decodeURIComponent(tmp[1]);\n      }\n    });\n  return result;\n}\n","import { convertSbToStaff } from './utils/ConvertMei';\nimport * as Validation from './Validation';\nimport VerovioWrapper from './VerovioWrapper';\nimport { WebAnnotation, Attributes, EditorAction, NeonManifest, VerovioMessage } from './Types';\nimport { uuidv4 } from './utils/random';\n\nimport PouchDB from 'pouchdb';\n\n/**\n * A cache is used to keep track of what has happened\n * across multiple pages in a manuscript without having\n * to make many calls to the PouchhDb database.\n */\ninterface CacheEntry {\n  dirty: boolean;\n  mei: string;\n  svg: SVGSVGElement;\n}\n\n/**\n * The core component of Neon. This manages the database,\n * the verovio toolkit, the cache, and undo/redo stacks.\n */\nclass NeonCore {\n  /** Wrapper for the Verovio WebWorker. */\n  private verovioWrapper: VerovioWrapper;\n  /** Stacks of actions that can be undone per page. */\n  private undoStacks: Map<string, string[]>;\n  /** Stacks of actions that can be redone per page. */\n  private redoStacks: Map<string, string[]>;\n  /** Cache containing entries for each page. */\n  private neonCache: Map<string, CacheEntry>;\n  private db: PouchDB.Database;\n  private parser: DOMParser;\n  /** Pages known not to have any associated MEI. */\n  private blankPages: Array<string>;\n  /** A collection of W3 Web Annotations. */\n  private annotations: WebAnnotation[];\n  private manifest: NeonManifest;\n  private lastPageLoaded: string;\n\n  getAnnotations (): WebAnnotation[] { return this.annotations; }\n\n  /**\n   * Constructor for NeonCore\n   */\n  constructor (manifest: NeonManifest) {\n    this.verovioWrapper = new VerovioWrapper();\n    Validation.init();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be undone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.undoStacks = new Map<string, string[]>();\n\n    /**\n     * Stacks of previous MEI files representing actions that can be redone for each page.\n     * @type {Map.<string, Array.<string>>}\n     */\n    this.redoStacks = new Map();\n\n    this.neonCache = new Map();\n\n    this.parser = new DOMParser();\n\n    this.db = new PouchDB('Neon');\n\n    this.blankPages = [];\n\n    // Add each MEI to the database\n    this.manifest = manifest;\n    this.annotations = manifest.mei_annotations;\n    this.lastPageLoaded = '';\n  }\n\n  /**\n   * Initialize the PouchDb database based on the provided manifest.\n   * If a newer version already exists in the database, this will\n   * not update the database unless forced.\n   * @param force - If a database update should be forced.\n   */\n  async initDb (force = false): Promise<{}> {\n    // Check for existing manifest\n    type DbAnnotation = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & WebAnnotation;\n    type Doc = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & { timestamp: string; annotations: string[]};\n    const response = await new Promise<{}>((resolve, reject): void => {\n      this.db.get(this.manifest['@id']).catch(err => {\n        if (err.name === 'not_found') {\n          // This is a new document.\n          const doc = {\n            _id: this.manifest['@id'],\n            timestamp: this.manifest.timestamp,\n            image: this.manifest.image,\n            title: this.manifest.title,\n            annotations: []\n          };\n          this.annotations.forEach(annotation => {\n            doc.annotations.push(annotation.id);\n          });\n          return doc;\n        } else {\n          console.error(err);\n          return reject(err);\n        }\n      }).then(async (doc: Doc) => {\n        // Check if doc timestamp is newer than manifest\n        const docTime = (new Date(doc.timestamp)).getTime();\n        // Format timestamp to specific ISO 8601 variant because\n        // Safari requires timezone offsets to be +/-HH:MM and fails on\n        // the equally valid +/-HHMM. This doesn't need to be applied to\n        // the browser generated timestamp since that always generates a\n        // timestamp in UTC with the Z ending.\n        const timeZoneRegexp = /(.+[-+\\u2212]\\d\\d)(\\d\\d)$/;\n        const manTime = (timeZoneRegexp.test(this.manifest.timestamp)) ?\n          (new Date(this.manifest.timestamp.replace(timeZoneRegexp, '$1:$2'))).getTime()\n          : (new Date(this.manifest.timestamp)).getTime();\n        if (docTime > manTime) {\n          if (!force) {\n            // Fill annotations list with db annotations\n            this.annotations = [];\n            const promises = doc.annotations.map((id: string) => {\n              return new Promise((res) => {\n                this.db.get(id).then((annotation: DbAnnotation) => {\n                  this.annotations.push({\n                    id: annotation._id,\n                    type: 'Annotation',\n                    body: annotation.body,\n                    target: annotation.target\n                  });\n                  res();\n                }).catch(err => {\n                  console.error(err);\n                  res();\n                });\n              });\n            });\n            await Promise.all(promises);\n            return resolve(false);\n          }\n        }\n        for (const annotation of this.annotations) {\n          // Add annotations to database\n          await this.db.get(annotation.id).catch(err => {\n            if (err.name === 'not_found') {\n              return {\n                _id: annotation.id\n              };\n            } else {\n              console.error(err);\n              return reject(err);\n            }\n          }).then((newAnnotation: DbAnnotation) => {\n            newAnnotation.body = annotation.body;\n            newAnnotation.target = annotation.target;\n            return this.db.put(newAnnotation);\n          }).catch(err => {\n            reject(err);\n            console.error(err);\n          });\n        }\n        return this.db.put(doc);\n      }).then(() => {\n        return resolve(true);\n      }).catch(err => {\n        reject(err);\n        console.error(err);\n      });\n    });\n\n    return response;\n  }\n\n  /**\n   * Load a page into the verovio toolkit. This will fetch the\n   * page from the cache or from the database.\n   * @param pageURI - The URI of the selected page.\n   */\n  loadPage (pageURI: string): Promise<CacheEntry> {\n    return new Promise((resolve, reject): void => {\n      // Was this already the loaded page?\n      if (this.lastPageLoaded === pageURI && this.neonCache.has(pageURI)) {\n        resolve(this.neonCache.get(pageURI));\n      } else if (this.neonCache.has(pageURI)) {\n        this.loadData(pageURI, this.neonCache.get(pageURI).mei).then(() => {\n          resolve(this.neonCache.get(pageURI));\n        });\n      // Do we know this page has no MEI content?\n      } else if (this.blankPages.includes(pageURI)) {\n        Validation.blankPage();\n        const e = new Error('No MEI file for page ' + pageURI);\n        e.name = 'missing_mei';\n        reject(e);\n      } else {\n        // Find annotation\n        const annotation = this.annotations.find(elem => {\n          return elem.target === pageURI;\n        });\n        if (annotation) {\n          window.fetch(annotation.body).then(response => {\n            if (response.ok) {\n              return response.text();\n            } else {\n              throw new Error(response.statusText);\n            }\n          }).then(data => {\n            // Check if the MEI file is sb-based. If so, convert to staff-based.\n            if (data.match(/<sb .+>/)) {\n              data = convertSbToStaff(data);\n            }\n            this.loadData(pageURI, data).then(() => {\n              resolve(this.neonCache.get(pageURI));\n            });\n          }).catch(err => {\n            reject(err);\n          });\n        } else {\n          // If no annotation was found treat the page as\n          // being blank\n          Validation.blankPage();\n          this.blankPages.push(pageURI);\n        }\n      }\n    });\n  }\n\n  /**\n   * Load data into the verovio toolkit and update the cache.\n   * @param pageURI - The URI of the selected page.\n   * @param data - The MEI of the page as a string.\n   * @param dirty - If the cache entry should be marked as dirty.\n   */\n  loadData (pageURI: string, data: string, dirty = false): Promise<void> {\n    Validation.sendForValidation(data);\n    this.lastPageLoaded = pageURI;\n    /* A promise is returned that will resolve to the result of the action.\n     * However the value that is must return comes from the Web Worker and\n     * information passed between the worker and main context much be in a\n     * message. So an event handler is put on verovioWrapper for when a message\n     * is receieved from the worker. Then a message is sent to the worker to\n     * take an action. A response is sent back and the previously mentioned\n     * event handler handles the response. Since it is defined within the\n     * promise it has access to the necessary resolve function.\n     */\n    return new Promise((resolve): void => {\n      const message: VerovioMessage = {\n        id: uuidv4(),\n        action: 'renderData',\n        mei: data\n      };\n      function handle (evt: MessageEvent): void {\n        if (evt.data.id === message.id) {\n          const svg = this.parser.parseFromString(\n            evt.data.svg,\n            'image/svg+xml'\n          ).documentElement;\n          this.neonCache.set(pageURI, {\n            svg: svg,\n            mei: data,\n            dirty: dirty\n          });\n          evt.target.removeEventListener('message', handle);\n          resolve();\n        }\n      }\n      this.verovioWrapper.addEventListener('message', handle.bind(this));\n      this.verovioWrapper.postMessage(message);\n    });\n  }\n\n  /**\n   * Get the SVG for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getSVG (pageURI: string): Promise<SVGSVGElement> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.svg);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get the MEI for a specific page.\n   * @param pageURI - The URI of the selected page.\n   */\n  getMEI (pageURI: string): Promise<string> {\n    return new Promise((resolve, reject): void => {\n      this.loadPage(pageURI).then((entry) => {\n        resolve(entry.mei);\n      }).catch((err) => { reject(err); });\n    });\n  }\n\n  /**\n   * Get musical element attributes from the verovio toolkit.\n   * @param elementId - The unique ID of the musical element.\n   * @param pageURI - The URI of the selected page.\n   */\n  getElementAttr (elementId: string, pageURI: string): Promise<Attributes> {\n    return new Promise((resolve): void => {\n      this.loadPage(pageURI).then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getElementAttr',\n          elementId: elementId\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(evt.data.attributes);\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Perform an editor action on a specific page.\n   * @param action - The editor toolkit action object.\n   * @param pageURI - The URI of the selected page.\n   */\n  edit (editorAction: EditorAction, pageURI: string): Promise<boolean> {\n    let promise: Promise<CacheEntry>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve(this.neonCache.get(pageURI));\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(entry => {\n        const currentMEI = entry.mei;\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'edit',\n          editorAction: editorAction\n        };\n        function handle (evt: MessageEvent): void {\n          if (evt.data.id === message.id) {\n            if (evt.data.result) {\n              if (!this.undoStacks.has(pageURI)) {\n                this.undoStacks.set(pageURI, []);\n              }\n              this.undoStacks.get(pageURI).push(currentMEI);\n              this.redoStacks.set(pageURI, []);\n            }\n            evt.target.removeEventListener('message', handle);\n            this.updateCache(pageURI, true).then(() => { resolve(evt.data.result); });\n          }\n        }\n        this.verovioWrapper.addEventListener('message', handle.bind(this));\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Update contents of the cache using information in verovio toolkit.\n   * @param pageURI - Page to be updated in cache.\n   * @param dirty - If the entry should be marked as dirty\n   */\n  updateCache (pageURI: string, dirty: boolean): Promise<void> {\n    return new Promise((resolve): void => {\n      // Must get MEI and then get SVG then finish.\n      let mei: string, svgText: string;\n      const meiPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'getMEI'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            mei = evt.data.mei;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n      const svgPromise = new Promise((resolve): void => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'renderToSVG'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            svgText = evt.data.svg;\n            evt.target.removeEventListener('message', handle);\n            resolve();\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n\n      meiPromise.then(() => { return svgPromise; }).then(() => {\n        const svg = this.parser.parseFromString(\n          svgText,\n          'image/svg+xml'\n        ).documentElement as unknown as SVGSVGElement;\n        this.neonCache.set(pageURI, {\n          mei: mei,\n          svg: svg,\n          dirty: dirty\n        });\n        resolve();\n      });\n    });\n  }\n\n  /**\n   * Get the edit info string from the verovio toolkit.\n   * @param pageURI - The URI of the page to get the edit info string from.\n   */\n  info (pageURI: string): Promise<string> {\n    let promise: Promise<CacheEntry | void>;\n    if (this.lastPageLoaded === pageURI) {\n      promise = Promise.resolve();\n    } else {\n      promise = this.loadPage(pageURI);\n    }\n    return new Promise((resolve): void => {\n      promise.then(() => {\n        const message: VerovioMessage = {\n          id: uuidv4(),\n          action: 'editInfo'\n        };\n        this.verovioWrapper.addEventListener('message', function handle (evt: MessageEvent) {\n          if (evt.data.id === message.id) {\n            evt.target.removeEventListener('message', handle);\n            resolve(JSON.parse(evt.data.info));\n          }\n        });\n        this.verovioWrapper.postMessage(message);\n      });\n    });\n  }\n\n  /**\n   * Undo the last action performed on a specific page.\n   * @param pageURI - The URI of the selected page.\n   * @returns If the action was undone.\n   */\n  undo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.undoStacks.has(pageURI)) {\n        const state = this.undoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then(mei => {\n            this.redoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Redo the last action performed on a page.\n   * @param pageURI - The page URI.\n   * @returns If the action was redone.\n   */\n  redo (pageURI: string): Promise<boolean> {\n    return new Promise((resolve): void => {\n      if (this.redoStacks.has(pageURI)) {\n        const state = this.redoStacks.get(pageURI).pop();\n        if (state !== undefined) {\n          this.getMEI(pageURI).then((mei) => {\n            this.undoStacks.get(pageURI).push(mei);\n            return this.loadData(pageURI, state, true);\n          }).then(() => {\n            resolve(true);\n          });\n          return;\n        }\n      }\n      resolve(false);\n    });\n  }\n\n  /**\n   * Update the PouchDb database stored in the browser.\n   * This is based on the data stored in the cache. To save time,\n   * only entries marked as dirty will be updated.\n   */\n  async updateDatabase (): Promise<void> {\n    type Doc = PouchDB.Core.GetMeta & PouchDB.Core.IdMeta & { body: string; timestamp: string };\n    let updateTimestamp = false;\n    for (const pair of this.neonCache) {\n      const key = pair[0];\n      const value = pair[1];\n      if (value.dirty) {\n        updateTimestamp = true;\n        const index = this.annotations.findIndex(elem => { return elem.target === key; });\n        // try to update server with PUT request (if applicable)\n        // this is simpler than expecting a specific API on the server\n        // and using POST requests, although that would be better if there\n        // is ever a dedicated public server for Neon! At time of writing,\n        // only dev/testing server accepts PUT requests.\n        // only attempt if not a data URI\n        let uri: string;\n        if (!this.annotations[index].body.match(/^data:/)) {\n          await window.fetch(this.annotations[index].body,\n            {\n              method: 'PUT',\n              headers: { 'Content-Type': 'application/mei+xml' },\n              body: value.mei\n            }\n          ).then(response => {\n            if (response.ok) {\n              uri = this.annotations[index].body;\n            } else {\n              uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n            }\n          }).catch(err => {\n            console.error(err);\n            console.warn('Falling back to data URI');\n            uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n          });\n        } else {\n          uri = 'data:application/mei+xml;base64,' + window.btoa(value.mei);\n        }\n        // Update URI in annotations, database\n        this.annotations[index].body = uri;\n        await this.db.get(this.annotations[index].id).then((doc: Doc) => {\n          doc.body = uri;\n          return this.db.put(doc);\n        }).then(() => {\n          value.dirty = false;\n        }).catch(err => {\n          console.error(err);\n        });\n      }\n    }\n\n    if (updateTimestamp) {\n      await this.db.get(this.manifest['@id']).then((doc: Doc) => {\n        doc.timestamp = (new Date()).toISOString();\n        return this.db.put(doc);\n      }).catch(err => {\n        console.error(err);\n      });\n    }\n  }\n\n  /** Completely remove the database. */\n  async deleteDb (): Promise<{}[]> {\n    type Doc = PouchDB.Core.IdMeta & PouchDB.Core.GetMeta & { timestamp: string; annotations: string[]};\n    const annotations = await this.db.get(this.manifest['@id'])\n      .then((doc: Doc) => { return doc.annotations; } );\n    annotations.push(this.manifest['@id']);\n\n    const promises = annotations.map((id) => {\n      return new Promise(res => {\n        this.db.get(id)\n          .then(doc => { return this.db.remove(doc); })\n          .then(() => res());\n      });\n    });\n    return Promise.all(promises);\n  }\n}\n\nexport { NeonCore as default };\n","const schemaResponse = fetch(__ASSET_PREFIX__ + 'assets/mei-all.rng');\nlet worker: Worker, schema: string, statusField: HTMLSpanElement;\n\n/**\n * Update the UI with the validation results. Called when the WebWorker finishes validating.\n */\nfunction updateUI (message: { data: string[] }): void {\n  const errors = message.data;\n  if (errors === null) {\n    statusField.textContent = 'VALID';\n    statusField.style.color = 'green';\n    for (const child of statusField.children) {\n      child.remove();\n    }\n  } else {\n    let log = '';\n    errors.forEach(line => {\n      log += line + '\\n';\n    });\n    statusField.textContent = '';\n    statusField.style.color = 'red';\n    const link = document.createElement('a');\n    link.setAttribute('href', 'data:text/plain;charset=utf-8,' +\n      encodeURIComponent(log));\n    link.setAttribute('download', 'validation.log');\n    link.textContent = 'INVALID';\n    statusField.appendChild(link);\n  }\n}\n\n/**\n * Add the validation information to the display and create the WebWorker\n * for validation MEI.\n */\nexport async function init (): Promise<void> {\n  const displayContents = document.getElementById('displayContents');\n  if (displayContents !== null) {\n    const panelBlock = document.createElement('div');\n    panelBlock.classList.add('panel-block');\n    const pNotif = document.createElement('p');\n    pNotif.textContent = 'MEI Status: ';\n    const span = document.createElement('span');\n    span.id = 'validation_status';\n    span.textContent = 'unknown';\n    pNotif.appendChild(span);\n    panelBlock.appendChild(pNotif);\n    displayContents.appendChild(panelBlock);\n    statusField = document.getElementById('validation_status');\n    worker = new Worker(__ASSET_PREFIX__ + 'workers/Worker.js');\n    worker.onmessage = updateUI;\n  }\n}\n\n/**\n * Send the contents of an MEI file to the WebWorker for validation.\n * @param {string} meiData\n */\nexport async function sendForValidation (meiData: string): Promise<void> {\n  if (statusField === undefined) {\n    return;\n  }\n  if (schema === undefined) {\n    const response = await schemaResponse;\n    schema = await response.text();\n  }\n  statusField.textContent = 'checking...';\n  statusField.style.color = 'gray';\n  worker.postMessage({\n    mei: meiData,\n    schema: schema\n  });\n}\n\n/**\n * Update the message on a blank page when there is no MEI.\n */\nexport function blankPage (): void {\n  for (const child of statusField.children) {\n    child.remove();\n  }\n  statusField.textContent = 'No MEI';\n  statusField.style.color = 'color:gray';\n}\n","import { VerovioMessage } from './Types';\n\n\n/**\n * A wrapper around the verovio web worker to permit mocking in tests.\n */\nexport default class VerovioWrapper {\n  verovioWorker: Worker;\n  constructor () {\n    this.verovioWorker = new Worker(__ASSET_PREFIX__ + 'workers/VerovioWorker.js');\n  }\n\n  /**\n   * Set an event listener onto the actual web worker.\n   */\n  addEventListener (type: string, handler: EventListenerOrEventListenerObject): void {\n    return this.verovioWorker.addEventListener(type, handler);\n  }\n\n  /**\n   * Send a message to the actual web worker.\n   */\n  postMessage (message: VerovioMessage): void {\n    return this.verovioWorker.postMessage(message);\n  }\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import { NeonManifest } from '../Types';\nconst NeonSchema = require('./manifest/NeonSchema.json');\nconst NeonContext = require('./manifest/context.json');\n\nimport { validate } from 'jsonschema';\n/**\n * Check if the provided Neon manifest is parseable.\n * @param {string} manifestString - The Neon manifest as a string.\n */\nexport function parseManifest (manifestString: NeonManifest): boolean {\n  const results = validate(manifestString, NeonSchema);\n  const instance = results.instance;\n  if (results.errors.length > 0) {\n    console.error(results.errors);\n    return false;\n  }\n  const context = instance['@context'];\n  if (context === 'https://ddmal.music.mcgill.ca/Neon/contexts/1/manifest.jsonld') {\n    return true;\n  }\n  if ((context[0] === NeonContext[0]) &&\n      (context[1]['schema'] === NeonContext[1]['schema']) &&\n      (context[1]['title'] === NeonContext[1]['title']) &&\n      (context[1]['timestamp'] === NeonContext[1]['timestamp']) &&\n      (context[1]['image']['@id'] === NeonContext[1]['image']['@id']) &&\n      (context[1]['image']['@type'] === NeonContext[1]['image']['@type']) &&\n      (context[1]['mei_annotations']['@id'] === NeonContext[1]['mei_annotations']['@id']) &&\n      (context[1]['mei_annotations']['@type'] === NeonContext[1]['mei_annotations']['@type']) &&\n      (context[1]['mei_annotations']['@container'] === NeonContext[1]['mei_annotations']['@container'])) {\n    return true;\n  } else {\n    console.error('Context mismatch');\n    console.error(context);\n    console.error(NeonContext);\n    return false;\n  }\n}\n","'use strict';\n\nvar Validator = module.exports.Validator = require('./validator');\n\nmodule.exports.ValidatorResult = require('./helpers').ValidatorResult;\nmodule.exports.ValidationError = require('./helpers').ValidationError;\nmodule.exports.SchemaError = require('./helpers').SchemaError;\nmodule.exports.SchemaScanResult = require('./scan').SchemaScanResult;\nmodule.exports.scan = require('./scan').scan;\n\nmodule.exports.validate = function (instance, schema, options) {\n  var v = new Validator();\n  return v.validate(instance, schema, options);\n};\n","'use strict';\n\nvar urilib = require('url');\n\nvar attribute = require('./attribute');\nvar helpers = require('./helpers');\nvar scanSchema = require('./scan').scan;\nvar ValidatorResult = helpers.ValidatorResult;\nvar SchemaError = helpers.SchemaError;\nvar SchemaContext = helpers.SchemaContext;\n//var anonymousBase = 'vnd.jsonschema:///';\nvar anonymousBase = '/';\n\n/**\n * Creates a new Validator object\n * @name Validator\n * @constructor\n */\nvar Validator = function Validator () {\n  // Allow a validator instance to override global custom formats or to have their\n  // own custom formats.\n  this.customFormats = Object.create(Validator.prototype.customFormats);\n  this.schemas = {};\n  this.unresolvedRefs = [];\n\n  // Use Object.create to make this extensible without Validator instances stepping on each other's toes.\n  this.types = Object.create(types);\n  this.attributes = Object.create(attribute.validators);\n};\n\n// Allow formats to be registered globally.\nValidator.prototype.customFormats = {};\n\n// Hint at the presence of a property\nValidator.prototype.schemas = null;\nValidator.prototype.types = null;\nValidator.prototype.attributes = null;\nValidator.prototype.unresolvedRefs = null;\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param schema\n * @param urn\n * @return {Object}\n */\nValidator.prototype.addSchema = function addSchema (schema, base) {\n  var self = this;\n  if (!schema) {\n    return null;\n  }\n  var scan = scanSchema(base||anonymousBase, schema);\n  var ourUri = base || schema.id;\n  for(var uri in scan.id){\n    this.schemas[uri] = scan.id[uri];\n  }\n  for(var uri in scan.ref){\n    this.unresolvedRefs.push(uri);\n  }\n  this.unresolvedRefs = this.unresolvedRefs.filter(function(uri){\n    return typeof self.schemas[uri]==='undefined';\n  });\n  return this.schemas[ourUri];\n};\n\nValidator.prototype.addSubSchemaArray = function addSubSchemaArray(baseuri, schemas) {\n  if(!(schemas instanceof Array)) return;\n  for(var i=0; i<schemas.length; i++){\n    this.addSubSchema(baseuri, schemas[i]);\n  }\n};\n\nValidator.prototype.addSubSchemaObject = function addSubSchemaArray(baseuri, schemas) {\n  if(!schemas || typeof schemas!='object') return;\n  for(var p in schemas){\n    this.addSubSchema(baseuri, schemas[p]);\n  }\n};\n\n\n\n/**\n * Sets all the schemas of the Validator instance.\n * @param schemas\n */\nValidator.prototype.setSchemas = function setSchemas (schemas) {\n  this.schemas = schemas;\n};\n\n/**\n * Returns the schema of a certain urn\n * @param urn\n */\nValidator.prototype.getSchema = function getSchema (urn) {\n  return this.schemas[urn];\n};\n\n/**\n * Validates instance against the provided schema\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {Array}\n */\nValidator.prototype.validate = function validate (instance, schema, options, ctx) {\n  if (!options) {\n    options = {};\n  }\n  var propertyName = options.propertyName || 'instance';\n  // This will work so long as the function at uri.resolve() will resolve a relative URI to a relative URI\n  var base = urilib.resolve(options.base||anonymousBase, schema.id||'');\n  if(!ctx){\n    ctx = new SchemaContext(schema, options, propertyName, base, Object.create(this.schemas));\n    if (!ctx.schemas[base]) {\n      ctx.schemas[base] = schema;\n    }\n    var found = scanSchema(base, schema);\n    for(var n in found.id){\n      var sch = found.id[n];\n      ctx.schemas[n] = sch;\n    }\n  }\n  if (schema) {\n    var result = this.validateSchema(instance, schema, options, ctx);\n    if (!result) {\n      throw new Error('Result undefined');\n    }\n    return result;\n  }\n  throw new SchemaError('no schema specified', schema);\n};\n\n/**\n* @param Object schema\n* @return mixed schema uri or false\n*/\nfunction shouldResolve(schema) {\n  var ref = (typeof schema === 'string') ? schema : schema.$ref;\n  if (typeof ref=='string') return ref;\n  return false;\n}\n\n/**\n * Validates an instance against the schema (the actual work horse)\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @private\n * @return {ValidatorResult}\n */\nValidator.prototype.validateSchema = function validateSchema (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n    // Support for the true/false schemas\n  if(typeof schema==='boolean') {\n    if(schema===true){\n      // `true` is always valid\n      schema = {};\n    }else if(schema===false){\n      // `false` is always invalid\n      schema = {type: []};\n    }\n  }else if(!schema){\n    // This might be a string\n    throw new Error(\"schema is undefined\");\n  }\n\n  if (schema['extends']) {\n    if (schema['extends'] instanceof Array) {\n      var schemaobj = {schema: schema, ctx: ctx};\n      schema['extends'].forEach(this.schemaTraverser.bind(this, schemaobj));\n      schema = schemaobj.schema;\n      schemaobj.schema = null;\n      schemaobj.ctx = null;\n      schemaobj = null;\n    } else {\n      schema = helpers.deepMerge(schema, this.superResolve(schema['extends'], ctx));\n    }\n  }\n\n  // If passed a string argument, load that schema URI\n  var switchSchema;\n  if (switchSchema = shouldResolve(schema)) {\n    var resolved = this.resolve(schema, switchSchema, ctx);\n    var subctx = new SchemaContext(resolved.subschema, options, ctx.propertyPath, resolved.switchSchema, ctx.schemas);\n    return this.validateSchema(instance, resolved.subschema, options, subctx);\n  }\n\n  var skipAttributes = options && options.skipAttributes || [];\n  // Validate each schema attribute against the instance\n  for (var key in schema) {\n    if (!attribute.ignoreProperties[key] && skipAttributes.indexOf(key) < 0) {\n      var validatorErr = null;\n      var validator = this.attributes[key];\n      if (validator) {\n        validatorErr = validator.call(this, instance, schema, options, ctx);\n      } else if (options.allowUnknownAttributes === false) {\n        // This represents an error with the schema itself, not an invalid instance\n        throw new SchemaError(\"Unsupported attribute: \" + key, schema);\n      }\n      if (validatorErr) {\n        result.importErrors(validatorErr);\n      }\n    }\n  }\n\n  if (typeof options.rewrite == 'function') {\n    var value = options.rewrite.call(this, instance, schema, options, ctx);\n    result.instance = value;\n  }\n  return result;\n};\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.schemaTraverser = function schemaTraverser (schemaobj, s) {\n  schemaobj.schema = helpers.deepMerge(schemaobj.schema, this.superResolve(s, schemaobj.ctx));\n}\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.superResolve = function superResolve (schema, ctx) {\n  var ref;\n  if(ref = shouldResolve(schema)) {\n    return this.resolve(schema, ref, ctx).subschema;\n  }\n  return schema;\n}\n\n/**\n* @private\n* @param Object schema\n* @param Object switchSchema\n* @param SchemaContext ctx\n* @return Object resolved schemas {subschema:String, switchSchema: String}\n* @throws SchemaError\n*/\nValidator.prototype.resolve = function resolve (schema, switchSchema, ctx) {\n  switchSchema = ctx.resolve(switchSchema);\n  // First see if the schema exists under the provided URI\n  if (ctx.schemas[switchSchema]) {\n    return {subschema: ctx.schemas[switchSchema], switchSchema: switchSchema};\n  }\n  // Else try walking the property pointer\n  var parsed = urilib.parse(switchSchema);\n  var fragment = parsed && parsed.hash;\n  var document = fragment && fragment.length && switchSchema.substr(0, switchSchema.length - fragment.length);\n  if (!document || !ctx.schemas[document]) {\n    throw new SchemaError(\"no such schema <\" + switchSchema + \">\", schema);\n  }\n  var subschema = helpers.objectGetPath(ctx.schemas[document], fragment.substr(1));\n  if(subschema===undefined){\n    throw new SchemaError(\"no such schema \" + fragment + \" located in <\" + document + \">\", schema);\n  }\n  return {subschema: subschema, switchSchema: switchSchema};\n};\n\n/**\n * Tests whether the instance if of a certain type.\n * @private\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @param type\n * @return {boolean}\n */\nValidator.prototype.testType = function validateType (instance, schema, options, ctx, type) {\n  if (typeof this.types[type] == 'function') {\n    return this.types[type].call(this, instance);\n  }\n  if (type && typeof type == 'object') {\n    var res = this.validateSchema(instance, type, options, ctx);\n    return res === undefined || !(res && res.errors.length);\n  }\n  // Undefined or properties not on the list are acceptable, same as not being defined\n  return true;\n};\n\nvar types = Validator.prototype.types = {};\ntypes.string = function testString (instance) {\n  return typeof instance == 'string';\n};\ntypes.number = function testNumber (instance) {\n  // isFinite returns false for NaN, Infinity, and -Infinity\n  return typeof instance == 'number' && isFinite(instance);\n};\ntypes.integer = function testInteger (instance) {\n  return (typeof instance == 'number') && instance % 1 === 0;\n};\ntypes.boolean = function testBoolean (instance) {\n  return typeof instance == 'boolean';\n};\ntypes.array = function testArray (instance) {\n  return Array.isArray(instance);\n};\ntypes['null'] = function testNull (instance) {\n  return instance === null;\n};\ntypes.date = function testDate (instance) {\n  return instance instanceof Date;\n};\ntypes.any = function testAny (instance) {\n  return true;\n};\ntypes.object = function testObject (instance) {\n  // TODO: fix this - see #15\n  return instance && (typeof instance) === 'object' && !(instance instanceof Array) && !(instance instanceof Date);\n};\n\nmodule.exports = Validator;\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","'use strict';\n\nvar helpers = require('./helpers');\n\n/** @type ValidatorResult */\nvar ValidatorResult = helpers.ValidatorResult;\n/** @type SchemaError */\nvar SchemaError = helpers.SchemaError;\n\nvar attribute = {};\n\nattribute.ignoreProperties = {\n  // informative properties\n  'id': true,\n  'default': true,\n  'description': true,\n  'title': true,\n  // arguments to other properties\n  'exclusiveMinimum': true,\n  'exclusiveMaximum': true,\n  'additionalItems': true,\n  // special-handled properties\n  '$schema': true,\n  '$ref': true,\n  'extends': true\n};\n\n/**\n * @name validators\n */\nvar validators = attribute.validators = {};\n\n/**\n * Validates whether the instance if of a certain type\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.type = function validateType (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var types = Array.isArray(schema.type) ? schema.type : [schema.type];\n  if (!types.some(this.testType.bind(this, instance, schema, options, ctx))) {\n    var list = types.map(function (v) {\n      return v.id && ('<' + v.id + '>') || (v+'');\n    });\n    result.addError({\n      name: 'type',\n      argument: list,\n      message: \"is not of a type(s) \" + list,\n    });\n  }\n  return result;\n};\n\nfunction testSchemaNoThrow(instance, options, ctx, callback, schema){\n  var throwError = options.throwError;\n  options.throwError = false;\n  var res = this.validateSchema(instance, schema, options, ctx);\n  options.throwError = throwError;\n\n  if (! res.valid && callback instanceof Function) {\n    callback(res);\n  }\n  return res.valid;\n}\n\n/**\n * Validates whether the instance matches some of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.anyOf = function validateAnyOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  if (!Array.isArray(schema.anyOf)){\n    throw new SchemaError(\"anyOf must be an array\");\n  }\n  if (!schema.anyOf.some(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res){inner.importErrors(res);}\n      ))) {\n    var list = schema.anyOf.map(function (v, i) {\n      return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n    });\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'anyOf',\n      argument: list,\n      message: \"is not any of \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance matches every given schema\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.allOf = function validateAllOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.allOf)){\n    throw new SchemaError(\"allOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var self = this;\n  schema.allOf.forEach(function(v, i){\n    var valid = self.validateSchema(instance, v, options, ctx);\n    if(!valid.valid){\n      var msg = (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n      result.addError({\n        name: 'allOf',\n        argument: { id: msg, length: valid.errors.length, valid: valid },\n        message: 'does not match allOf schema ' + msg + ' with ' + valid.errors.length + ' error[s]:',\n      });\n      result.importErrors(valid);\n    }\n  });\n  return result;\n};\n\n/**\n * Validates whether the instance matches exactly one of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.oneOf = function validateOneOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.oneOf)){\n    throw new SchemaError(\"oneOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  var count = schema.oneOf.filter(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res) {inner.importErrors(res);}\n      ) ).length;\n  var list = schema.oneOf.map(function (v, i) {\n    return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n  });\n  if (count!==1) {\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'oneOf',\n      argument: list,\n      message: \"is not exactly one from \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates properties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.properties = function validateProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var properties = schema.properties || {};\n  for (var property in properties) {\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, properties[property], options, ctx);\n    }\n\n    var prop = Object.hasOwnProperty.call(instance, property) ? instance[property] : undefined;\n    var res = this.validateSchema(prop, properties[property], options, ctx.makeChild(properties[property], property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n  return result;\n};\n\n/**\n * Test a specific property within in instance against the additionalProperties schema attribute\n * This ignores properties with definitions in the properties schema attribute, but no other attributes.\n * If too many more types of property-existance tests pop up they may need their own class of tests (like `type` has)\n * @private\n * @return {boolean}\n */\nfunction testAdditionalProperty (instance, schema, options, ctx, property, result) {\n  if(!this.types.object(instance)) return;\n  if (schema.properties && schema.properties[property] !== undefined) {\n    return;\n  }\n  if (schema.additionalProperties === false) {\n    result.addError({\n      name: 'additionalProperties',\n      argument: property,\n      message: \"additionalProperty \" + JSON.stringify(property) + \" exists in instance when not allowed\",\n    });\n  } else {\n    var additionalProperties = schema.additionalProperties || {};\n\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, additionalProperties, options, ctx);\n    }\n\n    var res = this.validateSchema(instance[property], additionalProperties, options, ctx.makeChild(additionalProperties, property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n}\n\n/**\n * Validates patternProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.patternProperties = function validatePatternProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var patternProperties = schema.patternProperties || {};\n\n  for (var property in instance) {\n    var test = true;\n    for (var pattern in patternProperties) {\n      var expr = new RegExp(pattern);\n      if (!expr.test(property)) {\n        continue;\n      }\n      test = false;\n\n      if (typeof options.preValidateProperty == 'function') {\n        options.preValidateProperty(instance, property, patternProperties[pattern], options, ctx);\n      }\n\n      var res = this.validateSchema(instance[property], patternProperties[pattern], options, ctx.makeChild(patternProperties[pattern], property));\n      if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n      result.importErrors(res);\n    }\n    if (test) {\n      testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Validates additionalProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.additionalProperties = function validateAdditionalProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  // if patternProperties is defined then we'll test when that one is called instead\n  if (schema.patternProperties) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in instance) {\n    testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minProperties = function validateMinProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length >= schema.minProperties)) {\n    result.addError({\n      name: 'minProperties',\n      argument: schema.minProperties,\n      message: \"does not meet minimum property length of \" + schema.minProperties,\n    })\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxProperties = function validateMaxProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length <= schema.maxProperties)) {\n    result.addError({\n      name: 'maxProperties',\n      argument: schema.maxProperties,\n      message: \"does not meet maximum property length of \" + schema.maxProperties,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates items when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.items = function validateItems (instance, schema, options, ctx) {\n  var self = this;\n  if (!this.types.array(instance)) return;\n  if (!schema.items) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  instance.every(function (value, i) {\n    var items = Array.isArray(schema.items) ? (schema.items[i] || schema.additionalItems) : schema.items;\n    if (items === undefined) {\n      return true;\n    }\n    if (items === false) {\n      result.addError({\n        name: 'items',\n        message: \"additionalItems not permitted\",\n      });\n      return false;\n    }\n    var res = self.validateSchema(value, items, options, ctx.makeChild(items, i));\n    if(res.instance !== result.instance[i]) result.instance[i] = res.instance;\n    result.importErrors(res);\n    return true;\n  });\n  return result;\n};\n\n/**\n * Validates minimum and exclusiveMinimum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minimum = function validateMinimum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid = true;\n  if (schema.exclusiveMinimum && schema.exclusiveMinimum === true) {\n    valid = instance > schema.minimum;\n  } else {\n    valid = instance >= schema.minimum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'minimum',\n      argument: schema.minimum,\n      message: \"must have a minimum value of \" + schema.minimum,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates maximum and exclusiveMaximum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maximum = function validateMaximum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid;\n  if (schema.exclusiveMaximum && schema.exclusiveMaximum === true) {\n    valid = instance < schema.maximum;\n  } else {\n    valid = instance <= schema.maximum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'maximum',\n      argument: schema.maximum,\n      message: \"must have a maximum value of \" + schema.maximum,\n    });\n  }\n  return result;\n};\n\n/**\n * Perform validation for multipleOf and divisibleBy, which are essentially the same.\n * @param instance\n * @param schema\n * @param validationType\n * @param errorMessage\n * @returns {String|null}\n */\nvar validateMultipleOfOrDivisbleBy = function validateMultipleOfOrDivisbleBy (instance, schema, options, ctx, validationType, errorMessage) {\n  if (!this.types.number(instance)) return;\n\n  var validationArgument = schema[validationType];\n  if (validationArgument == 0) {\n    throw new SchemaError(validationType + \" cannot be zero\");\n  }\n\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n  var instanceDecimals = helpers.getDecimalPlaces(instance);\n  var divisorDecimals = helpers.getDecimalPlaces(validationArgument);\n\n  var maxDecimals = Math.max(instanceDecimals , divisorDecimals);\n  var multiplier = Math.pow(10, maxDecimals);\n\n  if (Math.round(instance * multiplier) % Math.round(validationArgument * multiplier) !== 0) {\n    result.addError({\n      name: validationType,\n      argument:  validationArgument,\n      message: errorMessage + JSON.stringify(validationArgument)\n    });\n  }\n\n  return result;\n};\n\n/**\n * Validates divisibleBy when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.multipleOf = function validateMultipleOf (instance, schema, options, ctx) {\n return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"multipleOf\", \"is not a multiple of (divisible by) \");\n};\n\n/**\n * Validates multipleOf when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.divisibleBy = function validateDivisibleBy (instance, schema, options, ctx) {\n  return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"divisibleBy\", \"is not divisible by (multiple of) \");\n};\n\n/**\n * Validates whether the instance value is present.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.required = function validateRequired (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (instance === undefined && schema.required === true) {\n    // A boolean form is implemented for reverse-compatability with schemas written against older drafts\n    result.addError({\n      name: 'required',\n      message: \"is required\"\n    });\n  } else if (this.types.object(instance) && Array.isArray(schema.required)) {\n    schema.required.forEach(function(n){\n      if(instance[n]===undefined){\n        result.addError({\n          name: 'required',\n          argument: n,\n          message: \"requires property \" + JSON.stringify(n),\n        });\n      }\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value matches the regular expression, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.pattern = function validatePattern (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.match(schema.pattern)) {\n    result.addError({\n      name: 'pattern',\n      argument: schema.pattern,\n      message: \"does not match pattern \" + JSON.stringify(schema.pattern.toString()),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is of a certain defined format or a custom\n * format.\n * The following formats are supported for string types:\n *   - date-time\n *   - date\n *   - time\n *   - ip-address\n *   - ipv6\n *   - uri\n *   - color\n *   - host-name\n *   - alpha\n *   - alpha-numeric\n *   - utc-millisec\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {String|null}\n */\nvalidators.format = function validateFormat (instance, schema, options, ctx) {\n  if (instance===undefined) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!result.disableFormat && !helpers.isFormat(instance, schema.format, this)) {\n    result.addError({\n      name: 'format',\n      argument: schema.format,\n      message: \"does not conform to the \" + JSON.stringify(schema.format) + \" format\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minLength = function validateMinLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length >= schema.minLength)) {\n    result.addError({\n      name: 'minLength',\n      argument: schema.minLength,\n      message: \"does not meet minimum length of \" + schema.minLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxLength = function validateMaxLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  // TODO if this was already computed in \"minLength\", use that value instead of re-computing\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length <= schema.maxLength)) {\n    result.addError({\n      name: 'maxLength',\n      argument: schema.maxLength,\n      message: \"does not meet maximum length of \" + schema.maxLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains at least a minimum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minItems = function validateMinItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length >= schema.minItems)) {\n    result.addError({\n      name: 'minItems',\n      argument: schema.minItems,\n      message: \"does not meet minimum length of \" + schema.minItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains no more than a maximum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxItems = function validateMaxItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length <= schema.maxItems)) {\n    result.addError({\n      name: 'maxItems',\n      argument: schema.maxItems,\n      message: \"does not meet maximum length of \" + schema.maxItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates that every item in an instance array is unique, when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  function testArrays (v, i, a) {\n    for (var j = i + 1; j < a.length; j++) if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n    return true;\n  }\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Deep compares arrays for duplicates\n * @param v\n * @param i\n * @param a\n * @private\n * @return {boolean}\n */\nfunction testArrays (v, i, a) {\n  var j, len = a.length;\n  for (j = i + 1, len; j < len; j++) {\n    if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Validates whether there are no duplicates, when the instance is an Array.\n * @param instance\n * @return {String|null}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validate for the presence of dependency properties, if the instance is an object.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.dependencies = function validateDependencies (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in schema.dependencies) {\n    if (instance[property] === undefined) {\n      continue;\n    }\n    var dep = schema.dependencies[property];\n    var childContext = ctx.makeChild(dep, property);\n    if (typeof dep == 'string') {\n      dep = [dep];\n    }\n    if (Array.isArray(dep)) {\n      dep.forEach(function (prop) {\n        if (instance[prop] === undefined) {\n          result.addError({\n            // FIXME there's two different \"dependencies\" errors here with slightly different outputs\n            // Can we make these the same? Or should we create different error types?\n            name: 'dependencies',\n            argument: childContext.propertyPath,\n            message: \"property \" + prop + \" not found, required by \" + childContext.propertyPath,\n          });\n        }\n      });\n    } else {\n      var res = this.validateSchema(instance, dep, options, childContext);\n      if(result.instance !== res.instance) result.instance = res.instance;\n      if (res && res.errors.length) {\n        result.addError({\n          name: 'dependencies',\n          argument: childContext.propertyPath,\n          message: \"does not meet dependency required by \" + childContext.propertyPath,\n        });\n        result.importErrors(res);\n      }\n    }\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is one of the enumerated values.\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['enum'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema['enum'])) {\n    throw new SchemaError(\"enum expects an array\", schema);\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!schema['enum'].some(helpers.deepCompareStrict.bind(null, instance))) {\n    result.addError({\n      name: 'enum',\n      argument: schema['enum'],\n      message: \"is not one of enum values: \" + schema['enum'].map(String).join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance exactly matches a given value\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['const'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!helpers.deepCompareStrict(schema['const'], instance)) {\n    result.addError({\n      name: 'const',\n      argument: schema['const'],\n      message: \"does not exactly match expected constant: \" + schema['const'],\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance if of a prohibited type.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.not = validators.disallow = function validateNot (instance, schema, options, ctx) {\n  var self = this;\n  if(instance===undefined) return null;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var notTypes = schema.not || schema.disallow;\n  if(!notTypes) return null;\n  if(!Array.isArray(notTypes)) notTypes=[notTypes];\n  notTypes.forEach(function (type) {\n    if (self.testType(instance, schema, options, ctx, type)) {\n      var schemaId = type && type.id && ('<' + type.id + '>') || type;\n      result.addError({\n        name: 'not',\n        argument: schemaId,\n        message: \"is of prohibited type \" + schemaId,\n      });\n    }\n  });\n  return result;\n};\n\nmodule.exports = attribute;\n","import * as Notification from './Notification';\nimport NeonView from '../NeonView';\nimport { navbarDropdownMenu, undoRedoPanel } from './EditContents';\nimport { convertStaffToSb } from './ConvertMei';\n\n/**\n * prepare the edit mode button\n */\nexport function prepareEditMode (neonView: NeonView): void {\n  const parent = document.getElementById('dropdown_toggle');\n  const editItem = document.createElement('a');\n  editItem.classList.add('navbar-item');\n  const editButton = document.createElement('button');\n  editButton.classList.add('button');\n  editButton.id = 'edit_mode';\n  editButton.textContent = 'Edit MEI';\n  editItem.appendChild(editButton);\n  parent.appendChild(editItem);\n\n  editButton.addEventListener('click', () => {\n    startEditMode(neonView);\n  });\n}\n\n/**\n * start the basic edit mode features\n * is called when the edit mode button is clicked\n */\nexport function startEditMode (neonView: NeonView): void {\n  const parent: HTMLElement = document.getElementById('dropdown_toggle').parentElement;\n  document.getElementById('dropdown_toggle').remove();\n  parent.prepend(navbarDropdownMenu);\n  document.getElementById('undoRedo_controls').innerHTML = undoRedoPanel;\n  initNavbar(neonView);\n  initUndoRedoPanel(neonView);\n\n  const selectionHighlight = document.createElement('a');\n  const divider = document.createElement('hr');\n  divider.classList.add('dropdown-divider');\n  selectionHighlight.classList.add('dropdown-item');\n  selectionHighlight.id = 'highlight-selection';\n  selectionHighlight.textContent = 'By Selection Mode';\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(divider);\n  (document.getElementsByClassName('dropdown-content'))[0].appendChild(selectionHighlight);\n}\n\n/**\n * Set listener on switching EditMode button to File dropdown in the navbar.\n */\nexport function initNavbar (neonView: NeonView): void {\n  // setup navbar listeners\n  document.getElementById('save').addEventListener('click', () => {\n    neonView.save().then(() => {\n      Notification.queueNotification('Saved');\n    });\n  });\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 's') {\n      neonView.save().then(() => {\n        Notification.queueNotification('Saved');\n      });\n    }\n  });\n\n  document.getElementById('export').addEventListener('click', () => {\n    neonView.export().then(manifest => {\n      const link: HTMLAnchorElement = document.createElement('a');\n      link.href = manifest as string;\n      link.download = neonView.name + '.jsonld';\n      document.body.appendChild(link);\n      link.click();\n      link.remove();\n      Notification.queueNotification('Saved');\n    });\n  });\n\n  document.getElementById('revert').addEventListener('click', function () {\n    if (window.confirm('Reverting will cause all changes to be lost. Press OK to continue.')) {\n      neonView.deleteDb().then(() => {\n        window.location.reload();\n      });\n    }\n  });\n  // Download link for MEI\n  // Is an actual file with a valid URI except in local mode where it must be generated.\n  document.getElementById('getmei').addEventListener('click', () => {\n    const uri = neonView.view.getCurrentPageURI();\n    neonView.getPageMEI(uri).then(mei => {\n      const data = 'data:application/mei+xml;base64,' + window.btoa(convertStaffToSb(mei));\n      document.getElementById('getmei').setAttribute('href', data);\n      document.getElementById('getmei').setAttribute('download', neonView.view.getPageName() + '.mei');\n    });\n  });\n}\n\n/**\n * Initialize the undo/redo panel\n */\nexport function initUndoRedoPanel (neonView: NeonView): void {\n  document.getElementById('undo').addEventListener('click', undoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if (evt.key === 'z' && (evt.ctrlKey || evt.metaKey)) {\n      undoHandler();\n    }\n  });\n\n  document.getElementById('redo').addEventListener('click', redoHandler);\n  document.body.addEventListener('keydown', (evt) => {\n    if ((evt.key === 'Z' || (evt.key === 'z' && evt.shiftKey)) && (evt.ctrlKey || evt.metaKey)) {\n      redoHandler();\n    }\n  });\n\n  /**\n   * Tries to undo an action and update the page if it succeeds.\n   */\n  function undoHandler (): void {\n    neonView.undo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to undo action');\n      }\n    });\n  }\n\n  /**\n   * Tries to redo an action and update the page if it succeeds.\n   */\n  function redoHandler (): void {\n    neonView.redo().then((result: boolean) => {\n      if (result) {\n        neonView.updateForCurrentPage();\n      } else {\n        console.error('Failed to redo action');\n      }\n    });\n  }\n}\n","/**\n * Contents of navbar menu after switching to edit mode.\n */\nexport const navbarDropdownMenu: HTMLDivElement = document.createElement('div');\nnavbarDropdownMenu.classList.add('navbar-item', 'has-dropdown', 'is-hoverable');\nconst fileLink = document.createElement('a');\nfileLink.classList.add('navbar-link');\nfileLink.textContent = 'File';\nconst navbarContents = document.createElement('div');\nnavbarContents.classList.add('navbar-dropdown');\nnavbarContents.id = 'navbar-dropdown-options';\nconst contents = [['save', 'Save'], ['export', 'Save and Export to File'],\n  ['getmei', 'Download MEI'], ['revert', 'Revert']];\ncontents.forEach(content => {\n  const item = document.createElement('a');\n  item.id = content[0];\n  item.classList.add('navbar-item');\n  item.textContent = content[1];\n  navbarContents.appendChild(item);\n});\nnavbarDropdownMenu.appendChild(fileLink);\nnavbarDropdownMenu.appendChild(navbarContents);\n\n/**\n * Finalize option in the navbar for rodan\n */\nexport const navbarFinalize =\n    '<a id=\\'finalize\\' class=\\'navbar-item\\'> Finalize MEI </a>';\n\n/**\n * Contents of the undo/redo panel with buttons\n */\nexport const undoRedoPanel: string =\n    '<div class=\\'field has-addons buttons\\' style=\\'overflow-x: auto;\\'>' +\n    '<p class=\\'control\\'>' +\n    '<button class=\\'button\\' id=\\'undo\\'>Undo</button>' +\n    '<button class=\\'button\\' id=\\'redo\\'>Redo</button></p></a></div>';\n","async function setBody (): Promise<void> {\n  const response = await fetch(__ASSET_PREFIX__ + 'assets/template.html');\n  document.body.innerHTML = await response.text();\n  (document.getElementById('home-link') as HTMLAnchorElement)\n    .href = __LINK_LOCATION__;\n  document.getElementById('neon-version').textContent = __NEON_VERSION__;\n}\n\nexport { setBody as default };\n","import * as d3 from 'd3';\n\nexport class ViewBox {\n  a: number;\n  b: number;\n  c: number;\n  d: number;\n\n  imageHeight: number;\n  imageWidth: number;\n\n  /**\n   * @param imageWidth - Width of the contained image.\n   * @param imageHeight - Height of the contained image.\n   */\n  constructor (imageWidth: number, imageHeight: number) {\n    this.a = 0;\n    this.b = 0;\n    this.c = imageWidth;\n    this.d = imageHeight;\n\n    this.imageWidth = imageWidth;\n    this.imageHeight = imageHeight;\n  }\n\n  /**\n   * Set values of the viewBox manually.\n   * @param w - First value.\n   * @param x - Second value.\n   * @param y - Third value.\n   * @param z - Fourth value.\n   */\n  set (w: number, x: number, y: number, z: number): void {\n    this.a = w;\n    this.b = x;\n    this.c = y;\n    this.d = z;\n  }\n\n  /** @returns Value for the viewBox parameter. */\n  get (): string {\n    return this.a.toString() + ' ' + this.b.toString() + ' ' +\n      this.c + ' ' + this.d;\n  }\n\n  /** @param k - Factor to zoom to. */\n  zoomTo (k: number): void {\n    const zoomHeight = (this.imageHeight / k);\n    const zoomWidth = (this.imageWidth / k);\n\n    this.c = zoomWidth;\n    this.d = zoomHeight;\n  }\n\n  /** @returns Current zoom factor. */\n  getZoom (): number {\n    return this.imageWidth / this.c;\n  }\n\n  /**\n   * Translate viewport.\n   * @param xDiff - Amount to shift on x-axis.\n   * @param yDiff - Amount to shift on y-axis.\n   */\n  translate (xDiff: number, yDiff: number): void {\n    this.a += xDiff;\n    this.b += yDiff;\n  }\n}\n\nexport class ZoomHandler {\n  dragCoordinates: DOMPoint;\n  viewBox: ViewBox;\n  matrix: DOMMatrix;\n\n  /**\n   * Reset the zoom and pan of the SVG viewbox\n   */\n  resetZoomAndPan (): void {\n    const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n    this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n\n    this.updateViewBox();\n  }\n\n  /**\n   * @param k - Factor to zoom to.\n   */\n  zoomTo (k: number): void {\n    this.getViewBox();\n    this.viewBox.zoomTo(k);\n    this.updateViewBox();\n  }\n\n  /**\n   * Translate the view box by relative coordinates.\n  * @param xDiff - Amount to shift on x-axis.\n  * @param yDiff - Amount to shift on y-axis.\n  */\n  translate (xDiff: number, yDiff: number): void {\n    this.getViewBox();\n    this.viewBox.translate(xDiff, yDiff);\n    this.updateViewBox();\n  }\n\n  /**\n   * Restore the view box to its position before the editor action.\n   */\n  restoreTransformation (): void {\n    if (this.viewBox === undefined) {\n      this.resetZoomAndPan();\n    } else {\n      this.updateViewBox();\n    }\n  }\n\n  /**\n   * Get the view box from the SVG in the page.\n   */\n  getViewBox (): void {\n    if (this.viewBox === undefined) {\n      const bgimg = document.getElementById('bgimg') as HTMLImageElement;\n      this.viewBox = new ViewBox(parseInt(bgimg.getAttribute('width')), parseInt(bgimg.getAttribute('height')));\n    }\n    const rawViewBox = document.getElementById('svg_group')\n      .getAttribute('viewBox')\n      .split(' ');\n    this.viewBox.set(\n      parseInt(rawViewBox[0]),\n      parseInt(rawViewBox[1]),\n      parseInt(rawViewBox[2]),\n      parseInt(rawViewBox[3])\n    );\n  }\n\n  /**\n   * Update the viewBox attribute of svg_group\n   */\n  updateViewBox (): void {\n    document.getElementById('svg_group').setAttribute('viewBox', this.viewBox.get());\n  }\n\n  startDrag (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    this.dragCoordinates = group.createSVGPoint();\n    if (d3.event.type === 'touchstart') {\n      // If drag is triggered by a touch event\n      this.dragCoordinates.x = d3.event.touches[0].screenX;\n      this.dragCoordinates.y = d3.event.touches[0].screenY;\n    } else {\n      // Otherwise triggered by a mouse click\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n    }\n\n    this.matrix = group.getScreenCTM().inverse();\n  }\n\n  dragging (): void {\n    const group = document.getElementById('svg_group') as unknown as SVGSVGElement;\n    const newCoordinates = group.createSVGPoint();\n    // Same kind of checking as in startDrag\n    if (d3.event.type === 'touchmove') {\n      newCoordinates.x = d3.event.touches[0].screenX;\n      newCoordinates.y = d3.event.touches[0].screenY;\n    } else if (d3.event.type === 'wheel' && d3.event.shiftKey === false) {\n      if (this.matrix === undefined) {\n        this.matrix = group.getScreenCTM().inverse();\n      }\n      if (this.dragCoordinates === undefined) {\n        this.dragCoordinates = group.createSVGPoint();\n      }\n      this.dragCoordinates.x = d3.event.x;\n      this.dragCoordinates.y = d3.event.y;\n      newCoordinates.x = this.dragCoordinates.x - d3.event.deltaX;\n      newCoordinates.y = this.dragCoordinates.y - d3.event.deltaY;\n      d3.event.preventDefault();\n    } else {\n      newCoordinates.x = d3.event.x;\n      newCoordinates.y = d3.event.y;\n    }\n    const newTransform = newCoordinates.matrixTransform(this.matrix);\n    const dragTransform = this.dragCoordinates.matrixTransform(this.matrix);\n    this.translate(-newTransform.x + dragTransform.x, -newTransform.y + dragTransform.y);\n    this.dragCoordinates = newCoordinates;\n  }\n\n  scrollZoom (): void {\n    if (d3.event.type !== 'wheel') return;\n    if (!d3.event.shiftKey) {\n      this.dragging();\n      return;\n    }\n    const slider = document.getElementById('zoomSlider') as HTMLInputElement;\n    this.getViewBox();\n    const k = this.viewBox.getZoom();\n    let newK = k - d3.event.deltaX / 100;\n    if (newK < parseInt(slider.getAttribute('min')) / 100) newK = 0.25;\n    if (newK > parseInt(slider.getAttribute('max')) / 100) newK = 4;\n    this.zoomTo(newK);\n\n    // Update zoom slider\n    slider.value = (newK * 100).toString();\n    (document.getElementById('zoomOutput') as HTMLOutputElement).value = String(Math.round(newK * 100));\n  }\n}\n\nexport { ZoomHandler as default };\n","/** @module Warnings */\n\n/**\n * Warn when grouped neume components form an unrecognized neume.\n */\nexport function groupingNotRecognized () {\n  if (!(window.confirm('Neon does not recognize this neume grouping. Would you like to create a compound neume?'))) {\n    document.getElementById('undo').click();\n  }\n}\n","import * as Notification from '../utils/Notification';\nimport NeonView from '../NeonView';\nimport { EditorAction } from '../Types';\nimport { selectAll } from '../utils/SelectTools';\nimport DragHandler from '../utils/DragHandler';\n\n/** Handle splitting a staff into two staves through Verovio. */\nexport class SplitHandler {\n  readonly neonView: NeonView;\n  readonly staff: SVGGElement;\n\n  /**\n   * @param staff - The staff that will be modified.\n   */\n  constructor (neonView: NeonView, staff: SVGGElement) {\n    this.neonView = neonView;\n    this.staff = staff;\n  }\n\n  /**\n   * First part of the split action.\n   */\n  startSplit (): void {\n    this.splitDisable();\n\n    document.body.addEventListener('click', this.handler, { capture: true });\n\n    // Handle keypresses\n    document.body.addEventListener('keydown', this.keydownListener);\n    document.body.addEventListener('keyup', this.resetHandler);\n    document.body.addEventListener('click', this.clickawayHandler);\n\n    Notification.queueNotification('Click Where to Split');\n  }\n\n  splitDisable (): void {\n    document.body.removeEventListener('keydown', this.keydownListener);\n    document.body.removeEventListener('keyup', this.resetHandler);\n    document.body.removeEventListener('click', this.clickawayHandler);\n    document.body.removeEventListener('click', this.handler, { capture: true });\n  }\n\n  /** Handle input to split a staff. */\n  handler = ((evt: MouseEvent): void => {\n    const id = this.staff.id;\n\n    const container = this.staff.closest('.definition-scale') as SVGSVGElement;\n    const pt = container.createSVGPoint();\n    pt.x = evt.clientX;\n    pt.y = evt.clientY;\n\n    // Transform to SVG coordinate system.\n    const transformMatrix = (container.getElementsByClassName('system')[0] as SVGGElement)\n      .getScreenCTM().inverse();\n    const cursorPt = pt.matrixTransform(transformMatrix);\n    // Find staff point corresponds to if one exists\n    // TODO\n\n    const editorAction: EditorAction = {\n      'action': 'split',\n      'param': {\n        'elementId': id,\n        'x': cursorPt.x\n      }\n    };\n\n    this.neonView.edit(editorAction, this.neonView.view.getCurrentPageURI()).then(async (result) => {\n      if (result) {\n        await this.neonView.updateForCurrentPage();\n        Notification.queueNotification('Split action successful');\n      }\n      const dragHandler = new DragHandler(this.neonView, '.staff');\n      this.splitDisable();\n      selectAll([document.querySelector('#' + id) as SVGGElement], this.neonView, dragHandler);\n      try {\n        document.getElementById('moreEdit').innerHTML = '';\n        document.getElementById('moreEdit').classList.add('is-invisible');\n      } catch (e) {}\n    });\n  }).bind(this);\n\n  /** Exits split on Escape press, disables on Shift. */\n  keydownListener = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Escape') {\n      this.splitDisable();\n    } else if (evt.key === 'Shift') {\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Exit split if user clicks off of active page. */\n  clickawayHandler = ((evt: MouseEvent): void => {\n    const target = evt.target as HTMLElement;\n    if (target.closest('.active-page') === null) {\n      this.splitDisable();\n      document.body.removeEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n\n  /** Called to reapply the event listener if necessary. */\n  resetHandler = ((evt: KeyboardEvent): void => {\n    if (evt.key === 'Shift') {\n      document.body.addEventListener('click', this.handler, { capture: true });\n    }\n  }).bind(this);\n}\n"],"sourceRoot":""}